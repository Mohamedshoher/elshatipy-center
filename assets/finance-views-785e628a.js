import{a as e,j as t,U as a,W as n,E as r,T as l,D as s,b as o,r as i,P as d,F as c}from"./teacher-views-87eec1c8.js";import{r as m}from"./vendor-79b9f383.js";import{X as h}from"./director-views-1247b421.js";const u=({className:t})=>e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e("polyline",{points:"6 9 12 15 18 9"})}),g=({students:r,groups:l,onViewStudent:s,currentUserRole:o})=>{const[i,d]=m.useState(()=>(new Date).toISOString().substring(0,7)),[c,h]=m.useState(new Set),[g,p]=m.useState(new Set),x=m.useMemo(()=>{let e=0,t=0;const a={},n={};r.forEach(r=>{if(r.isArchived)return;if(r.joiningDate.substring(0,7)>i)return;t+=r.monthlyFee;const l=r.fees.find(e=>e.month===i);l?.paid?(e+=l.amountPaid||r.monthlyFee,a[r.groupId]||(a[r.groupId]=[]),a[r.groupId].push(r)):(n[r.groupId]||(n[r.groupId]=[]),n[r.groupId].push(r))});return{totalCollected:e,totalRemaining:t-e,paidStudentsByGroup:a,unpaidStudentsByGroup:n}},[r,i]),b=(e,t)=>{("paid"===t?h:p)(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},f=({title:r,studentsByGroup:o,expandedSet:i,onToggle:d,isUnpaidSection:c,onSendWhatsApp:m,currentUserRole:h})=>t("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:r}),e("div",{className:"space-y-3",children:l.filter(e=>o[e.id]&&o[e.id].length>0).sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(r=>{const l=o[r.id]||[],g=i.has(r.id);return t("div",{className:"bg-gray-50 rounded-lg border",children:[t("div",{className:"p-3 flex justify-between items-center cursor-pointer hover:bg-gray-100",onClick:()=>d(r.id),children:[e("h3",{className:"font-semibold text-gray-700",children:r.name}),t("div",{className:"flex items-center gap-2",children:[e("span",{className:"font-bold bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-sm",children:l.length}),e(u,{className:"w-5 h-5 text-gray-500 transition-transform duration-300 "+(g?"rotate-180":"")})]})]}),g&&e("div",{className:"border-t border-gray-200 p-3",children:e("ul",{className:"space-y-2",children:l.sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(r=>t("li",{className:"flex items-center justify-between bg-white p-2 rounded-md hover:bg-blue-50 transition-colors",children:[t("button",{onClick:()=>s(r.id),className:"flex-grow text-right flex items-center",children:[e(a,{className:"w-5 h-5 ml-2 text-gray-400"}),r.name]}),c&&m&&("director"===h||"supervisor"===h)&&e("button",{onClick:e=>{e.stopPropagation(),m(r)},className:"p-1 text-green-500 hover:bg-green-100 rounded-full transition-colors flex-shrink-0",title:`Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ± ÙˆØ§ØªØ³Ø§Ø¨ Ù„ÙˆÙ„ÙŠ Ø£Ù…Ø± ${r.name}`,children:e(n,{className:"w-5 h-5"})})]},r.id))})})]},r.id)})})]});return e("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t("div",{className:"space-y-8",children:[t("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[t("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4 mb-6",children:[e("h2",{className:"text-2xl font-bold text-gray-800",children:"ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ"}),t("div",{className:"w-full sm:w-auto max-w-xs",children:[e("label",{htmlFor:"month-filter",className:"sr-only",children:"Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±"}),e("input",{type:"month",id:"month-filter",value:i,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-gray-50 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-center",children:[t("div",{className:"bg-green-100 p-4 rounded-lg",children:[e("p",{className:"text-lg text-green-800 font-semibold",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ØµÙ‘Ù„"}),t("p",{className:"text-3xl font-bold text-green-600 mt-2",children:[x.totalCollected.toLocaleString()," EGP"]})]}),t("div",{className:"bg-red-100 p-4 rounded-lg",children:[e("p",{className:"text-lg text-red-800 font-semibold",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"}),t("p",{className:"text-3xl font-bold text-red-600 mt-2",children:[x.totalRemaining.toLocaleString()," EGP"]})]})]})]}),e(f,{title:"Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ø¯ÙØ¹ÙˆØ§",studentsByGroup:x.paidStudentsByGroup,expandedSet:c,onToggle:e=>b(e,"paid")}),e(f,{title:"Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠØ¯ÙØ¹ÙˆØ§",studentsByGroup:x.unpaidStudentsByGroup,expandedSet:g,onToggle:e=>b(e,"unpaid"),isUnpaidSection:!0,onSendWhatsApp:e=>{const t=new Date(i+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"}),a=`ØªØ°ÙƒÙŠØ± Ù…Ù† Ù…Ø±ÙƒØ² Ø§Ù„Ø´Ø§Ø·Ø¨ÙŠØŒ\nÙ…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø§Ù„Ø·Ø§Ù„Ø¨/Ø©: *${e.name}*.\nÙ†ÙˆØ¯ ØªØ°ÙƒÙŠØ±ÙƒÙ… Ø¨Ø£Ù† Ù…ØµØ±ÙˆÙØ§Øª Ø´Ù‡Ø± *${t}* Ù„Ù… ØªØ³Ø¯Ø¯ Ø¨Ø¹Ø¯.\n\nÙŠØ±Ø¬Ù‰ Ø³Ø±Ø¹Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©.\nØ¥Ø°Ø§ ÙƒÙ†ØªÙ… Ù‚Ø¯ Ø³Ø¯Ø¯ØªÙ… Ø§Ù„Ø±Ø³ÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹ Ø¥Ø­Ø¶Ø§Ø± ÙˆØµÙ„ Ø§Ù„Ø¯ÙØ¹.\n\nØ´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§ÙˆÙ†ÙƒÙ….`,n=e.phone.replace(/[^0-9]/g,"");if(!n)return void alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨.");const r=encodeURIComponent(a);window.open(`https://wa.me/${n}?text=${r}`,"_blank")},currentUserRole:o})]})})},p=({className:a})=>t("svg",{xmlns:"http://www.w3.org/2000/svg",className:a,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),x=({isOpen:a,onClose:n,onSave:r,onUpdate:l,onDelete:s,staffList:o,staffToEdit:i,setStaffToEdit:d})=>{const[c,h]=m.useState(""),[u,g]=m.useState(""),[p,x]=m.useState("");if(m.useEffect(()=>{i?(h(i.name),g(i.role),x(i.salary.toString())):(h(""),g(""),x(""))},[i]),!a)return null;return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-2xl flex flex-col max-h-[90vh]",children:[t("div",{className:"flex-shrink-0 flex justify-between items-center mb-6",children:[e("h2",{className:"text-2xl font-bold text-gray-700",children:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"}),e("button",{onClick:()=>{d(null),n()},className:"text-gray-400 hover:text-gray-600 text-3xl",children:"Ã—"})]}),t("form",{onSubmit:e=>{if(e.preventDefault(),!c||!u||!p)return;const t={name:c,role:u,salary:parseFloat(p)};i?l(i.id,t):r(t),d(null),h(""),g(""),x("")},className:"flex-shrink-0 mb-6 bg-gray-50 p-4 rounded-lg",children:[e("h3",{className:"text-lg font-semibold mb-3",children:i?"ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù":"Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯"}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[t("div",{children:[e("label",{className:"block text-sm",children:"Ø§Ù„Ø§Ø³Ù…"}),e("input",{type:"text",value:c,onChange:e=>h(e.target.value),className:"w-full p-2 border rounded mt-1",required:!0})]}),t("div",{children:[e("label",{className:"block text-sm",children:"Ø§Ù„ÙˆØ¸ÙŠÙØ©"}),e("input",{type:"text",value:u,onChange:e=>g(e.target.value),className:"w-full p-2 border rounded mt-1",required:!0})]}),t("div",{children:[e("label",{className:"block text-sm",children:"Ø§Ù„Ø±Ø§ØªØ¨"}),e("input",{type:"number",value:p,onChange:e=>x(e.target.value),className:"w-full p-2 border rounded mt-1",required:!0})]}),t("div",{className:"md:col-span-3 flex justify-end gap-2 mt-2",children:[i&&e("button",{type:"button",onClick:()=>d(null),className:"px-4 py-2 rounded bg-gray-200 text-gray-800",children:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"}),e("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white",children:i?"Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª":"Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù"})]})]})]}),t("div",{className:"flex-grow overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-3",children:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"}),t("div",{className:"space-y-2",children:[o.map(a=>t("div",{className:"bg-gray-100 p-3 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[t("div",{children:[t("p",{className:"font-semibold",children:[a.name," ",t("span",{className:"text-sm text-gray-500",children:["(",a.role,")"]})]}),t("p",{className:"text-sm text-gray-600",children:[a.salary.toLocaleString()," EGP"]})]}),t("div",{className:"flex gap-2 self-end sm:self-center flex-shrink-0",children:[e("button",{onClick:()=>d(a),className:"text-sm px-3 py-1 rounded bg-blue-100 text-blue-800",children:"ØªØ¹Ø¯ÙŠÙ„"}),e("button",{onClick:()=>{return e=a.id,void(window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ")&&s(e));var e},className:"text-sm px-3 py-1 rounded bg-red-100 text-red-800",children:"Ø­Ø°Ù"})]})]},a.id)),0===o.length&&e("p",{className:"text-center text-gray-400 py-4",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙˆÙ† Ù…Ø¶Ø§ÙÙˆÙ†."})]})]}),e("div",{className:"flex-shrink-0 mt-6 flex justify-end",children:e("button",{type:"button",onClick:n,className:"px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors",children:"Ø¥ØºÙ„Ø§Ù‚"})})]})})},b=({isOpen:a,onClose:n,month:r,students:l,groups:s,donations:o,onAddDonation:i,onDeleteDonation:d})=>{const[c,u]=m.useState(!1),[g,p]=m.useState(""),[x,b]=m.useState(""),[f,y]=m.useState(""),N=m.useMemo(()=>{const e=new Map(s.map(e=>[e.id,e.name])),t={};return l.forEach(a=>{a.fees.filter(e=>e.month===r&&e.paid&&e.amountPaid).forEach(n=>{const r=e.get(a.groupId)||"Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù…ÙˆØ¹Ø©";t[r]||(t[r]={total:0,count:0}),t[r].total+=n.amountPaid||0,t[r].count+=1})}),Object.entries(t).map(([e,t])=>({groupName:e,...t})).sort((e,t)=>t.total-e.total)},[l,r,s]),v=m.useMemo(()=>(o||[]).filter(e=>e.month===r),[o,r]),w=m.useMemo(()=>v.reduce((e,t)=>e+t.amount,0),[v]),S=m.useMemo(()=>N.reduce((e,t)=>e+t.total,0),[N]);if(!a)return null;const E=new Date(r+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"});return e("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-[95vw] h-[90vh] flex flex-col overflow-hidden",children:[t("div",{className:"flex-shrink-0 flex justify-between items-center mb-4 border-b pb-3",children:[t("h2",{className:"text-2xl font-bold text-gray-700",children:["ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯Ø®Ù„ Ù„Ø´Ù‡Ø± ",E]}),e("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:e(h,{className:"w-6 h-6"})})]}),e("div",{className:"flex-grow overflow-y-auto pr-2",children:t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t("div",{children:[t("h3",{className:"text-lg font-bold text-gray-800 mb-4 pb-2 border-b",children:["Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ (",S.toLocaleString()," EGP)"]}),N.length>0?e("div",{className:"space-y-3",children:N.map(a=>t("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-shadow",children:[t("div",{className:"flex justify-between items-center mb-2 border-b border-gray-200 pb-2",children:[e("h4",{className:"font-bold text-gray-800",children:a.groupName}),t("span",{className:"bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded-full",children:[a.count," Ø·Ù„Ø§Ø¨"]})]}),t("div",{className:"flex justify-between items-center",children:[e("span",{className:"text-gray-500 text-sm",children:"Ø§Ù„Ù…Ø­ØµÙ„:"}),t("span",{className:"text-lg font-bold text-green-600",children:[a.total.toLocaleString()," EGP"]})]})]},a.groupName))}):e("p",{className:"text-center text-gray-400 py-8 bg-gray-50 rounded-xl",children:"Ù„Ù… ÙŠØªÙ… ØªØ­ØµÙŠÙ„ Ø£ÙŠ Ù…ØµØ±ÙˆÙØ§Øª"})]}),t("div",{children:[t("div",{className:"flex justify-between items-center mb-4 pb-2 border-b",children:[t("h3",{className:"text-lg font-bold text-gray-800",children:["Ø§Ù„ØªØ¨Ø±Ø¹Ø§Øª (",w.toLocaleString()," EGP)"]}),e("button",{onClick:()=>u(!c),className:"w-8 h-8 rounded-full bg-purple-600 text-white flex items-center justify-center hover:bg-purple-700 transition-colors",title:"Ø¥Ø¶Ø§ÙØ© ØªØ¨Ø±Ø¹",children:e("span",{className:"text-xl font-bold",children:c?"âˆ’":"+"})})]}),c&&e("div",{className:"bg-purple-50 rounded-xl p-4 mb-3 border border-purple-200",children:t("div",{className:"space-y-3",children:[t("div",{children:[e("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹"}),e("input",{type:"text",value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹"})]}),t("div",{children:[e("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e("input",{type:"number",value:x,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº",min:"0",step:"any"})]}),t("div",{children:[e("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e("input",{type:"text",value:f,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"})]}),t("div",{className:"flex gap-2",children:[e("button",{type:"button",onClick:()=>{if(!g.trim()||!x||parseFloat(x)<=0)alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹ ÙˆØ§Ù„Ù…Ø¨Ù„Øº");else try{i({donorName:g.trim(),amount:parseFloat(x),date:(new Date).toISOString().split("T")[0],month:r,notes:f.trim(),addedBy:"director"}),p(""),b(""),y(""),u(!1)}catch(e){alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸.")}},className:"flex-1 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold transition-colors",children:"Ø­ÙØ¸"}),e("button",{type:"button",onClick:()=>u(!1),className:"flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition-colors",children:"Ø¥Ù„ØºØ§Ø¡"})]})]})}),v.length>0?e("div",{className:"space-y-3",children:v.map(a=>t("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-100 shadow-sm hover:shadow-md transition-shadow group",children:[t("div",{className:"flex justify-between items-center mb-2",children:[t("div",{className:"flex items-center gap-2",children:[e("h4",{className:"font-bold text-gray-800",children:a.donorName}),e("span",{className:"text-gray-400 text-xs",children:"|"}),t("span",{className:"text-sm font-bold text-purple-600 dir-ltr",children:[a.amount.toLocaleString()," EGP"]})]}),e("button",{onClick:()=>d(a.id),className:"text-red-300 hover:text-red-600 hover:bg-red-50 p-1.5 rounded-full transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100",title:"Ø­Ø°Ù Ø§Ù„ØªØ¨Ø±Ø¹",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),a.notes&&e("p",{className:"text-xs text-gray-500 mt-1",children:a.notes}),e("p",{className:"text-xs text-gray-400 mt-1",children:new Date(a.date).toLocaleDateString("ar-EG")})]},a.id))}):e("p",{className:"text-center text-gray-400 py-8 bg-gray-50 rounded-xl",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ø±Ø¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©"})]})]})}),t("div",{className:"flex-shrink-0 mt-4 pt-4 border-t flex justify-between items-center",children:[e("h3",{className:"text-lg font-bold text-gray-800",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:"}),t("span",{className:"text-2xl font-bold text-green-700",children:[S.toLocaleString()," EGP"]})]})]})})},f={[r.RENT]:"Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±",[r.DEVELOPMENT]:"ØªÙ†Ù…ÙŠØ© ÙˆØªØ·ÙˆÙŠØ±",[r.UTILITIES]:"ÙÙˆØ§ØªÙŠØ± ÙˆÙ…Ø±Ø§ÙÙ‚",[r.TEACHER_SALARY]:"Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†",[r.STAFF_SALARY]:"Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",[r.SUPERVISOR_SALARY]:"Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†",[r.TEACHER_BONUS]:"Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†",[r.OTHER]:"Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰"},y=({isOpen:a,onClose:n,month:s,expenses:o,onDeleteExpense:i,onLogExpense:d})=>{const[c,u]=m.useState(!1),[g,p]=m.useState(""),[x,b]=m.useState(""),[y,N]=m.useState(""),[v,w]=m.useState(r.OTHER),S=m.useMemo(()=>{const e=o.filter(e=>{if([r.TEACHER_SALARY,r.SUPERVISOR_SALARY,r.STAFF_SALARY,r.TEACHER_BONUS].includes(e.category)){const t=e.description.match(/Ø´Ù‡Ø± (\d{4}-\d{2})/);if(t&&t[1])return t[1]===s}return e.date.startsWith(s)}),t=e.filter(e=>e.category===r.TEACHER_SALARY||e.category===r.STAFF_SALARY||e.category===r.SUPERVISOR_SALARY||e.category===r.TEACHER_BONUS),a={};e.filter(e=>e.category!==r.TEACHER_SALARY&&e.category!==r.STAFF_SALARY&&e.category!==r.SUPERVISOR_SALARY&&e.category!==r.TEACHER_BONUS).forEach(e=>{a[e.category]||(a[e.category]={total:0,items:[]}),a[e.category].total+=e.amount,a[e.category].items.push(e)});const n=t.reduce((e,t)=>e+t.amount,0),l=Object.values(a).reduce((e,t)=>e+(t?.total||0),0),i=n+l;return{salaries:t.sort((e,t)=>e.description.localeCompare(t.description,"ar")),generalExpenses:Object.entries(a),totalSalaries:n,totalGeneral:l,grandTotal:i}},[o,s]),E=()=>{const e=new Date,t=e.toISOString().substring(0,7);return s===t?e.toISOString().split("T")[0]:`${s}-01`};if(!a)return null;const A=new Date(s+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"});return e("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-[95vw] h-[90vh] flex flex-col overflow-hidden",children:[t("div",{className:"flex-shrink-0 flex justify-between items-center mb-4 border-b pb-3",children:[t("h2",{className:"text-2xl font-bold text-gray-700",children:["ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù„Ø´Ù‡Ø± ",A]}),e("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:e(h,{className:"w-6 h-6"})})]}),t("div",{className:"flex-grow overflow-y-auto pr-2 grid grid-cols-1 md:grid-cols-2 gap-6",children:[t("div",{children:[t("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:["Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª (",S.totalSalaries.toLocaleString()," EGP)"]}),e("div",{className:"space-y-2",children:S.salaries.length>0?S.salaries.map(a=>t("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded group",children:[e("span",{className:"text-sm text-gray-700",children:a.description}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-semibold text-red-600",children:[a.amount.toLocaleString()," EGP"]}),e("button",{onClick:()=>{window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§ØªØ¨ØŸ")&&i(a.id)},className:"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"Ø­Ø°Ù",children:e(l,{className:"w-4 h-4"})})]})]},a.id)):e("p",{className:"text-sm text-gray-400",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§ØªØ¨ Ù…Ø³Ø¬Ù„Ø©."})})]}),t("div",{children:[t("div",{className:"flex justify-between items-center mb-2",children:[t("h3",{className:"font-bold text-lg text-gray-800",children:["Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (",S.totalGeneral.toLocaleString()," EGP)"]}),e("button",{onClick:()=>u(!c),className:"p-1 bg-green-100 text-green-600 rounded-full hover:bg-green-200 transition-colors",title:"Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})})})]}),c&&t("div",{className:"bg-green-50 p-3 rounded-lg mb-4 border border-green-100 animate-fadeIn",children:[t("h4",{className:"text-sm font-bold text-green-800 mb-2",children:["ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯ (",s,")"]}),t("div",{className:"space-y-2",children:[t("div",{className:"grid grid-cols-2 gap-2",children:[e("input",{type:"number",placeholder:"Ø§Ù„Ù…Ø¨Ù„Øº",value:g,onChange:e=>p(e.target.value),className:"w-full text-sm p-1.5 border rounded focus:ring-1 focus:ring-green-500"}),t("select",{value:v,onChange:e=>w(e.target.value),className:"w-full text-sm p-1.5 border rounded focus:ring-1 focus:ring-green-500",children:[e("option",{value:r.OTHER,children:"Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰"}),e("option",{value:r.RENT,children:"Ø¥ÙŠØ¬Ø§Ø±"}),e("option",{value:r.UTILITIES,children:"Ù…Ø±Ø§ÙÙ‚"}),e("option",{value:r.DEVELOPMENT,children:"ØªØ·ÙˆÙŠØ±"})]})]}),e("input",{type:"text",placeholder:"Ù„Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯)",value:x,onChange:e=>b(e.target.value),className:"w-full text-sm p-1.5 border rounded focus:ring-1 focus:ring-green-500"}),e("input",{type:"text",placeholder:"Ø³Ø¨Ø¨ Ø§Ù„Ù…ØµØ±ÙˆÙ",value:y,onChange:e=>N(e.target.value),className:"w-full text-sm p-1.5 border rounded focus:ring-1 focus:ring-green-500"}),t("div",{className:"flex gap-2 pt-1",children:[e("button",{type:"button",onClick:async e=>{if(e.preventDefault(),g&&x&&y)if("function"==typeof d)try{const e={date:E(),category:v,description:`Ù„Ù…Ù†: ${x} - Ø§Ù„Ø³Ø¨Ø¨: ${y}`,amount:parseFloat(g)||0};await d(e),p(""),b(""),N(""),u(!1),alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­")}catch(t){alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ")}else alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¯Ø§Ø®Ù„ÙŠ: ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.");else alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„")},disabled:!g||!x||!y,className:"flex-1 bg-green-600 text-white text-xs font-bold py-1.5 rounded hover:bg-green-700 disabled:opacity-50",children:"Ø­ÙØ¸"}),e("button",{type:"button",onClick:()=>u(!1),className:"px-3 bg-gray-200 text-gray-700 text-xs font-bold py-1.5 rounded hover:bg-gray-300",children:"Ø¥Ù„ØºØ§Ø¡"})]})]})]}),e("div",{className:"space-y-2",children:S.generalExpenses.length>0?S.generalExpenses.map(([a,n])=>t("div",{className:"bg-gray-50 p-2 rounded",children:[t("div",{className:"flex justify-between items-center font-semibold mb-1",children:[e("span",{className:"text-gray-700",children:f[a]}),t("span",{className:"text-red-600",children:[n?.total.toLocaleString()," EGP"]})]}),e("ul",{className:"text-xs text-gray-500 space-y-1",children:n?.items.map(a=>t("li",{className:"flex justify-between items-center group pl-2",children:[t("span",{children:["- ",a.description," (",a.amount.toLocaleString(),")"]}),e("button",{onClick:()=>{window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ")&&i(a.id)},className:"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"Ø­Ø°Ù",children:e(l,{className:"w-3 h-3"})})]},a.id))})]},a)):e("p",{className:"text-sm text-gray-400",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ø¹Ø§Ù…Ø© Ù…Ø³Ø¬Ù„Ø©."})})]})]}),t("div",{className:"flex-shrink-0 mt-4 pt-4 border-t flex justify-between items-center",children:[e("h3",{className:"text-lg font-bold text-gray-800",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:"}),t("span",{className:"text-2xl font-bold text-red-700",children:[S.grandTotal.toLocaleString()," EGP"]})]})]})})},N=({isOpen:a,onClose:n,month:r,collectionsSummary:l})=>{if(!a)return null;const s=new Date(r+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"});return e("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-2xl shadow-2xl p-6 w-full max-w-[95vw] h-[90vh] flex flex-col overflow-hidden",children:[t("div",{className:"flex-shrink-0 flex justify-between items-center mb-4 border-b pb-3",children:[t("h2",{className:"text-2xl font-bold text-gray-700",children:["ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© - ",s]}),e("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:e(h,{className:"w-6 h-6"})})]}),e("div",{className:"flex-grow overflow-y-auto pr-2",children:l.details.length>0?e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.details.map(a=>t("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100 shadow-sm flex items-center justify-between hover:shadow-md transition-shadow",children:[t("div",{children:[e("h3",{className:"font-bold text-gray-800 text-lg",children:a.teacherName}),e("span",{className:"text-xs text-gray-500",children:"Ù…Ø¯Ø±Ø³"})]}),t("div",{className:"text-left",children:[t("span",{className:"block text-xl font-bold text-blue-600",children:[a.amount.toLocaleString()," EGP"]}),e("span",{className:"text-xs text-green-600",children:"ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"})]})]},a.teacherId))}):e("p",{className:"text-center text-gray-500 py-8",children:"Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙŠ Ù…Ø¨Ø§Ù„Øº Ù…Ù† Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ø®Ù„Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±."})}),t("div",{className:"flex-shrink-0 mt-4 pt-4 border-t flex justify-between items-center",children:[e("h3",{className:"text-lg font-bold text-gray-800",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:"}),t("span",{className:"text-2xl font-bold text-blue-700",children:[l.totalReceived.toLocaleString()," EGP"]})]})]})})},v=({isOpen:a,onClose:n,teachers:r,groups:l,students:i,teacherAttendance:d,onApplyDeductions:c})=>{const[h,u]=m.useState(()=>{const e=new Date;return e.setDate(e.getDate()-1),e.toISOString().split("T")[0]}),[g,p]=m.useState([]),[x,b]=m.useState(!1);return a?e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[t("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50 rounded-t-xl",children:[e("h2",{className:"text-xl font-bold text-gray-800",children:"Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ù„ÙŠÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©"}),e("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),t("div",{className:"p-6 space-y-6",children:[t("div",{className:"flex items-end gap-4",children:[t("div",{className:"flex-1",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù‚Ù‚"}),e("input",{type:"date",value:h,onChange:e=>{u(e.target.value),b(!1)},className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e("button",{onClick:()=>{const e=(e=>{const t=new Date(e);return[s.SUNDAY,s.MONDAY,s.TUESDAY,s.WEDNESDAY,s.THURSDAY,s.FRIDAY,s.SATURDAY][t.getDay()]})(h);if(e===s.THURSDAY||e===s.FRIDAY)return alert("ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø®Ù…ÙŠØ³ ÙˆØ§Ù„Ø¬Ù…Ø¹Ø© Ø¹Ø·Ù„Ø© Ø±Ø³Ù…ÙŠØ© ÙˆÙ„Ø§ ÙŠØªØ·Ù„Ø¨Ø§Ù† ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ©."),p([]),void b(!0);const t=[];r.filter(e=>"active"===e.status).forEach(a=>{if(d.find(e=>e.teacherId===a.id&&e.date===h))return;const n=l.filter(e=>e.teacherId===a.id);let r=!1,s=!1;for(const t of n){const a=i.filter(e=>e.groupId===t.id&&!e.isArchived);a.some(t=>t.schedule?.some(t=>t.day===e&&t.isEnabled))&&(r=!0);a.some(e=>e.attendance.some(e=>e.date===h))&&(s=!0)}r&&!s&&t.push({teacher:a,reason:"Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ù„Ø£ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…"})}),p(t),b(!0)},className:"px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-colors",children:"ÙØ­Øµ Ø§Ù„Ø³Ø¬Ù„Ø§Øª"})]}),x&&t("div",{className:"space-y-4",children:[t("h3",{className:"font-bold text-lg text-gray-800 border-b pb-2",children:["Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (",g.length," Ù…Ø¯Ø±Ø³ Ù…Ø®Ø§Ù„Ù)"]}),g.length>0?e("div",{className:"bg-red-50 border border-red-100 rounded-lg overflow-hidden",children:t("table",{className:"w-full text-sm text-right",children:[e("thead",{className:"bg-red-100 text-red-800",children:t("tr",{children:[e("th",{className:"p-3",children:"Ø§Ù„Ù…Ø¯Ø±Ø³"}),e("th",{className:"p-3",children:"Ø§Ù„Ø³Ø¨Ø¨"}),e("th",{className:"p-3",children:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù‚ØªØ±Ø­"})]})}),e("tbody",{className:"divide-y divide-red-100",children:g.map((a,n)=>t("tr",{children:[e("td",{className:"p-3 font-medium text-gray-800",children:a.teacher.name}),e("td",{className:"p-3 text-gray-600",children:a.reason}),e("td",{className:"p-3 text-red-600 font-bold",children:"Ø®ØµÙ… Ø±Ø¨Ø¹ ÙŠÙˆÙ…"})]},n))})]})}):e("div",{className:"text-center py-8 bg-green-50 rounded-lg border border-green-100",children:e("p",{className:"text-green-700 font-bold text-lg",children:"Ù…Ù…ØªØ§Ø²! Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ù‚Ø§Ù…ÙˆØ§ Ø¨ØªØ³Ù„ÙŠÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…."})})]})]}),t("div",{className:"p-6 border-t border-gray-100 bg-gray-50 rounded-b-xl flex justify-end gap-3",children:[e("button",{onClick:n,className:"px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-lg font-medium",children:"Ø¥Ù„ØºØ§Ø¡"}),x&&g.length>0&&e("button",{onClick:()=>{const e=[],t=[];g.forEach(({teacher:a})=>{const n=`auto-missed-${a.id}-${h}`;e.push({id:n,teacherId:a.id,date:h,status:o.MISSING_REPORT,reason:"Ù„Ù… ÙŠØ³Ù„Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ"}),t.push({id:`notif-missed-${a.id}-${h}`,date:(new Date).toISOString(),content:`ØªÙ… Ø®ØµÙ… Ø±Ø¨Ø¹ ÙŠÙˆÙ… Ù…Ù† Ø±Ø§ØªØ¨Ùƒ Ù„Ø¹Ø¯Ù… ØªØ³Ù„ÙŠÙ… ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ù„ÙŠÙˆÙ… ${h}.`,senderName:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",target:{type:"teacher",id:a.id},readBy:[],deletedBy:[]})}),c(e,t),n(),b(!1),p([])},className:"px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 shadow-md transition-all transform hover:scale-105",children:"ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"})]})]})}):null},w={[r.RENT]:"Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±",[r.DEVELOPMENT]:"ØªÙ†Ù…ÙŠØ© ÙˆØªØ·ÙˆÙŠØ±",[r.UTILITIES]:"ÙÙˆØ§ØªÙŠØ± ÙˆÙ…Ø±Ø§ÙÙ‚",[r.TEACHER_SALARY]:"Ø±Ø§ØªØ¨ Ù…Ø¯Ø±Ø³",[r.STAFF_SALARY]:"Ø±Ø§ØªØ¨ Ù…ÙˆØ¸Ù",[r.SUPERVISOR_SALARY]:"Ø±Ø§ØªØ¨ Ù…Ø´Ø±Ù",[r.TEACHER_BONUS]:"Ù…ÙƒØ§ÙØ£Ø© Ù…Ø¯Ø±Ø³",[r.OTHER]:"Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰"},S=e=>{switch(e){case o.ABSENT:return 1;case o.HALF_DAY:return.5;case o.QUARTER_DAY:return.25;case o.DEDUCTION_FULL_DAY:return 1;case o.DEDUCTION_HALF_DAY:return.5;case o.DEDUCTION_QUARTER_DAY:case o.MISSING_REPORT:return.25;default:return 0}},E=e=>{switch(e){case o.BONUS_DAY:return 1;case o.BONUS_HALF_DAY:return.5;case o.BONUS_QUARTER_DAY:return.25;default:return 0}},A=a=>{const{onBack:n,students:s,teachers:h,staff:u,supervisors:g,expenses:f,teacherAttendance:A,teacherPayrollAdjustments:C,financialSettings:R,onLogExpense:L,onDeleteExpense:D,onUpdatePayrollAdjustments:T,onSetTeacherAttendance:I,onAddStaff:P,onUpdateStaff:_,onDeleteStaff:O,onUpdateFinancialSettings:j,groups:U,onResetTeacherPayment:F,onResetStaffPayment:Y,teacherCollections:$,onViewTeacherDetails:G,onApplyDeductions:H,donations:M,onAddDonation:B,onDeleteDonation:V,onAddHoliday:W}=a,[z,Q]=m.useState("overview"),[q,X]=m.useState(()=>(new Date).toISOString().substring(0,7)),[J,K]=m.useState(!1),[Z,ee]=m.useState(null),[te,ae]=m.useState(!1),[ne,re]=m.useState(!1),[le,se]=m.useState(!1),[oe,ie]=m.useState(!1),[de,ce]=m.useState("all"),[me,he]=m.useState("active"),[ue,ge]=m.useState(null),pe=m.useMemo(()=>{const e=$.filter(e=>e.month===q),t=e.reduce((e,t)=>e+t.amount,0),a={};e.forEach(e=>{a[e.teacherId]=(a[e.teacherId]||0)+e.amount});const n=new Map(h.map(e=>[e.id,e.name]));return{totalReceived:t,details:Object.entries(a).map(([e,t])=>({teacherId:e,teacherName:n.get(e)||"Ù…Ø¯Ø±Ø³ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",amount:t})).sort((e,t)=>t.amount-e.amount)}},[$,h,q]),xe=m.useMemo(()=>{const e=s.flatMap(e=>e.fees).filter(e=>e.month===q&&e.paid&&e.amountPaid).reduce((e,t)=>e+t.amountPaid,0),t=(M||[]).filter(e=>e.month===q).reduce((e,t)=>e+t.amount,0),a=f.filter(e=>{if([r.TEACHER_SALARY,r.SUPERVISOR_SALARY,r.STAFF_SALARY,r.TEACHER_BONUS].includes(e.category)){const t=e.description.match(/Ø´Ù‡Ø± (\d{4}-\d{2})/);if(t&&t[1])return t[1]===q}return e.date.startsWith(q)}).reduce((e,t)=>e+t.amount,0);return{income:e,totalDonations:t,totalExpenses:a,net:pe.totalReceived+t-a}},[s,f,q,pe.totalReceived,M]),be=e=>{const t="py-3 px-2 sm:px-6 font-semibold text-center flex-grow sm:w-1/4 transition-colors duration-200 focus:outline-none text-sm sm:text-base";return z===e?`${t} border-b-2 border-green-600 text-green-600`:`${t} text-gray-500 hover:bg-gray-100`};return m.useEffect(()=>{const e=e=>{if("Escape"===e.key){if(J)return void K(!1);if(te)return void ae(!1);if(ne)return void re(!1);if(le)return void se(!1);if(oe)return void ie(!1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[J,te,ne,le,oe]),t("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[t("div",{className:"border-b border-gray-200 flex flex-wrap",children:[e("button",{onClick:()=>Q("overview"),className:be("overview"),children:"Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©"}),e("button",{onClick:()=>Q("teacher_payroll"),className:be("teacher_payroll"),children:"Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ†"}),e("button",{onClick:()=>Q("staff_expenses"),className:be("staff_expenses"),children:"Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†"}),e("button",{onClick:()=>Q("settings"),className:be("settings"),children:t("div",{className:"flex items-center justify-center gap-1 sm:gap-2",children:[e(p,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"})]})})]}),t("div",{className:"p-4 sm:p-6",children:[t("div",{className:"mb-6 max-w-xs",children:[e("label",{htmlFor:"month-filter",className:"block text-sm font-medium text-gray-600 mb-1",children:"Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‡Ø±"}),e("input",{type:"month",id:"month-filter",value:q,onChange:e=>X(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),"overview"===z&&t("div",{className:"space-y-6",children:[e("h3",{className:"text-xl font-bold text-gray-800 text-center",children:"Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯"}),t("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[t("button",{onClick:()=>ae(!0),className:"text-right bg-green-100 p-6 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-400",children:[e("p",{className:"text-lg text-green-800 font-semibold",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„"}),t("p",{className:"text-4xl font-bold text-green-600 mt-2",children:[i(xe.income).toLocaleString()," EGP"]}),e("span",{className:"text-xs text-green-700 mt-2 block",children:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©"})]}),t("button",{onClick:()=>re(!0),className:"text-right bg-red-100 p-6 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400",children:[e("p",{className:"text-lg text-red-800 font-semibold",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"}),t("p",{className:"text-4xl font-bold text-red-600 mt-2",children:[i(xe.totalExpenses).toLocaleString()," EGP"]}),e("span",{className:"text-xs text-red-700 mt-2 block",children:"Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¹Ø§Ù…Ø©"})]}),t("button",{onClick:()=>se(!0),className:"text-right bg-cyan-100 p-6 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-cyan-400",children:[e("p",{className:"text-lg text-cyan-800 font-semibold",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù…"}),t("p",{className:"text-4xl font-bold text-cyan-600 mt-2",children:[i(pe.totalReceived).toLocaleString()," EGP"]}),e("span",{className:"text-xs text-cyan-700 mt-2 block",children:"Ù…Ù† ØªØ­ØµÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†"})]}),t("button",{onClick:()=>ae(!0),className:"text-right bg-purple-100 p-6 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-400",children:[e("p",{className:"text-lg text-purple-800 font-semibold",children:"Ø§Ù„ØªØ¨Ø±Ø¹Ø§Øª"}),t("p",{className:"text-4xl font-bold text-purple-600 mt-2",children:[i(xe.totalDonations).toLocaleString()," EGP"]}),e("span",{className:"text-xs text-purple-700 mt-2 block",children:"ØªØ¨Ø±Ø¹Ø§Øª Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ"})]}),t("div",{className:"text-right p-6 rounded-lg "+(xe.net>=0?"bg-blue-100":"bg-orange-100"),children:[e("p",{className:"text-lg font-semibold "+(xe.net>=0?"text-blue-800":"text-orange-800"),children:"ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ / Ø§Ù„Ø®Ø³Ø§Ø±Ø©"}),t("p",{className:"text-4xl font-bold mt-2 "+(xe.net>=0?"text-blue-600":"text-orange-600"),children:[i(xe.net).toLocaleString()," EGP"]}),e("span",{className:"text-xs mt-2 block "+(xe.net>=0?"text-blue-700":"text-orange-700"),children:"Ø§Ù„Ù…Ø³ØªÙ„Ù… + Ø§Ù„ØªØ¨Ø±Ø¹Ø§Øª - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª"})]})]})]}),"teacher_payroll"===z&&t("div",{className:"space-y-6",children:[e("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4",children:t("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e("div",{className:"flex p-1 bg-gray-100 rounded-lg overflow-x-auto",children:["all","ØªÙ„Ù‚ÙŠÙ†","Ù†ÙˆØ± Ø¨ÙŠØ§Ù†","Ù‚Ø±Ø¢Ù†"].map(t=>e("button",{onClick:()=>ce(t),className:"flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap "+(de===t?"bg-white text-green-700 shadow-sm":"text-gray-500 hover:text-gray-700"),children:"all"===t?"Ø§Ù„ÙƒÙ„":t},t))}),e("div",{className:"flex p-1 bg-gray-100 rounded-lg overflow-x-auto",children:["active","inactive"].map(t=>e("button",{onClick:()=>he(t),className:"flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap "+(me===t?"bg-white text-blue-700 shadow-sm":"text-gray-500 hover:text-gray-700"),children:"active"===t?"Ù†Ø´Ø·":"ØºÙŠØ± Ù†Ø´Ø·"},t))})]})}),[...h.filter(e=>e.status===me).map(e=>({...e,type:"teacher"})),..."active"===me?g.map(e=>({...e,type:"supervisor",status:"active",phone:""})):[]].filter(e=>{if("all"===de)return!0;if("teacher"===e.type){return U.filter(t=>t.teacherId===e.id).some(e=>e.name.includes(de))}return e.section?.includes(de)}).sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(a=>{let n=0;if("teacher"===a.type){const e=U.filter(e=>e.teacherId===a.id);n=s.filter(t=>e.some(e=>e.id===t.groupId)).flatMap(e=>e.fees).filter(e=>e.month===q&&e.paid&&e.amountPaid).reduce((e,t)=>e+(t.amountPaid||0),0)}const m="teacher"===a.type&&a.paymentType===d.PARTNERSHIP,h=m?0:a.salary||0,u=m&&a.partnershipPercentage||0,g=m?n*u/100:0,p=C.find(e=>e.teacherId===a.id&&e.month===q)||{bonus:0,isPaid:!1},x=A.filter(e=>e.teacherId===a.id&&e.date.startsWith(q)),b=m?g:h,f=x.filter(e=>S(e.status)>0).map(e=>{const t=S(e.status),a=b>0&&R.workingDaysPerMonth>0?b/R.workingDaysPerMonth:0,n=i(a*t*(R.absenceDeductionPercentage/100));let r="Ø®ØµÙ…";return e.status===o.DEDUCTION_FULL_DAY?r="Ø®ØµÙ… ÙŠÙˆÙ… ÙƒØ§Ù…Ù„":e.status===o.DEDUCTION_HALF_DAY?r="Ø®ØµÙ… Ù†ØµÙ ÙŠÙˆÙ…":e.status===o.DEDUCTION_QUARTER_DAY?r="Ø®ØµÙ… Ø±Ø¨Ø¹ ÙŠÙˆÙ…":e.status===o.MISSING_REPORT?r="Ø¹Ø¯Ù… ØªØ³Ù„ÙŠÙ… ØªÙ‚Ø±ÙŠØ±":e.status===o.ABSENT?r="ØºÙŠØ§Ø¨":e.status===o.HALF_DAY?r="Ø®ØµÙ… Ù†ØµÙ ÙŠÙˆÙ…":e.status===o.QUARTER_DAY&&(r="Ø®ØµÙ… Ø±Ø¨Ø¹ ÙŠÙˆÙ…"),e.reason&&(r+=` (${e.reason})`),{date:e.date,reason:r,amount:n}}),y=f.reduce((e,t)=>e+t.amount,0),N=[];x.filter(e=>E(e.status)>0).forEach(e=>{const t=E(e.status),a=b>0&&R.workingDaysPerMonth>0?b/R.workingDaysPerMonth:0,n=i(a*t);let r="Ù…ÙƒØ§ÙØ£Ø©";e.status===o.BONUS_DAY?r="Ù…ÙƒØ§ÙØ£Ø© ÙŠÙˆÙ… ÙƒØ§Ù…Ù„":e.status===o.BONUS_HALF_DAY?r="Ù…ÙƒØ§ÙØ£Ø© Ù†ØµÙ ÙŠÙˆÙ…":e.status===o.BONUS_QUARTER_DAY&&(r="Ù…ÙƒØ§ÙØ£Ø© Ø±Ø¨Ø¹ ÙŠÙˆÙ…"),e.reason&&(r+=` (${e.reason})`),N.push({date:e.date,reason:r,amount:n})}),p.bonus>0&&N.push({date:q,reason:"Ù…ÙƒØ§ÙØ£Ø© Ø¥Ø¶Ø§ÙÙŠØ©",amount:p.bonus,isManual:!0});const v=N.reduce((e,t)=>e+t.amount,0),w=i(m?g+v-y:h+v-y),k="teacher"===a.type?"Ù…Ø¯Ø±Ø³":"Ù…Ø´Ø±Ù",D=ue===a.id;let P=`\nØ§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡\nØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø§ØªØ¨ Ù„Ø´Ù‡Ø±: ${q}\nØ§Ù„Ø§Ø³Ù…: ${a.name} (${k})\n`;return P+=m?`\nÙ†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©: Ø´Ø±Ø§ÙƒØ© (${u}%)\nØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ØµÙ‘Ù„: ${n.toLocaleString()}\nÙ†ØµÙŠØ¨Ùƒ Ù…Ù† Ø§Ù„Ù…Ø­ØµÙ„: ${g.toFixed(2)}\n`:`\nØ§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${h.toLocaleString()}\n`,P+=`\nðŸ”´ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª: ${y.toLocaleString()}\n${f.length>0?f.map(e=>`- ${e.date}: ${e.reason} (${e.amount.toFixed(0)})`).join("\n"):"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®ØµÙˆÙ…Ø§Øª"}\n\nðŸŸ¢ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª: ${v.toLocaleString()}\n${N.length>0?N.map(e=>`- ${e.date}: ${e.reason} (${e.amount.toFixed(0)})`).join("\n"):"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙƒØ§ÙØ¢Øª"}\n\nðŸ’° Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${w.toLocaleString()} Ø¬Ù†ÙŠÙ‡\n\nÙ…Ø¹ ØªØ­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©\n`.trim(),t("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 mb-4 transition-all duration-300",children:[t("div",{className:"px-6 py-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 transition-colors "+(D?"bg-gray-50 border-b border-gray-100":""),onClick:()=>ge(D?null:a.id),children:[e("div",{className:"flex items-center gap-3",children:t("h3",{className:"text-xl font-bold text-gray-800",children:[a.name,t("span",{className:"text-sm font-normal text-gray-500 mr-2",children:["(",k,")"]})]})}),t("div",{className:"flex items-center gap-6",children:[t("div",{className:"text-left hidden sm:block",children:[e("p",{className:"text-xs text-gray-500",children:"Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}),t("p",{className:"text-lg font-bold text-blue-600",children:[w.toLocaleString()," EGP"]})]}),e("svg",{className:"w-6 h-6 text-gray-400 transition-transform duration-300 "+(D?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})]}),D&&t(c,{children:[t("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-8 bg-white",children:[t("div",{children:[t("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-red-100",children:[t("h4",{className:"font-bold text-red-600 flex items-center gap-2",children:[e("span",{children:"ðŸ”´"})," Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª"]}),e("span",{className:"font-bold text-red-600",children:y.toFixed(2)})]}),e("div",{className:"space-y-2 text-sm",children:f.length>0?f.map((n,r)=>t("div",{className:"flex justify-between items-center text-gray-600 bg-red-50 p-2 rounded group",children:[t("span",{children:[n.reason," ",t("span",{className:"text-xs text-gray-400",children:["(",n.date,")"]})]}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-semibold",children:["-",n.amount.toFixed(0)]}),e("button",{onClick:e=>{e.stopPropagation(),window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø®ØµÙ…ØŸ")&&I(a.id,n.date,o.PRESENT)},className:"text-red-400 hover:text-red-600 p-1 rounded-full hover:bg-red-100 transition-colors opacity-0 group-hover:opacity-100",title:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø®ØµÙ…",children:e(l,{className:"w-4 h-4"})})]})]},r)):e("p",{className:"text-gray-400 text-center py-2",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®ØµÙˆÙ…Ø§Øª"})})]}),t("div",{children:[t("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-green-100",children:[t("h4",{className:"font-bold text-green-600 flex items-center gap-2",children:[e("span",{children:"ðŸŸ¢"})," Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ÙˆØ§Ù„Ø¥Ø¶Ø§ÙÙŠ"]}),e("span",{className:"font-bold text-green-600",children:v.toFixed(2)})]}),t("div",{className:"space-y-2 text-sm",children:[N.map((n,r)=>t("div",{className:"flex justify-between items-center text-gray-600 bg-green-50 p-2 rounded group",children:[t("span",{children:[n.reason," ",t("span",{className:"text-xs text-gray-400",children:["(",n.date,")"]})]}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-semibold",children:["+",n.amount.toFixed(0)]}),e("button",{onClick:e=>{e.stopPropagation(),window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©ØŸ")&&(n.isManual?T({...p,teacherId:a.id,month:q,bonus:0}):I(a.id,n.date,o.PRESENT))},className:"text-red-400 hover:text-red-600 p-1 rounded-full hover:bg-red-100 transition-colors opacity-0 group-hover:opacity-100",title:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©",children:e(l,{className:"w-4 h-4"})})]})]},r)),t("div",{className:"flex items-center gap-2 mt-2 pt-2 border-t border-gray-100",children:[e("span",{className:"text-gray-600 whitespace-nowrap",children:"Ù…ÙƒØ§ÙØ£Ø© ÙŠØ¯ÙˆÙŠØ©:"}),e("input",{type:"number",value:p.bonus,onChange:e=>T({...p,teacherId:a.id,month:q,bonus:parseFloat(e.target.value)||0}),className:"w-24 p-1 text-sm border rounded focus:ring-1 focus:ring-green-500",placeholder:"0"})]})]})]})]}),t("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row justify-between items-center gap-4",children:[t("div",{className:"flex items-center gap-4",children:[e("div",{className:"text-center sm:text-right",children:t(c,m?{children:[t("p",{className:"text-sm text-gray-500",children:["Ù†ØµÙŠØ¨ Ø§Ù„Ø´Ø±Ø§ÙƒØ© (",u,"%)"]}),t("p",{className:"text-lg font-bold text-gray-800",children:[g.toFixed(2)," EGP"]})]}:{children:[e("p",{className:"text-sm text-gray-500",children:"Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ"}),t("p",{className:"text-lg font-bold text-gray-800",children:[h.toLocaleString()," EGP"]})]})}),t("div",{className:"text-center sm:text-right border-r pr-4 mr-4 border-gray-300",children:[e("p",{className:"text-sm text-gray-500",children:"Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚"}),t("p",{className:"text-2xl font-bold text-blue-600",children:[w.toLocaleString()," EGP"]})]})]}),t("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[p.isPaid?e("button",{onClick:()=>F(a.id,q,a.name),className:"flex-1 sm:flex-none py-2 px-6 rounded-lg bg-yellow-500 text-white font-bold hover:bg-yellow-600 transition-colors shadow-sm",children:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¯ÙØ¹"}):e("button",{onClick:()=>((e,t)=>{if(!t||t<=0)return;const a="teacher"===e.type?r.TEACHER_SALARY:r.SUPERVISOR_SALARY,n="teacher"===e.type?"Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø¯Ø±Ø³":"Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø´Ø±Ù";L({date:(new Date).toISOString().split("T")[0],category:a,description:`${n}: ${e.name} - Ø´Ù‡Ø± ${q}`,amount:t}),T({teacherId:e.id,month:q,bonus:C.find(t=>t.teacherId===e.id&&t.month===q)?.bonus||0,isPaid:!0})})(a,w),className:"flex-1 sm:flex-none py-2 px-6 rounded-lg bg-green-600 text-white font-bold hover:bg-green-700 transition-colors shadow-sm",children:"Ø¯ÙØ¹ Ø§Ù„Ø±Ø§ØªØ¨"}),e("a",{href:`https://wa.me/2${a.phone?.startsWith("0")?a.phone.substring(1):a.phone}?text=${encodeURIComponent(P)}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors shadow-sm flex items-center justify-center",title:"Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø§ØªØ¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})})})]})]})]})]},a.id)}),0===h.length&&0===g.length&&e("p",{className:"text-center text-gray-500 py-8",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¯Ø±Ø³ÙˆÙ† Ø£Ùˆ Ù…Ø´Ø±ÙÙˆÙ† ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©."})]}),"staff_expenses"===z&&t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e("div",{children:t("div",{className:"mb-8 border-b pb-6",children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"font-bold text-xl text-gray-800",children:"Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"}),e("button",{onClick:()=>{ee(null),K(!0)},className:"bg-blue-600 text-white font-bold py-1 px-3 rounded hover:bg-blue-700 text-sm",children:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"})]}),t("div",{className:"space-y-3",children:[u.map(a=>{return t("div",{className:"bg-gray-50 p-3 rounded-lg flex justify-between items-center",children:[t("div",{children:[t("p",{className:"font-semibold",children:[a.name," ",t("span",{className:"text-sm text-gray-500",children:["(",a.role,")"]})]}),t("p",{className:"text-sm text-gray-600",children:["Ø§Ù„Ø±Ø§ØªØ¨: ",a.salary.toLocaleString()," EGP"]})]}),(n=a.id,f.some(e=>{if(e.category!==r.STAFF_SALARY||!e.description.includes(`(${n})`))return!1;const t=e.description.match(/Ø´Ù‡Ø± (\d{4}-\d{2})/);return t&&t[1]?t[1]===q:e.date.startsWith(q)})?e("button",{onClick:()=>Y(a.id,q,a.name),className:"py-2 px-4 rounded bg-yellow-500 text-white font-bold hover:bg-yellow-600 text-sm",children:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¯ÙØ¹"}):e("button",{onClick:()=>{return e=a,void L({date:(new Date).toISOString().split("T")[0],category:r.STAFF_SALARY,description:`Ø±Ø§ØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù: ${e.name} (${e.id}) - Ø´Ù‡Ø± ${q}`,amount:e.salary});var e},className:"py-2 px-4 rounded bg-green-600 text-white font-bold hover:bg-green-700 text-sm",children:"Ø¯ÙØ¹"}))]},a.id);var n}),0===u.length&&e("p",{className:"text-gray-400 text-center py-4",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙˆÙ†."})]})]})}),t("div",{children:[e("h3",{className:"font-bold text-xl text-gray-800 mb-4",children:"Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¹Ø§Ù…Ø©"}),e(k,{onLogExpense:L}),e("h4",{className:"font-bold text-lg text-gray-700 mt-6 mb-2",children:"Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±"}),e("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:f.filter(e=>e.category!==r.STAFF_SALARY&&e.category!==r.TEACHER_SALARY&&e.category!==r.TEACHER_BONUS&&e.category!==r.SUPERVISOR_SALARY&&e.date.startsWith(q)).map(a=>t("div",{className:"bg-gray-50 p-3 rounded-lg flex justify-between items-center group",children:[t("div",{children:[e("p",{className:"font-semibold",children:w[a.category]}),e("p",{className:"text-sm text-gray-500",children:a.description})]}),t("div",{className:"flex items-center gap-2",children:[t("p",{className:"font-bold text-red-500",children:[a.amount.toLocaleString()," EGP"]}),e("button",{onClick:()=>{window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ")&&D(a.id)},className:"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"Ø­Ø°Ù",children:e(l,{className:"w-4 h-4"})})]})]},a.id))})]})]}),"settings"===z&&t("div",{children:[e("h3",{className:"font-bold text-xl text-gray-800 mb-4",children:"Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª"}),t("div",{className:"max-w-md space-y-6 bg-gray-50 p-6 rounded-lg",children:[t("div",{children:[e("label",{htmlFor:"workingDays",className:"block text-gray-600 mb-1 font-semibold",children:"Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø´Ù‡Ø±"}),e("input",{id:"workingDays",type:"number",value:R.workingDaysPerMonth,onChange:e=>j({...R,workingDaysPerMonth:parseInt(e.target.value)||0}),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ù…Ø«Ø§Ù„: 22"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¹Ù†Ø¯ Ø®ØµÙ… Ø§Ù„ØºÙŠØ§Ø¨."})]}),t("div",{children:[e("label",{htmlFor:"deductionPercentage",className:"block text-gray-600 mb-1 font-semibold",children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… Ù„Ù„ØºÙŠØ§Ø¨ (%)"}),e("input",{id:"deductionPercentage",type:"number",value:R.absenceDeductionPercentage,onChange:e=>j({...R,absenceDeductionPercentage:parseInt(e.target.value)||0}),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Ù…Ø«Ø§Ù„: 100"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"100% ØªØ¹Ù†ÙŠ Ø®ØµÙ… Ù‚ÙŠÙ…Ø© ÙŠÙˆÙ… ÙƒØ§Ù…Ù„. 150% ØªØ¹Ù†ÙŠ Ø®ØµÙ… ÙŠÙˆÙ… ÙˆÙ†ØµÙ (Ø¹Ù‚ÙˆØ¨Ø©)."})]}),t("div",{className:"border-t pt-4",children:[t("h4",{className:"font-bold text-gray-700 mb-2 flex items-center gap-2",children:[e("span",{children:"ðŸ“…"})," Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø³Ù…ÙŠØ©"]}),t("p",{className:"text-sm text-gray-600 mb-3 bg-blue-50 p-2 rounded",children:["â„¹ï¸ Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© ØªØ§Ø±ÙŠØ® Ù‡Ù†Ø§ØŒ Ø³ÙŠØªÙ… ",e("b",{children:"ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"})," Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†."]}),t("div",{className:"flex gap-2 mb-4",children:[e("input",{type:"date",id:"new-holiday",className:"flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"}),e("button",{onClick:()=>{const e=document.getElementById("new-holiday"),t=e.value;t&&!R.publicHolidays?.includes(t)&&(W?W(t):j({...R,publicHolidays:[...R.publicHolidays||[],t]}),e.value="")},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø²Ø©"})]}),t("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:[(R.publicHolidays||[]).sort().map(a=>t("div",{className:"flex justify-between items-center bg-white p-2 rounded border shadow-sm group",children:[e("span",{className:"text-gray-700 font-medium",children:new Date(a).toLocaleDateString("ar-EG",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e("button",{onClick:()=>{j({...R,publicHolidays:R.publicHolidays?.filter(e=>e!==a)})},className:"text-red-400 hover:text-red-600 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity p-1",children:e(l,{className:"w-4 h-4"})})]},a)),(!R.publicHolidays||0===R.publicHolidays.length)&&e("p",{className:"text-gray-400 text-sm text-center py-2",children:"Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø²Ø§Øª Ø±Ø³Ù…ÙŠØ© Ø¨Ø¹Ø¯."})]}),e("p",{className:"text-xs text-gray-500 mt-2",children:"Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø§Ø³ØªØ«Ù†Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†."})]})]})]})]})]}),e(x,{isOpen:J,onClose:()=>K(!1),onSave:P,staffList:u,onUpdate:_,onDelete:O,staffToEdit:Z,setStaffToEdit:ee}),e(b,{isOpen:te,onClose:()=>ae(!1),month:q,students:s,groups:U,donations:M,onAddDonation:B,onDeleteDonation:V},`income-modal-${M?M.length:0}`),e(y,{isOpen:ne,onClose:()=>re(!1),month:q,expenses:f,onDeleteExpense:D,onLogExpense:L}),e(N,{isOpen:le,onClose:()=>se(!1),month:q,collectionsSummary:pe}),e(v,{isOpen:oe,onClose:()=>ie(!1),teachers:h,groups:U,students:s,teacherAttendance:A,onApplyDeductions:H})]})},k=({onLogExpense:a})=>{const[n,l]=m.useState(r.RENT),[s,o]=m.useState(""),[i,d]=m.useState("");return t("form",{onSubmit:e=>{e.preventDefault(),s&&i&&(a({date:(new Date).toISOString().split("T")[0],category:n,description:s,amount:parseFloat(i)}),o(""),d(""))},className:"bg-gray-100 p-4 rounded-lg space-y-3",children:[e("h4",{className:"font-bold text-lg text-gray-700",children:"ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯"}),t("div",{children:[e("label",{className:"text-sm",children:"Ø§Ù„ÙØ¦Ø©"}),t("select",{value:n,onChange:e=>l(e.target.value),className:"w-full p-2 border rounded mt-1 bg-white",children:[e("option",{value:r.RENT,children:"Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±"}),e("option",{value:r.DEVELOPMENT,children:"ØªÙ†Ù…ÙŠØ© ÙˆØªØ·ÙˆÙŠØ±"}),e("option",{value:r.UTILITIES,children:"ÙÙˆØ§ØªÙŠØ± ÙˆÙ…Ø±Ø§ÙÙ‚"}),e("option",{value:r.OTHER,children:"Ù…ØµØ§Ø±ÙŠÙ Ø£Ø®Ø±Ù‰"})]})]}),t("div",{children:[e("label",{className:"text-sm",children:"Ø§Ù„ÙˆØµÙ"}),e("input",{type:"text",value:s,onChange:e=>o(e.target.value),className:"w-full p-2 border rounded mt-1 bg-white",required:!0})]}),t("div",{children:[e("label",{className:"text-sm",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e("input",{type:"number",value:i,onChange:e=>d(e.target.value),className:"w-full p-2 border rounded mt-1 bg-white",required:!0})]}),e("button",{type:"submit",className:"w-full py-2 px-4 rounded bg-blue-600 text-white font-bold hover:bg-blue-700",children:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ"})]})};export{p as C,A as F,g as a};
