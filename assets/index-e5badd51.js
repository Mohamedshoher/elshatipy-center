import{a as e,j as t,F as a,B as r,U as n,i as s,k as l,C as i,g as o,b as d,l as c,E as u,W as h,A as m,e as p,d as g,h as b,c as x,f,m as w,n as y,T as v,P as N,o as k}from"./teacher-views-87eec1c8.js";import{a as S,r as C,R as T}from"./vendor-79b9f383.js";import{X as I,a as A,b as D,c as E,C as P}from"./director-views-1247b421.js";import{A as M,S as L,a as j,b as O,c as V}from"./student-views-b4462f34.js";import{i as F,a as R,p as B,g as U,o as $,c as W,d as _,q as G,w as z,s as H,u as Y,b as q,e as X,f as K,h as J,j as Q,k as Z,l as ee,m as te,n as ae}from"./firebase-b969d8e8.js";import{C as re,F as ne,a as se}from"./finance-views-785e628a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var le={},ie=S;le.createRoot=ie.createRoot,le.hydrateRoot=ie.hydrateRoot;const oe=({leftContent:a,centerContent:r,rightContent:n})=>e("header",{className:"bg-white shadow-sm sticky top-0 z-30",children:e("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-4",children:t("div",{className:"flex justify-between items-center",children:[e("div",{className:"flex-1 flex justify-start items-center gap-2 sm:gap-4",children:a}),e("div",{className:"flex-initial text-center",children:r}),e("div",{className:"flex-1 flex justify-end items-center gap-2 sm:gap-4",children:n})]})})}),de=({className:a})=>t("svg",{xmlns:"http://www.w3.org/2000/svg",className:a,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e("polyline",{points:"16 17 21 12 16 7"}),e("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),ce=({className:t})=>e("svg",{xmlns:"http://www.w3.org/2000/svg",className:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),ue=({isOpen:l,onClose:i,onShowGeneralView:o,onShowFinance:d,onShowFeeCollection:c,onShowNotifications:u,onShowNotes:h,onShowTeacherManager:m,onShowArchive:p,onShowDebtors:g,onShowSupervisorManager:b,onLogout:x,currentUserRole:f})=>{const w=e=>{i(),requestAnimationFrame(()=>{requestAnimationFrame(e)})},y="director"===f,v="supervisor"===f,N=t(a,{children:[t("div",{className:"flex justify-between items-center p-4 border-b",children:[e("h2",{className:"text-xl font-bold text-gray-800",children:"ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ"}),e("button",{onClick:i,className:"p-2 text-gray-500 hover:text-gray-800 rounded-full hover:bg-gray-100 lg:hidden",children:e(I,{className:"w-6 h-6"})})]}),e("nav",{className:"flex-1 p-4 overflow-y-auto",children:t("ul",{className:"space-y-1",children:[e("li",{children:t("button",{onClick:()=>w(m),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-teal-100 hover:text-teal-800 transition-colors",children:[e(r,{className:"w-6 h-6 ml-4 text-teal-600"}),e("span",{className:"font-semibold",children:"ุฅุฏุงุฑุฉ ุงููุฏุฑุณูู"})]})}),y&&b&&e("li",{children:t("button",{onClick:()=>w(b),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-blue-100 hover:text-blue-800 transition-colors",children:[e(n,{className:"w-6 h-6 ml-4 text-blue-600"}),e("span",{className:"font-semibold",children:"ุฅุฏุงุฑุฉ ุงููุดุฑููู"})]})}),e("li",{className:"px-3 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase",children:"ุงูุชูุงุฑูุฑ ูุงููุชุงุจุนุฉ"}),e("li",{children:t("button",{onClick:()=>w(o),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-purple-100 hover:text-purple-800 transition-colors",children:[e(s,{className:"w-6 h-6 ml-4 text-purple-600"}),e("span",{className:"font-semibold",children:"ูุธุฑุฉ ุนุงูุฉ"})]})}),e("li",{children:t("button",{onClick:()=>w(h),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-yellow-100 hover:text-yellow-800 transition-colors",children:[e(A,{className:"w-6 h-6 ml-4 text-yellow-600"}),e("span",{className:"font-semibold",children:"ุณุฌู ุงูููุญูุธุงุช"})]})}),e("li",{children:t("button",{onClick:()=>w(u),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-indigo-100 hover:text-indigo-800 transition-colors",children:[e(ce,{className:"w-6 h-6 ml-4 text-indigo-600"}),e("span",{className:"font-semibold",children:"ุงูุฑุณุงุฆู ูุงูุฅุดุนุงุฑุงุช"})]})}),y&&e("li",{className:"pt-2",children:t("button",{onClick:()=>w(p),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-orange-100 hover:text-orange-800 transition-colors",children:[e(M,{className:"w-6 h-6 ml-4 text-orange-600"}),e("span",{className:"font-semibold",children:"ุงูุฃุฑุดูู"})]})}),(y||v)&&e("li",{children:t("button",{onClick:()=>w(g),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-red-100 hover:text-red-800 transition-colors",children:[e(D,{className:"w-6 h-6 ml-4 text-red-600"}),e("span",{className:"font-semibold",children:"ุงููุฏูููู"})]})}),e("li",{className:"pt-4 border-t mt-4",children:t("button",{onClick:()=>w(x),className:"flex items-center w-full text-right p-3 rounded-lg text-gray-700 hover:bg-red-100 hover:text-red-800 transition-colors",children:[e(de,{className:"w-6 h-6 ml-4 text-red-600"}),e("span",{className:"font-semibold",children:"ุชุณุฌูู ุงูุฎุฑูุฌ"})]})})]})})]});return t(a,{children:[e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity lg:hidden "+(l?"opacity-50":"opacity-0 pointer-events-none"),onClick:i}),e("div",{className:`\n          fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 transition-transform duration-300 ease-in-out flex flex-col\n          lg:sticky lg:top-0 lg:h-screen lg:w-64 lg:shadow-none lg:translate-x-0 lg:border-l\n          ${l?"translate-x-0":"translate-x-full"}\n        `,children:N})]})},he=({label:a,icon:r,isActive:n,onClick:s})=>t("button",{onClick:s,className:"flex flex-col items-center justify-center w-full pt-2 pb-1 transition-colors duration-200 "+(n?"text-blue-600":"text-gray-500"),children:[r,e("span",{className:"text-xs font-semibold mt-1 "+(n?"font-bold":""),children:a})]}),me=({activeView:r,onSelectView:s})=>e(a,{children:t("nav",{className:"fixed bottom-0 right-0 w-full bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] flex justify-around z-40 border-t lg:pr-56",children:[e(he,{label:"ุงูุทูุงุจ",icon:e(n,{className:"w-6 h-6"}),isActive:"students"===r,onClick:()=>s("students")}),e(he,{label:"ุงููุฌููุนุงุช",icon:e(l,{className:"w-6 h-6"}),isActive:"groups"===r,onClick:()=>s("groups")}),e(he,{label:"ุงููุตุฑููุงุช",icon:e(i,{className:"w-6 h-6"}),isActive:"financial_report"===r,onClick:()=>s("financial_report")}),e(he,{label:"ุชูุฑูุฑ ุงูุญุถูุฑ",icon:e(o,{className:"w-6 h-6"}),isActive:"attendance_report"===r,onClick:()=>s("attendance_report")}),e(he,{label:"ุชูุฑูุฑ ุงูุงุฎุชุจุงุฑุงุช",icon:e(A,{className:"w-6 h-6"}),isActive:"tests_report"===r,onClick:()=>s("tests_report")})]})});class pe extends C.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full",children:t("div",{className:"text-center",children:[e("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน"}),e("p",{className:"text-gray-600 mb-6",children:"ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุตูุญุฉ. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ ุฃู ุชุณุฌูู ุงูุฎุฑูุฌ ูุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู."}),this.state.error&&t("details",{className:"text-left bg-gray-50 p-4 rounded-lg mb-4",children:[e("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 mb-2",children:"ุชูุงุตูู ุงูุฎุทุฃ (ูููุทูุฑูู)"}),e("pre",{className:"text-xs text-red-600 overflow-auto",children:this.state.error.toString()})]}),e("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors",children:"ุชุญุฏูุซ ุงูุตูุญุฉ"})]})})}):this.props.children}}const ge=F({apiKey:"AIzaSyDU7Iw6HPkcLABpHpZHi54wzzMgGKAPSX0",authDomain:"app2-d293c.firebaseapp.com",projectId:"app2-d293c",storageBucket:"app2-d293c.firebasestorage.app",messagingSenderId:"715319785410",appId:"1:715319785410:web:f41995c8d174553789485b",measurementId:"G-4RBNQ8TJWV"});let be;if("undefined"!=typeof window)try{be=R(ge,{localCache:B({})})}catch(Je){be=("failed-precondition"==Je.code||Je.code,U(ge))}else be=U(ge);const xe=()=>{const[e,t]=function(e,t){const[a,r]=C.useState(()=>{if("undefined"==typeof window)return t;try{const a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(a){return t}});return[a,t=>{try{const n=t instanceof Function?t(a):t;r(n),"undefined"!=typeof window&&window.localStorage.setItem(e,JSON.stringify(n))}catch(n){}}]}("shatibi-center-currentUser",null),a=C.useCallback(e=>{t(e)},[t]),r=C.useCallback((e,a,r)=>{const n=r.find(t=>t.phone===e&&t.password===a);return!!n&&(t({role:"parent",id:n.id,name:n.name,phone:n.phone,studentIds:n.studentIds}),!0)},[t]),n=C.useCallback(()=>{t(null)},[t]);return{currentUser:e,setCurrentUser:t,handleLogin:a,handleParentLogin:r,handleLogout:n}},fe=async(e,t,a,r)=>{if(e.startsWith("02")&&13===e.length)try{const n=r.find(t=>t.phone===e);if(n)n.studentIds.includes(a)||await Y(_(be,"parents",n.id),{studentIds:q(a)});else{const r=e.slice(-6);await X(W(be,"parents"),{phone:e,name:`ููู ุฃูุฑ ${t}`,password:r,studentIds:[a]})}}catch(n){}},we=e=>{if(!e)return null;const t=e.toLowerCase();return t.includes("ูุฑุขู")?"ูุฑุขู":t.includes("ููุฑ ุจูุงู")?"ููุฑ ุจูุงู":t.includes("ุชูููู")||t.includes("ุชูููู")?"ุชูููู":t.includes("ุฅูุฑุงุก")||t.includes("ุงูุฑุงุก")?"ุฅูุฑุงุก":null},ye=({className:a})=>t("svg",{xmlns:"http://www.w3.org/2000/svg",className:a,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{d:"M22.61 16.95A5 5 0 0 0 18 10h-1.26a8 8 0 0 0-7.05-6M5 5a8 8 0 0 0 4 15h9a5 5 0 0 0 1.7-.3"}),e("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),ve=[{id:"group-quran",name:"๐ข ูุฌููุนุฉ ุงููุฑุขู",keyword:"ูุฑุขู"},{id:"group-noor-bayan",name:"๐ข ูุฌููุนุฉ ููุฑ ุงูุจูุงู",keyword:"ููุฑ ุจูุงู"},{id:"group-talqeen",name:"๐ข ูุฌููุนุฉ ุงูุชูููู",keyword:"ุชูููู"},{id:"group-eqraa",name:"๐ข ูุฌููุนุฉ ุงูุฅูุฑุงุก",keyword:"ุฅูุฑุงุก"},{id:"group-all",name:"๐ข ุฌููุน ุงููุฏุฑุณูู",keyword:"all"}],Ne=({currentUser:r,teachers:n,groups:s,students:l,parents:i,supervisors:o,onBack:d,initialSelectedUserId:c})=>{const[u,h]=C.useState(null),[m,p]=C.useState([]),[g,b]=C.useState(""),[x,f]=C.useState([]),[w,y]=C.useState({}),[v,N]=C.useState(""),k=C.useRef(null),[S,T]=C.useState(!1),[I,A]=C.useState(""),[D,E]=C.useState([]),[P,M]=C.useState(0),L=C.useRef({}),[j,O]=C.useState(0);C.useEffect(()=>{!S&&m.length>0&&k.current?.scrollIntoView({behavior:"smooth"})},[m,S]),C.useEffect(()=>{let e=[];const t=e=>{if(!l)return"ููู ุฃูุฑ";const t=l.filter(t=>e.studentIds.includes(t.id)).map(e=>e.name.split(" ")[0]).join(" ู ");return t?`ููู ุฃูุฑ ${t}`:"ููู ุฃูุฑ"};if("director"===r.role){const a=ve.map(e=>({id:e.id,name:e.name,role:"teacher",isOnline:!0,unreadCount:0})),r=n.map(e=>({id:e.id,name:e.name,role:"teacher",isOnline:!1,unreadCount:0}));let s=[];i&&(s=i.map(e=>({id:e.id,name:e.name,role:"parent",isOnline:!1,unreadCount:0,description:t(e)}))),e=[...a,...r,...s]}else if("teacher"===r.role){e.push({id:"director",name:"ุงูุฅุฏุงุฑุฉ",role:"director",isOnline:!0,unreadCount:0}),e.push({id:"group-all",name:"๐ข ุฌููุน ุงููุฏุฑุณูู",role:"teacher",isOnline:!0,unreadCount:0});const a=s.filter(e=>e.teacherId===r.uid);if(ve.forEach(t=>{"all"!==t.keyword&&a.some(e=>e.name.includes(t.keyword))&&e.push({id:t.id,name:t.name,role:"teacher",isOnline:!0,unreadCount:0})}),i&&l){const r=l.filter(e=>a.some(t=>t.id===e.groupId)).map(e=>e.id);i.filter(e=>e.studentIds.some(e=>r.includes(e))).forEach(a=>{e.push({id:a.id,name:a.name,role:"parent",isOnline:!1,unreadCount:0,description:t(a)})})}}else if("parent"===r.role&&(e.push({id:"director",name:"ุงูุฅุฏุงุฑุฉ",role:"director",isOnline:!0,unreadCount:0,description:"ุฅุฏุงุฑุฉ ุงููุฑูุฒ"}),o&&o.forEach(t=>{if("active"!==t.status)return;const a=l?.filter(e=>{const a=s.find(t=>t.id===e.groupId);return!!a&&t.section?.some(e=>"all"===e||a.name.includes(e))}).map(e=>e.name.split(" ")[0]).filter((e,t,a)=>a.indexOf(e)===t).join(" ู ");e.push({id:t.id,name:t.name,role:"supervisor",isOnline:!1,unreadCount:0,description:a?`ูุดุฑู ${a}`:"ูุดุฑู"})}),l&&l.length>0)){const t=s.filter(e=>l.some(t=>t.groupId===e.id));n.filter(e=>t.some(t=>t.teacherId===e.id)).forEach(a=>{const r=t.filter(e=>e.teacherId===a.id),n=l.filter(e=>r.some(t=>t.id===e.groupId)).map(e=>e.name.split(" ")[0]).join(" ู ");e.push({id:a.id,name:a.name,role:"teacher",isOnline:!1,unreadCount:0,description:n?`ูุฏุฑุณ ุงุจูู ${n}`:"ูุฏุฑุณ ุงุจูู"})})}const a=$(W(be,"presence"),t=>{const a=new Map;t.forEach(e=>{a.set(e.id,e.data())}),f(t=>{const r=new Map;e.forEach(e=>r.set(e.id,e));return Array.from(r.values()).map(e=>{if(e.id.startsWith("group-"))return e;if("director"===e.id)return e;const t=a.get(e.id),r=!!t&&Date.now()-t.lastSeen?.toMillis()<3e5,n=w[e.id];return{...e,isOnline:r,lastSeen:t?.lastSeen,unreadCount:n?.unreadCount||0,lastMessageTimestamp:n?.lastTimestamp,lastMessageContent:n?.lastMessage}}).sort((e,t)=>{const a=e.lastMessageTimestamp?.toMillis?e.lastMessageTimestamp.toMillis():0,r=t.lastMessageTimestamp?.toMillis?t.lastMessageTimestamp.toMillis():0;if(a!==r)return r-a;const n=e=>"director"===e.id?0:"supervisor"===e.role?1:e.id.startsWith("group-")?2:"teacher"===e.role?3:"parent"===e.role?4:5,s=n(e),l=n(t);return s!==l?s-l:e.name.localeCompare(t.name,"ar")})})});return()=>a()},[r.role,n,r.uid,s,l,i,w]),C.useEffect(()=>{if(c&&x.length>0&&!u){const e=x.find(e=>e.id===c);e&&h(e)}},[c,x,u]),C.useEffect(()=>{const e="director"===r.role?"director":r.uid,t=G(W(be,"messages"),z("receiverId","==",e)),a=G(W(be,"messages"),z("senderId","==",e)),n=(e,t)=>{y(a=>{const r={...a};if(e.docs.forEach(e=>{const a=e.data(),n=t?a.receiverId:a.senderId;if(n.startsWith("group-"))return;r[n]||(r[n]={unreadCount:0,lastTimestamp:null,lastMessage:""}),!t&&a.read;(a.timestamp?.toMillis?a.timestamp.toMillis():0)>(r[n].lastTimestamp?.toMillis?r[n].lastTimestamp.toMillis():0)&&(r[n].lastTimestamp=a.timestamp,r[n].lastMessage=a.content)}),!t){const t={};e.docs.forEach(e=>{const a=e.data();a.read||(t[a.senderId]=(t[a.senderId]||0)+1)}),Object.keys(r).forEach(e=>{r[e].unreadCount=t[e]||0})}return r})},s=$(t,e=>n(e,!1)),l=$(a,e=>n(e,!0));return()=>{s(),l()}},[r.uid,r.role]),C.useEffect(()=>{const e=async()=>{const e="director"===r.role?"director":r.uid,t=_(be,"presence",e);await H(t,{lastSeen:ae(),name:r.name,role:r.role},{merge:!0})};e();const t=setInterval(e,6e4);return()=>clearInterval(t)},[r]),C.useEffect(()=>{if(!u)return;T(!1),A(""),E([]);const e="director"===r.role?"director":r.uid,t=u.id,a=t.startsWith("group-");let n;a&&(n=G(W(be,"messages"),z("receiverId","==",t)));const s=[];if(a){const e=$(n,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));p(e=>t.sort((e,t)=>(e.timestamp?.seconds||0)-(t.timestamp?.seconds||0)))});s.push(e)}else{const a=G(W(be,"messages"),z("senderId","==",e),z("receiverId","==",t)),r=G(W(be,"messages"),z("senderId","==",t),z("receiverId","==",e)),n=$(a,a=>{const r=a.docs.map(e=>({id:e.id,...e.data()}));p(a=>{a.filter(e=>e.senderId===t||"group-"===e.receiverId);return[...a.filter(a=>!(a.senderId===e&&a.receiverId===t)),...r].sort((e,t)=>(e.timestamp?.seconds||0)-(t.timestamp?.seconds||0))})}),l=$(r,a=>{const r=a.docs.map(e=>({id:e.id,...e.data()}));r.forEach(e=>{e.read||Y(_(be,"messages",e.id),{read:!0})}),p(a=>[...a.filter(a=>!(a.senderId===t&&a.receiverId===e)),...r].sort((e,t)=>(e.timestamp?.seconds||0)-(t.timestamp?.seconds||0)))});s.push(n),s.push(l)}return()=>{s.forEach(e=>e()),p([]),E([]),A("")}},[u,r]),C.useEffect(()=>{if(!I.trim())return E([]),void M(0);const e=m.filter(e=>e.content.toLowerCase().includes(I.toLowerCase())).map(e=>e.id);E(e),e.length>0?M(e.length-1):M(0)},[I,m]);const V=e=>{if(0===D.length)return;let t="next"===e?P+1:P-1;t>=D.length&&(t=0),t<0&&(t=D.length-1),M(t);const a=D[t],r=L.current[a];r&&(r.scrollIntoView({behavior:"smooth",block:"center"}),r.classList.add("bg-yellow-100"))},F=C.useMemo(()=>m.filter(e=>e.isPinned).sort((e,t)=>(t.timestamp?.seconds||0)-(e.timestamp?.seconds||0)),[m]);C.useEffect(()=>{j>=F.length&&O(0)},[F.length]);const R=e=>{if(F.length<=1)return;let t="next"===e?j+1:j-1;t>=F.length&&(t=0),t<0&&(t=F.length-1),O(t)};C.useEffect(()=>{if("parent"===r.role)return;const e=G(W(be,"messages"),z("receiverId","==","director"===r.role?"director":r.uid),te("timestamp","desc")),t=$(e,e=>{e.docChanges().forEach(e=>{if("added"===e.type){const t=e.doc.data();f(e=>e.some(e=>e.id===t.senderId)||"director"===t.senderId||t.senderId.startsWith("group-")?e:[...e,{id:t.senderId,name:t.senderName,role:"parent",isOnline:!1,unreadCount:1,description:"ุชูุงุตู ุฌุฏูุฏ"}])}})});return()=>t()},[r.role,r.uid]);const B=async(e,t)=>{if("director"===r.role)try{t?await Y(_(be,"messages",e),{isPinned:!1}):await Y(_(be,"messages",e),{isPinned:!0})}catch(a){}},[U,q]=C.useState("all"),K=x.filter(e=>!!e.name.includes(v)&&("all"===U||("groups"===U?e.id.startsWith("group-"):"parents"===U?"parent"===e.role:"staff"!==U||!e.id.startsWith("group-")&&"parent"!==e.role))),J=F[j];return t("div",{className:"flex flex-col md:flex-row h-full bg-gray-100 md:rounded-xl overflow-hidden shadow-xl border border-gray-200",children:[t("div",{className:"w-full md:w-1/3 bg-white border-l border-gray-200 flex flex-col "+(u?"hidden md:flex":"flex h-full"),children:[t("div",{className:"p-4 border-b bg-gray-50 flex flex-col gap-3 shrink-0",children:[t("div",{className:"flex justify-between items-center",children:[e("h2",{className:"font-bold text-gray-700 text-lg",children:"ุงููุญุงุฏุซุงุช"}),e("button",{onClick:d,className:"text-gray-500 hover:text-red-500 text-sm px-3 py-1 rounded-full hover:bg-red-50 transition-colors",children:"ุฅุบูุงู"})]}),t("div",{className:"relative",children:[e("input",{type:"text",placeholder:"ุจุญุซ ุนู ูุฏุฑุณ ุฃู ูุฌููุนุฉ...",value:v,onChange:e=>N(e.target.value),className:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 pl-8"}),e("svg",{className:"w-4 h-4 text-gray-400 absolute left-2 top-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),t("div",{className:"flex items-center gap-2 overflow-x-auto py-2 px-1 no-scrollbar md:flex-wrap",children:[e("button",{onClick:()=>q("all"),className:"px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors "+("all"===U?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ุงููู"}),e("button",{onClick:()=>q("groups"),className:"px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors "+("groups"===U?"bg-amber-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ุงููุฌููุนุงุช"}),e("button",{onClick:()=>q("staff"),className:"px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors "+("staff"===U?"bg-indigo-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ุงููุฏุฑุณูู ูุงูุฅุฏุงุฑุฉ"}),("director"===r.role||"teacher"===r.role)&&e("button",{onClick:()=>q("parents"),className:"px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors "+("parents"===U?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ููุงุฉ ุงูุฃูุฑ"})]})]}),t("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[K.map(a=>t("div",{onClick:()=>h(a),className:"p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors flex items-center gap-4 "+(u?.id===a.id?"bg-blue-50":""),children:[t("div",{className:"relative shrink-0",children:[e("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg shadow-sm border border-gray-100 "+(a.id.startsWith("group-")?"bg-amber-100 text-amber-600":"bg-gray-200 text-gray-600"),children:a.id.startsWith("group-")?"๐ฃ":a.name.charAt(0)}),a.isOnline&&!a.id.startsWith("group-")&&e("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full shadow-sm"})]}),t("div",{className:"flex-1 min-w-0",children:[e("h3",{className:"font-semibold text-gray-800 text-base truncate",children:a.name}),e("p",{className:"text-sm text-gray-500 flex items-center gap-1 truncate",children:a.lastMessageContent?e("span",{className:"truncate",children:a.lastMessageContent}):a.description?e("span",{className:"text-teal-600 font-medium",children:a.description}):a.id.startsWith("group-")?e("span",{className:"text-amber-600",children:"ูุฌููุนุฉ ุนุงูุฉ"}):a.isOnline?e("span",{className:"text-green-600",children:"ูุดุท ุงูุขู"}):"ุบูุฑ ูุชุตู"})]}),t("div",{className:"flex flex-col items-end gap-2 shrink-0",children:[a.unreadCount>0&&e("span",{className:"bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[18px] text-center shadow-sm animate-bounce",children:a.unreadCount}),e("svg",{className:"w-4 h-4 text-gray-300 rtl:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},a.id)),0===K.length&&e("div",{className:"text-center p-4 text-gray-400 text-sm",children:"ูุง ุชูุฌุฏ ูุชุงุฆุฌ"})]})]}),e("div",{className:"flex-1 flex flex-col bg-gray-50 h-full "+(u?"flex":"hidden md:flex"),children:u?t(a,{children:[t("div",{className:"p-3 md:p-4 bg-white border-b shadow-sm flex items-center gap-3 shrink-0 z-10 relative",children:[e("button",{onClick:()=>h(null),className:"md:hidden p-2 -mr-2 text-gray-600 hover:bg-gray-100 rounded-full",children:e("svg",{className:"w-6 h-6 rtl:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})}),e("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg shrink-0 "+(u.id.startsWith("group-")?"bg-amber-100 text-amber-600":"bg-blue-100 text-blue-600"),children:u.id.startsWith("group-")?"๐ฃ":u.name.charAt(0)}),t("div",{className:"flex-1 min-w-0",children:[e("h3",{className:"font-bold text-gray-800 truncate",children:u.name}),u.isOnline&&!u.id.startsWith("group-")&&t("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[e("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 inline-block"})," ูุชุตู"]}),u.id.startsWith("group-")&&e("span",{className:"text-xs text-amber-600 font-semibold",children:"ูุฌููุนุฉ ุจุซ ูููุณู"})]}),t("div",{className:"flex items-center gap-1",children:[e("button",{onClick:()=>T(!S),className:"p-2 rounded-full transition-colors "+(S?"bg-blue-100 text-blue-600":"text-gray-500 hover:bg-gray-100"),title:"ุจุญุซ ูู ุงููุญุงุฏุซุฉ",children:e("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e("button",{onClick:d,className:"p-2 text-gray-400 hover:text-red-500 transition-colors",title:"ุฅุบูุงู",children:e("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),S&&t("div",{className:"bg-white border-b p-2 flex items-center gap-2 animate-in slide-in-from-top-2",children:[t("div",{className:"relative flex-1",children:[e("input",{autoFocus:!0,type:"text",placeholder:"ุงุจุญุซ ุนู ุฑุณุงูุฉ...",value:I,onChange:e=>A(e.target.value),className:"w-full bg-gray-100 border-none rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-blue-400"}),D.length>0&&t("div",{className:"absolute left-3 top-2 text-xs text-gray-400",children:[P+1," / ",D.length]})]}),e("button",{onClick:()=>V("prev"),disabled:0===D.length,className:"p-1 text-gray-500 hover:bg-gray-100 rounded disabled:opacity-30 self-stretch px-2",children:e("span",{className:"text-lg",children:"โ"})}),e("button",{onClick:()=>V("next"),disabled:0===D.length,className:"p-1 text-gray-500 hover:bg-gray-100 rounded disabled:opacity-30 self-stretch px-2",children:e("span",{className:"text-lg",children:"โ"})}),e("button",{onClick:()=>{T(!1),A("")},className:"p-1 text-red-500 hover:bg-red-50 rounded",children:"โ"})]}),J&&!S&&t("div",{className:"bg-yellow-50 border-b border-yellow-200 p-2 px-4 flex justify-between items-center shadow-sm z-0",children:[t("div",{className:"flex items-center gap-2 overflow-hidden cursor-pointer flex-1",onClick:()=>(e=>{const t=L.current[e];t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.transition="background-color 0.5s",t.style.backgroundColor="#fef08a",setTimeout(()=>{t.style.backgroundColor=""},1e3))})(J.id),children:[e("span",{className:"text-yellow-600 shrink-0",children:"๐"}),t("div",{className:"flex flex-col min-w-0",children:[t("div",{className:"text-xs text-yellow-700 font-bold mb-0.5 flex items-center gap-2",children:[t("span",{children:["ุฑุณุงูุฉ ูุซุจุชุฉ ",F.length>1&&`(${j+1}/${F.length})`]}),t("span",{className:"font-normal text-gray-500 text-[10px]",children:["- ",J.senderName]})]}),e("div",{className:"text-sm text-gray-800 truncate",children:J.content})]})]}),t("div",{className:"flex items-center gap-1 shrink-0",children:[F.length>1&&t("div",{className:"flex items-center bg-yellow-100 rounded-lg mr-2",children:[e("button",{onClick:()=>R("next"),className:"p-1 hover:bg-yellow-200 text-yellow-700 rounded-r-lg px-2 text-xs",children:" ุงูุชุงูู < "}),e("div",{className:"w-px h-4 bg-yellow-300"}),e("button",{onClick:()=>R("prev"),className:"p-1 hover:bg-yellow-200 text-yellow-700 rounded-l-lg px-2 text-xs",children:" > ุงูุณุงุจู "})]}),"director"===r.role&&e("button",{onClick:()=>B(J.id,!0),className:"text-gray-400 hover:text-red-500 p-1",title:"ุฅูุบุงุก ุงูุชุซุจูุช",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),t("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 bg-opacity-50",style:{backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[m.map(a=>{const n=a.senderId===("director"===r.role?"director":r.uid);let s=a.content;if(I.trim()){s=a.content.split(new RegExp(`(${I})`,"gi")).map((t,a)=>t.toLowerCase()===I.toLowerCase()?e("span",{className:"bg-yellow-200 text-black font-bold rounded px-0.5",children:t},a):t)}return e("div",{ref:e=>L.current[a.id]=e,className:`flex ${n?"justify-end":"justify-start"} group relative transition-colors duration-500`,children:t("div",{className:`max-w-[85%] md:max-w-[70%] rounded-2xl p-3 px-4 shadow-sm break-words relative ${n?"bg-blue-600 text-white rounded-br-none":"bg-white text-gray-800 border border-gray-100 rounded-bl-none"} ${D[P]===a.id&&S?"ring-4 ring-yellow-300 ring-opacity-50":""}`,children:["director"===r.role&&e("button",{onClick:()=>B(a.id,a.isPinned),className:`absolute -top-2 ${n?"-left-2":"-right-2"} opacity-0 group-hover:opacity-100 transition-opacity bg-white text-gray-500 rounded-full p-1 shadow-md border hover:text-yellow-500 z-10`,title:a.isPinned?"ุฅูุบุงุก ุงูุชุซุจูุช":"ุชุซุจูุช ุงูุฑุณุงูุฉ",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 "+(a.isPinned?"text-yellow-500 fill-current":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),u.id.startsWith("group-")&&!n&&e("p",{className:"text-[10px] text-gray-500 mb-1 font-bold",children:a.senderName}),e("p",{className:"text-sm md:text-base leading-relaxed whitespace-pre-wrap",children:s}),t("div",{className:"flex justify-between items-center mt-1 gap-2",children:[a.isPinned&&e("span",{className:"text-[10px] text-yellow-300 bg-black/20 px-1 rounded",children:"๐ ูุซุจุชุฉ"}),t("span",{className:"text-[10px] block text-right ml-auto "+(n?"text-blue-200":"text-gray-400"),children:[a.timestamp?.seconds?new Date(1e3*a.timestamp.seconds).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"}):"...",n&&(a.read?e("span",{className:"mr-1",children:"โโ"}):e("span",{className:"mr-1",children:"โ"}))]})]})]})},a.id)}),e("div",{ref:k})]}),e("div",{className:"p-3 md:p-4 bg-white border-t shrink-0",children:t("form",{onSubmit:async e=>{if(e.preventDefault(),!g.trim()||!u)return;const t="director"===r.role?"director":r.uid,a=g.trim();let n=r.name;if("parent"===r.role){const e=(s=r.uid,l?(l.filter(e=>!0),"parent"===r.role&&s===r.uid?l.map(e=>e.name.split(" ")[0]).join(" ู "):""):"");e&&(n=`${r.name} (ููู ุฃูุฑ ${e})`)}var s;const i="temp-"+Date.now(),o={id:i,senderId:t,senderName:n,receiverId:u.id,content:a,timestamp:{seconds:Date.now()/1e3,toMillis:()=>Date.now()},read:!1,isPinned:!1};p(e=>[...e,o].sort((e,t)=>(e.timestamp?.seconds||0)-(t.timestamp?.seconds||0))),b("");try{await X(W(be,"messages"),{senderId:t,senderName:n,receiverId:u.id,content:a,timestamp:ae(),read:!1,isPinned:!1})}catch(d){alert("ูุดู ุฅุฑุณุงู ุงูุฑุณุงูุฉ"),p(e=>e.filter(e=>e.id!==i))}},className:"flex gap-2 items-center",children:[e("input",{type:"text",value:g,onChange:e=>b(e.target.value),placeholder:u.id.startsWith("group-")?`ุฅุฑุณุงู ุฅูู ${u.name}...`:"ุงูุชุจ ุฑุณุงูุชู...",className:"flex-1 border bg-gray-50 border-gray-300 rounded-full px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-colors"}),e("button",{type:"submit",disabled:!g.trim(),className:"bg-blue-600 text-white rounded-full p-3 w-12 h-12 flex items-center justify-center hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-transform active:scale-95 shadow-md",children:e("svg",{className:"w-5 h-5 rtl:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]}):t("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 p-4 text-center",children:[e("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e("h3",{className:"text-xl font-bold text-gray-600 mb-2",children:"ูุฑุญุจุงู ุจู ูู ุงููุญุงุฏุซุงุช"}),e("p",{className:"text-gray-500 max-w-xs",children:"ุงุฎุชุฑ ุฒูููุงู ุฃู ูุฌููุนุฉ ูู ุงููุงุฆูุฉ ูุจุฏุก ุงูุชูุงุตู."})]})})]})},ke=({onLogin:a,teachers:r,supervisors:n})=>{const[s,l]=C.useState(""),[i,o]=C.useState(""),[d,c]=C.useState("");return t("div",{className:"space-y-4",dir:"rtl",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ุงูุฏูุฑ"}),t("select",{value:s,onChange:e=>l(e.target.value),className:"w-full p-3 border rounded-lg",children:[e("option",{value:"",children:"ุงุฎุชุฑ ุฏูุฑ"}),e("option",{value:"director",children:"ูุฏูุฑ"}),e("option",{value:"teacher",children:"ูุนูู"}),e("option",{value:"supervisor",children:"ูุดุฑู"})]})]}),s&&"director"!==s&&t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"teacher"===s?"ุงููุนูู":"ุงููุดุฑู"}),t("select",{value:i,onChange:e=>o(e.target.value),className:"w-full p-3 border rounded-lg",children:[e("option",{value:"",children:"ุงุฎุชุฑ"}),("teacher"===s?r:n).map(t=>e("option",{value:t.id,children:t.name},t.id))]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ูููุฉ ุงููุฑูุฑ"}),e("input",{type:"password",value:d,onChange:e=>c(e.target.value),className:"w-full p-3 border rounded-lg"})]}),e("button",{onClick:()=>{if("director"===s)"director123"===d&&a({role:"director",id:"director",name:"ุงููุฏูุฑ"});else if("teacher"===s){const e=r.find(e=>e.id===i);e&&d===e.password&&a({role:"teacher",...e})}else if("supervisor"===s){const e=n.find(e=>e.id===i);e&&d===e.password&&a({role:"supervisor",...e})}},className:"w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700",children:"ุฏุฎูู"})]})},Se=a=>{const{students:r,groups:n,teachers:l,searchTerm:i,onViewGroupReport:o,onViewStudents:d,onViewDetails:c}=a,[u,h]=C.useState("all"),m=C.useMemo(()=>{const e=i.toLowerCase();return n.filter(t=>{const a=!i||t.name.toLowerCase().includes(e),r=(e=>{const t=e.toLowerCase();return t.includes("ูุฑุขู")?"ูุฑุขู":t.includes("ููุฑ ุจูุงู")?"ููุฑ ุจูุงู":t.includes("ุชูููู")||t.includes("ุชูููู")?"ุชูููู":t.includes("ุฅูุฑุงุก")||t.includes("ุงูุฑุงุก")?"ุฅูุฑุงุก":null})(t.name);return a&&("all"===u||r===u)}).sort((t,a)=>{if(i){const r=t.name.toLowerCase(),n=a.name.toLowerCase(),s=r.startsWith(e),l=n.startsWith(e);if(s&&!l)return-1;if(!s&&l)return 1}return t.name.localeCompare(a.name,"ar")})},[n,i,u]);return t("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"flex justify-center sm:justify-start mb-6",children:t("div",{className:"relative inline-block w-full sm:w-64",children:[e("label",{htmlFor:"group-type-filter",className:"block text-sm font-medium text-gray-700 mb-1 mr-1",children:"ุชุตููุฉ ุญุณุจ ุงูููุน"}),t("div",{className:"relative",children:[t("select",{id:"group-type-filter",value:u,onChange:e=>h(e.target.value),className:"block w-full appearance-none bg-white border border-gray-300 text-gray-700 py-3 px-4 pr-8 rounded-xl leading-tight focus:outline-none focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 shadow-sm transition-all duration-200 font-bold",children:[e("option",{value:"all",children:"ุงููู"}),e("option",{value:"ูุฑุขู",children:"ูุฑุขู"}),e("option",{value:"ููุฑ ุจูุงู",children:"ููุฑ ุจูุงู"}),e("option",{value:"ุชูููู",children:"ุชูููู"}),e("option",{value:"ุฅูุฑุงุก",children:"ุฅูุฑุงุก"})]}),e("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center px-2 text-gray-700",children:e("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]})}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:m.length>0?m.map(a=>{const n=r.filter(e=>e.groupId===a.id&&!e.isArchived),i=l.find(e=>e.id===a.teacherId);return e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 ease-in-out hover:shadow-lg",children:t("div",{className:"p-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 h-full",onClick:()=>d(a),role:"button",children:[e("div",{className:"flex items-center min-w-0",children:t("div",{children:[t("h2",{className:"text-lg sm:text-xl font-bold text-gray-800 flex items-center truncate",children:[e("span",{className:"truncate",children:a.name}),e("span",{className:"text-base font-normal bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0",children:n.length})]}),i&&e("p",{className:"text-sm text-gray-500 font-semibold mt-1",children:`ุงููุฏุฑุณ: ${i.name}`})]})}),e("div",{className:"flex items-center gap-2 sm:gap-4 flex-shrink-0",children:t("button",{onClick:e=>{e.stopPropagation(),o(a.id)},className:"flex items-center gap-2 bg-indigo-100 text-indigo-700 font-bold py-2 px-3 rounded-lg shadow-sm hover:bg-indigo-200 transition-all duration-200",title:"ุนุฑุถ ุชูุฑูุฑ ุงููุฌููุนุฉ",children:[e(s,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุชูุฑูุฑ"})]})})]})},a.id)}):t("div",{className:"col-span-1 md:col-span-2 text-center py-20 bg-white rounded-xl shadow mx-auto w-full mt-8",children:[e("h2",{className:"text-2xl font-semibold text-gray-600",children:i||"all"!==u?"ูุง ุชูุฌุฏ ูุฌููุนุงุช ุชุทุงุจู ุงูุจุญุซ":"ูุง ุชูุฌุฏ ูุฌููุนุงุช ูุนุฑุถูุง"}),e("p",{className:"text-gray-400 mt-2",children:i||"all"!==u?"ูู ูุชู ุงูุนุซูุฑ ุนูู ูุฌููุนุงุช ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ.":"ููููู ุฅุถุงูุฉ ูุฌููุนุงุช ุฌุฏูุฏุฉ ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ."})]})})]})},Ce=({isOpen:a,onClose:r,absentStudents:s,groups:l,onStudentClick:i,currentUserRole:o})=>{const[d,c]=C.useState(null),u=C.useMemo(()=>{const e={};return s.forEach(t=>{e[t.groupId]||(e[t.groupId]=[]),e[t.groupId].push(t)}),Object.entries(e).map(([e,t])=>({groupId:e,groupName:l.find(t=>t.id===e)?.name||"ูุฌููุนุฉ ุบูุฑ ูุญุฏุฏุฉ",students:t,count:t.length})).sort((e,t)=>t.count-e.count)},[s,l]);return a?e("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg flex flex-col max-h-[90vh]",children:[t("div",{className:"flex-shrink-0 flex justify-between items-center mb-4",children:[e("h2",{className:"text-2xl font-bold text-gray-700",children:"ุงูุทูุงุจ ุงูุบุงุฆุจูู ุงูููู"}),e("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 text-3xl",children:"ร"})]}),e("div",{className:"flex-grow overflow-y-auto space-y-3 pr-2",children:u.length>0?u.map(({groupId:a,groupName:r,students:s,count:l})=>t("div",{className:"bg-gray-100 rounded-lg",children:[t("div",{className:"p-3 flex justify-between items-center cursor-pointer",onClick:()=>c(e=>e===a?null:a),children:[e("h3",{className:"font-semibold text-gray-800",children:r}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-bold text-red-600 bg-red-100 px-2 py-1 rounded-full text-sm",children:[l," ุบุงุฆุจ"]}),e("svg",{className:"w-5 h-5 text-gray-500 transition-transform duration-300 "+(d===a?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})]}),d===a&&e("div",{className:"border-t border-gray-200 p-3",children:e("ul",{className:"space-y-2",children:s.sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(a=>t("li",{className:"flex items-center justify-between gap-2 p-2 rounded-md hover:bg-blue-50 transition-colors",children:[t("button",{onClick:()=>i(a.id),className:"flex-1 text-right flex items-center text-gray-700 hover:text-blue-700",children:[e(n,{className:"w-5 h-5 ml-2"}),a.name]}),("director"===o||"supervisor"===o)&&e("button",{onClick:e=>((e,t)=>{t.stopPropagation();const a=(new Date).toLocaleDateString("ar-EG",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r=`*ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชู*\n\nุนุฒูุฒู ููู ุฃูุฑ ุงูุทุงูุจ/ุฉ: *${e.name}*\n\nููุฏ ุฅุนูุงููู ุจุฃู ุงูุทุงูุจ/ุฉ *ุบุงุจ/ุช ุงูููู* (${a}) ุนู ุญุถูุฑ ุงูุญููุฉ.\n\nโ๏ธ *ุชุญุฐูุฑ ูุงู:*\nุงูุบูุงุจ ุงููุชูุฑุฑ ูุคุซุฑ ุณูุจุงู ุนูู ูุณุชูู ุงูุทุงูุจ/ุฉ ุงูุฏุฑุงุณู ูุงูุญูุธุ ูุฐุง ูุฑุฌู ูููู ุงูุงูุชูุงู ุจูุชุงุจุนุฉ ุญุถูุฑ ุงูุทุงูุจ/ุฉ ุจุงูุชุธุงู ููุญูุงุธ ุนูู ุชูุฏูู/ูุง ูู ุงูุญูุธ ูุงููุฑุงุฌุนุฉ.\n\nูุดูุฑ ููู ุชุนุงูููู ููุณุฃู ุงููู ุฃู ูููู ุงูุฌููุน.\n\n*ูุน ุชุญูุงุช ุฅุฏุงุฑุฉ ูุฑูุฒ ุงูุดุงุทุจู ูุชุญููุธ ุงููุฑุขู ุงููุฑูู* ๐`;let n=e.phone.replace(/[^0-9]/g,"");if(n=n.replace(/^0+/,""),n.startsWith("1")&&10===n.length&&(n="20"+n),!n)return void alert("ูุง ููุฌุฏ ุฑูู ูุงุชู ูุณุฌู ูููู ุฃูุฑ ูุฐุง ุงูุทุงูุจ.");const s=encodeURIComponent(r);/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?window.open(`https://api.whatsapp.com/send?phone=${n}&text=${s}`,"_blank"):window.open(`https://web.whatsapp.com/send?phone=${n}&text=${s}`,"whatsapp_window")})(a,e),className:"flex items-center justify-center bg-green-500 hover:bg-green-600 text-white p-2 rounded-full shadow-sm transition-all",title:"ุฅุฑุณุงู ุฑุณุงูุฉ ูููู ุงูุฃูุฑ",children:e(h,{className:"w-5 h-5"})})]},a.id))})})]},a)):e("p",{className:"text-center text-gray-500 py-8",children:"ูุง ููุฌุฏ ุทูุงุจ ุบุงุฆุจูู ุงูููู."})}),e("div",{className:"flex-shrink-0 mt-6 flex justify-end",children:e("button",{onClick:r,className:"px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300",children:"ุฅุบูุงู"})})]})}):null},Te=({students:r,groups:s,onViewStudent:l,onArchive:i,onViewDetails:o,currentUserRole:d})=>{const[c,u]=C.useState(()=>(new Date).toISOString().substring(0,7)),[p,g]=C.useState(!1),[b,x]=C.useState(()=>(new Date).toISOString().split("T")[0]),[f,w]=C.useState(1),[y,v]=C.useState(0),N=e=>{const t=new Date;t.setDate(t.getDate()+e),x(t.toISOString().split("T")[0])};T.useEffect(()=>{b&&u(b.substring(0,7))},[b]);const k=C.useMemo(()=>{let e=0,t=[];return r.forEach(a=>{const r=a.attendance.find(e=>e.date===b);r?r.status===m.PRESENT?e++:t.push(a):new Date(b)>=new Date(a.joiningDate)&&t.push(a)}),{present:e,absent:t.length,absentStudents:t}},[r,b]),S=C.useMemo(()=>({mostAbsent:r.map(e=>{const t=e.attendance.filter(e=>e.date.startsWith(c)).filter(e=>e.status===m.ABSENT).length,a=[...e.attendance].filter(e=>e.date<=b).sort((e,t)=>t.date.localeCompare(e.date));let r=0;for(const s of a)if(s.status===m.ABSENT)r++;else if(s.status===m.PRESENT)break;const n=e.attendance.find(e=>e.date===b)?.status===m.PRESENT;return{student:e,absentDays:t,currentStreak:r,isPresentOnSelectedDate:n}}).filter(e=>{const t=e.absentDays>=f;let a=!0;return y>0&&(a=e.currentStreak>=y&&!e.isPresentOnSelectedDate),t&&a}).sort((e,t)=>t.absentDays-e.absentDays)}),[r,c,f,y,b]),I=new Date(c+"-02").toLocaleString("ar-EG",{month:"long"});return t(a,{children:[e("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t("div",{className:"space-y-8",children:[t("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ุงูุชูุฑูุฑ ุงููููู"}),t("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e("input",{type:"date",value:b,onChange:e=>x(e.target.value),className:"w-full sm:w-auto flex-grow px-3 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}),t("div",{className:"flex gap-2",children:[e("button",{onClick:()=>N(0),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-300",children:"ุงูููู"}),e("button",{onClick:()=>N(-1),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-300",children:"ุฃูุณ"}),e("button",{onClick:()=>N(-2),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-300",children:"ุฃูู ุฃูุณ"})]})]}),t("div",{className:"grid grid-cols-2 gap-4 text-center",children:[t("div",{className:"bg-green-100 p-3 rounded-lg",children:[e("p",{className:"text-2xl font-bold text-green-600",children:k.present}),e("p",{className:"text-sm text-green-800 font-semibold",children:"ุญุงุถุฑ"})]}),t("button",{onClick:()=>k.absent>0&&g(!0),className:"bg-red-100 p-3 rounded-lg text-center transition-all "+(k.absent>0?"cursor-pointer hover:bg-red-200":"cursor-default"),disabled:0===k.absent,children:[e("p",{className:"text-2xl font-bold text-red-600",children:k.absent}),e("p",{className:"text-sm text-red-800 font-semibold",children:"ุบุงุฆุจ"}),k.absent>0&&e("span",{className:"text-xs text-red-700 block mt-1",children:"(ุงููุฑ ูุนุฑุถ ุงูุชูุงุตูู)"})]})]})]}),t("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[t("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4",children:[t("h3",{className:"text-lg font-bold text-gray-800",children:["ุงูุทูุงุจ ุงูุฃูุซุฑ ุบูุงุจูุง - ",I]}),t("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:flex items-center gap-3 bg-gray-50 p-3 rounded-xl border border-gray-100 w-full lg:w-auto",children:[t("div",{className:"flex items-center justify-between sm:justify-start gap-2 bg-white p-2 rounded-lg border border-gray-100 lg:border-none lg:bg-transparent lg:p-0",children:[e("label",{htmlFor:"absent-filter",className:"text-xs font-bold text-gray-500 whitespace-nowrap",children:"ุฅุฌูุงูู ุงูุบูุงุจ:"}),t("div",{className:"flex items-center gap-1",children:[e("input",{id:"absent-filter",type:"number",min:"1",value:f,onChange:e=>w(Math.max(1,parseInt(e.target.value)||1)),className:"w-12 px-1 py-1 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 font-bold text-center text-sm"}),e("span",{className:"text-[10px] font-bold text-gray-400",children:"ููู+"})]})]}),e("div",{className:"hidden lg:block w-px h-6 bg-gray-200"}),t("div",{className:"flex items-center justify-between sm:justify-start gap-2 bg-white p-2 rounded-lg border border-gray-100 lg:border-none lg:bg-transparent lg:p-0",children:[e("label",{htmlFor:"consecutive-filter",className:"text-xs font-bold text-gray-500 whitespace-nowrap",children:"ุบูุงุจ ูุชุตู:"}),t("div",{className:"flex items-center gap-1",children:[e("input",{id:"consecutive-filter",type:"number",min:"1",value:y,onChange:e=>v(Math.max(0,parseInt(e.target.value)||0)),className:"w-12 px-1 py-1 border-2 border-gray-200 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 font-bold text-center text-sm",placeholder:"0"}),e("span",{className:"text-[10px] font-bold text-gray-400",children:"ููู+"})]})]})]})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.mostAbsent.map((a,r)=>t("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between bg-white border border-gray-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all gap-4",children:[t("div",{className:"flex items-center min-w-0",children:[e("span",{className:"font-bold text-gray-300 w-5 text-center text-xs shrink-0",children:r+1}),e("div",{className:"bg-blue-50 p-2 rounded-lg mx-3 shrink-0",children:e(n,{className:"w-5 h-5 text-blue-500"})}),t("div",{className:"flex flex-col min-w-0 overflow-hidden",children:[e("button",{onClick:()=>l(a.student.id),className:"font-bold text-gray-800 hover:text-blue-600 transition-colors text-right truncate text-sm sm:text-base",children:a.student.name}),t("div",{className:"flex flex-wrap items-center gap-1.5 mt-0.5",children:[e("span",{className:"text-[10px] font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded truncate max-w-[100px]",children:s.find(e=>e.id===a.student.groupId)?.name}),a.currentStreak>=3&&t("span",{className:"text-[10px] font-bold text-orange-600 bg-orange-50 px-1.5 py-0.5 rounded flex items-center gap-1 shrink-0",children:[e("span",{className:"w-1 h-1 bg-orange-500 rounded-full animate-pulse"}),a.currentStreak," ูุชุตู"]})]})]})]}),t("div",{className:"flex items-center justify-between sm:justify-end gap-3 pt-3 sm:pt-0 border-t sm:border-t-0 border-gray-50",children:[t("div",{className:"flex items-center gap-1",children:[("director"===d||"supervisor"===d)&&e("button",{onClick:()=>((e,t)=>{const a=`ูุฑุญุจุงู ููู ุฃูุฑ ุงูุทุงูุจ/ุฉ: *${e.name}*ุ\n\nููุฏ ุฅุนูุงููู ุจุชุฌุงูุฒ ุงูุทุงูุจ/ุฉ ุงูุญุฏ ุงููุณููุญ ุจู ูู ุงูุบูุงุจ ุฎูุงู ูุฐุง ุงูุดูุฑุ ุญูุซ ุจูุบ ุนุฏุฏ ุฃูุงู ุบูุงุจู/ุง *${t}* ููู.\n\nูุฑุฌู ุงูุนูู ุจุฃูู ูู ุญุงู ุงุณุชูุฑุงุฑ ุงูุบูุงุจ ูุฏ ูุคุฏู ุฐูู ุฅูู ูุตู ุงูุทุงูุจ/ุฉ ูู ุงููุฑูุฒ.\n\nูุน ุชุญูุงุช ุฅุฏุงุฑุฉ ุงููุฑูุฒ.`;let r=e.phone.replace(/[^0-9]/g,"");r=r.replace(/^0+/,""),r.startsWith("1")&&10===r.length&&(r="20"+r);const n=encodeURIComponent(a);/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?window.open(`https://api.whatsapp.com/send?phone=${r}&text=${n}`,"_blank"):window.open(`https://web.whatsapp.com/send?phone=${r}&text=${n}`,"whatsapp_window")})(a.student,a.absentDays),className:"text-green-500 hover:bg-green-50 p-2 rounded-lg transition-colors",title:"ุฅุฑุณุงู ุชูุจูู ูููู ุงูุฃูุฑ",children:e(h,{className:"w-5 h-5"})}),e("button",{onClick:e=>{e.stopPropagation(),o(a.student,"attendanceLog")},className:"p-2 text-gray-400 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"ุณุฌู ุงูุญุถูุฑ",children:e(A,{className:"w-5 h-5"})}),"teacher"!==d&&e("button",{onClick:e=>{e.stopPropagation(),i(a.student.id)},className:"p-2 text-gray-400 hover:text-orange-500 hover:bg-orange-50 rounded-lg transition-colors",title:"ุฃุฑุดูุฉ ุงูุทุงูุจ",children:e(M,{className:"w-5 h-5"})})]}),e("div",{className:"shrink-0",children:t("span",{className:"font-bold text-red-600 bg-red-50 px-3 py-1.5 rounded-lg text-xs sm:text-sm border border-red-100 whitespace-nowrap",children:[a.absentDays," ุบูุงุจ"]})})]})]},a.student.id))}),0===S.mostAbsent.length&&e("div",{className:"text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:e("p",{className:"text-gray-400 font-bold",children:`ูุง ููุฌุฏ ุทูุงุจ ููุทุจู ุนูููู ุงูุจุญุซ ูู ${I}.`})})]})]})}),e(Ce,{isOpen:p,onClose:()=>g(!1),absentStudents:k.absentStudents,groups:s,onStudentClick:e=>{g(!1),l(e)},currentUserRole:d})]})},Ie=({className:t="w-6 h-6"})=>e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5a2.25 2.25 0 1 1 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566 5.314m6.434-11.25a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm0 11.25a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})}),Ae={[p.NEW]:"ุฌุฏูุฏ",[p.RECENT_PAST]:"ูุงุถู ูุฑูุจ",[p.DISTANT_PAST]:"ุจุนูุฏ",[p.READING]:"ูุฑุงุกุฉ"},De=({title:r,children:n,isOpen:s,onOpen:l,onClose:i,headerContent:o})=>t(a,{children:[t("div",{onClick:l,className:"bg-white rounded-xl shadow p-6 flex items-center justify-between cursor-pointer hover:shadow-md transition-all border border-gray-100 group h-full",children:[t("div",{className:"flex items-center gap-4 flex-1",children:[e("h2",{className:"text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors",children:r}),o&&e("div",{onClick:e=>e.stopPropagation(),children:o})]}),e("div",{className:"bg-gray-50 p-2 rounded-full group-hover:bg-blue-50 transition-colors",children:e("div",{className:"p-1",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400 group-hover:text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})})]}),s&&e("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm",onClick:i,children:t("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-[95vw] h-[90vh] flex flex-col overflow-hidden",onClick:e=>e.stopPropagation(),children:[t("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between z-10 flex-shrink-0 bg-white",children:[e("h2",{className:"text-2xl font-bold text-gray-800",children:r}),e("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-full text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e("div",{className:"p-6 bg-gray-50 flex-grow overflow-y-auto",children:n})]})})]}),Ee=({students:a,groups:r,onViewStudent:s,onBack:l})=>{const[i,o]=C.useState(null),[d,c]=C.useState(()=>(new Date).toISOString().split("T")[0]),[u,h]=C.useState(()=>(new Date).toISOString().substring(0,7)),[m,g]=C.useState("all"),[b,x]=C.useState("all"),[f,w]=C.useState(1),[y,v]=C.useState("all"),[N,k]=C.useState(p.NEW);T.useEffect(()=>{const e=e=>{if("Escape"===e.key)i&&o(null);else if("Backspace"===e.key){const t=e.target,a="INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable;i||a||!l||(e.preventDefault(),l())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i,l]);const S=e=>{const t=new Date;t.setDate(t.getDate()+e),c(t.toISOString().split("T")[0])},I=C.useMemo(()=>({totalTests:a.flatMap(e=>e.tests).filter(e=>e.date===d).length}),[a,d]),A=C.useMemo(()=>{let e=a;"all"!==m&&(e=a.filter(e=>e.groupId===m));return e.map(e=>{const t=e.tests.filter(e=>{const t="all"===b||e.type===b,a=e.date.startsWith(u);return t&&a});return{student:e,count:t.length}}).filter(e=>e.count>=f).sort((e,t)=>t.count-e.count)},[a,u,m,b,f]),D=C.useMemo(()=>{let e=a;return"all"!==y&&(e=a.filter(e=>e.groupId===y)),e.filter(e=>{if(e.joiningDate.substring(0,7)>u)return!1;return!e.tests.some(e=>e.date.startsWith(u)&&e.type===N)})},[a,u,y,N]),E=new Date(u+"-02").toLocaleString("ar-EG",{month:"long"});return e("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t("div",{className:"flex flex-col gap-6",children:[e("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:t("div",{className:"w-full sm:w-auto max-w-xs sm:mr-auto",children:[e("label",{htmlFor:"month-filter",className:"sr-only",children:"ุงุฎุชุฑ ุงูุดูุฑ"}),e("input",{type:"month",id:"month-filter",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t(De,{title:"ุงูุงุฎุชุจุงุฑ ุงููููู",isOpen:"daily"===i,onOpen:()=>o("daily"),onClose:()=>o(null),children:[t("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[e("input",{type:"date",value:d,onChange:e=>c(e.target.value),className:"w-full sm:w-auto flex-grow px-3 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}),t("div",{className:"flex gap-2",children:[e("button",{onClick:()=>S(0),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-300",children:"ุงูููู"}),e("button",{onClick:()=>S(-1),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-300",children:"ุฃูุณ"}),e("button",{onClick:()=>S(-2),className:"px-3 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-300",children:"ุฃูู ุฃูุณ"})]})]}),t("div",{className:"bg-blue-100 p-4 rounded-lg text-center",children:[e("p",{className:"text-3xl font-bold text-blue-600",children:I.totalTests}),e("p",{className:"text-sm text-blue-800 font-semibold",children:"ุฅุฌูุงูู ุงูุงุฎุชุจุงุฑุงุช"})]})]}),t(De,{title:`ุงูุฃูุซุฑ ุงุฎุชุจุงุฑูุง - ${E}`,isOpen:"mostTested"===i,onOpen:()=>o("mostTested"),onClose:()=>o(null),children:[t("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[t("select",{value:m,onChange:e=>g(e.target.value),className:"py-1.5 px-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all",children:"ูู ุงููุฌููุนุงุช"}),[...r].sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(t=>e("option",{value:t.id,children:t.name},t.id))]}),t("select",{value:b,onChange:e=>x(e.target.value),className:"py-1.5 px-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all",children:"ูู ุงูุฃููุงุน"}),Object.entries(Ae).map(([t,a])=>e("option",{value:t,children:a},t))]}),t("div",{className:"flex items-center gap-2 bg-white border border-gray-300 rounded-lg px-3 py-1.5",children:[e("span",{className:"text-sm text-gray-500 whitespace-nowrap",children:"ุนูู ุงูุฃูู:"}),e("input",{type:"number",min:"1",value:f,onChange:e=>w(Math.max(1,parseInt(e.target.value)||1)),className:"w-12 text-sm text-center focus:outline-none"}),e("span",{className:"text-sm text-gray-500",children:"ุงุฎุชุจุงุฑ"})]})]}),t("div",{className:"space-y-2",children:[A.map(({student:a,count:l},i)=>t("div",{className:"flex items-center justify-between bg-gray-100 p-3 rounded-lg",children:[t("div",{className:"flex items-center",children:[t("span",{className:"font-bold text-gray-500 w-6 text-center",children:[i+1,"."]}),e(n,{className:"w-5 h-5 mx-2 text-gray-400"}),t("div",{className:"flex flex-col",children:[e("button",{onClick:()=>s(a.id),className:"text-gray-800 hover:text-blue-600 transition-colors text-right font-semibold",children:a.name}),e("span",{className:"text-xs text-gray-400",children:r.find(e=>e.id===a.groupId)?.name})]})]}),t("div",{className:"flex items-center gap-3",children:[t("span",{className:"font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full text-sm",children:[l," ุงุฎุชุจุงุฑ"]}),e("button",{onClick:()=>{const e=`ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชู\nููู ุฃูุฑ ุงูุทุงูุจ/ุฉ: ${a.name}\n\nูุณุฑูุง ุฅุจูุงุบูู ุจุฃู ุงุจููู/ุงุจูุชูู ูุฏ ุฃุชู ${l} ุงุฎุชุจุงุฑุงุช ุฎูุงู ูุฐุง ุงูุดูุฑ ุจุชููู ูุชููุฒ.\nููุฏุฑ ุญุฑุตูู ููุชุงุจุนุชููุ ููุดุฌุนูู ุนูู ุงูุงุณุชูุฑุงุฑ ูู ูุฐุง ุงููุณุชูู ุงูุฑุงุฆุน.\n\nุญูุธู ุงููู ูุฑุนุงู ูุฌุนูู ูู ุฃูู ุงููุฑุขู.\n\nุฅุฏุงุฑุฉ ุงููุฑูุฒ`;let t=a.phone.replace(/[^0-9]/g,"");t=t.replace(/^0+/,""),t.startsWith("1")&&10===t.length&&(t="20"+t);const r=encodeURIComponent(e),n=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),s=n?`https://api.whatsapp.com/send?phone=${t}&text=${r}`:`https://web.whatsapp.com/send?phone=${t}&text=${r}`;window.open(s,n?"_blank":"whatsapp_window")},className:"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors shadow-sm",title:"ุฅุฑุณุงู ุชููุฆุฉ ุนุจุฑ ูุงุชุณุงุจ",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})})})]})]},a.id)),0===A.length&&e("p",{className:"text-center text-gray-400 py-4",children:"ูุง ููุฌุฏ ุทูุงุจ ูุทุงุจููู ูุฐู ุงููุนุงููุฑ."})]})]}),t(De,{title:`ูู ูุฎุชุจุฑูุง - ${E}`,isOpen:"notTested"===i,onOpen:()=>o("notTested"),onClose:()=>o(null),children:[t("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[t("select",{value:y,onChange:e=>v(e.target.value),className:"py-1.5 px-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all",children:"ูู ุงููุฌููุนุงุช"}),[...r].sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(t=>e("option",{value:t.id,children:t.name},t.id))]}),e("select",{value:N,onChange:e=>k(e.target.value),className:"py-1.5 px-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(Ae).map(([t,a])=>e("option",{value:t,children:a},t))})]}),t("div",{className:"space-y-2",children:[D.map((a,l)=>t("div",{className:"flex items-center justify-between bg-yellow-50 p-3 rounded-lg",children:[t("div",{className:"flex items-center",children:[t("span",{className:"font-bold text-gray-500 w-6 text-center",children:[l+1,"."]}),e(n,{className:"w-5 h-5 mx-2 text-gray-400"}),t("div",{className:"flex flex-col",children:[e("button",{onClick:()=>s(a.id),className:"text-gray-800 hover:text-blue-600 transition-colors text-right font-semibold",children:a.name}),e("span",{className:"text-xs text-gray-400",children:r.find(e=>e.id===a.groupId)?.name})]})]}),e("div",{className:"flex items-center gap-3",children:e("button",{onClick:()=>{const e=`ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชู\nููู ุฃูุฑ ุงูุทุงูุจ/ุฉ: ${a.name}\n\nููุฏ ุฅูุงุฏุชูู ุจุฃู ุงูุทุงูุจ ูู ููู ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑ (${Ae[N]}) ุฎูุงู ูุฐุง ุงูุดูุฑ.\nูุฑุฌู ูููู ูุฒูุฏุงู ูู ุงูุนูุงูุฉ ูุงูุงูุชูุงูุ ูุงูุชูุถู ุจูุฑุงุฌุนุฉ ุงููุฑูุฒ ููุชุงุจุนุฉ ูุณุชูู ุงูุทุงูุจ.\n\nุดุงูุฑูู ุญุณู ุชุนุงูููู.\n\nุฅุฏุงุฑุฉ ุงููุฑูุฒ`;let t=a.phone.replace(/[^0-9]/g,"");t=t.replace(/^0+/,""),t.startsWith("1")&&10===t.length&&(t="20"+t);const r=encodeURIComponent(e),n=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),s=n?`https://api.whatsapp.com/send?phone=${t}&text=${r}`:`https://web.whatsapp.com/send?phone=${t}&text=${r}`;window.open(s,n?"_blank":"whatsapp_window")},className:"p-2 bg-yellow-500 text-white rounded-full hover:bg-yellow-600 transition-colors shadow-sm",title:"ุฅุฑุณุงู ุชูุจูู ุนุจุฑ ูุงุชุณุงุจ",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})})})})]},a.id)),0===D.length&&e("p",{className:"text-center text-gray-400 py-4",children:"ุฌููุน ุงูุทูุงุจ ูู ุงููุฌููุนุฉ ุงููุญุฏุฏุฉ ุชู ุงุฎุชุจุงุฑูู."})]})]}),e(De,{title:`ููุงุฑูุฉ ุงูุฃุฏุงุก - ${E}`,isOpen:"comparison"===i,onOpen:()=>o("comparison"),onClose:()=>o(null),children:e(Pe,{students:a,groups:r,selectedMonth:u})})]})]})})},Pe=({students:r,groups:n,selectedMonth:s})=>{const[l,i]=C.useState("all"),o=C.useMemo(()=>n.map(e=>{const t=r.filter(t=>t.groupId===e.id),a={[p.NEW]:0,[p.RECENT_PAST]:0,[p.DISTANT_PAST]:0,total:0};return t.forEach(e=>{e.tests.forEach(e=>{e.date.startsWith(s)&&void 0!==a[e.type]&&(a[e.type]++,a.total++)})}),{groupName:e.name,stats:a}}).filter(e=>"all"===l||e.stats[l]>0).sort((e,t)=>"all"===l?t.stats.total-e.stats.total:(t.stats[l]||0)-(e.stats[l]||0)),[r,n,s,l]),d=C.useMemo(()=>0===o.length?1:"all"===l?Math.max(...o.map(e=>e.stats.total),1):Math.max(...o.map(e=>e.stats[l]||0),1),[o,l]);return t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-center gap-2 sm:gap-4 mb-6 text-xs sm:text-sm flex-wrap items-center bg-gray-50 p-3 rounded-xl border border-gray-100",children:[e("button",{onClick:()=>i("all"),className:"px-3 py-1.5 rounded-full border transition-all "+("all"===l?"bg-indigo-600 text-white border-indigo-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-indigo-300"),children:"ุงููู"}),t("button",{onClick:()=>i(p.NEW),className:"flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all "+(l===p.NEW?"bg-green-600 text-white border-green-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-green-300"),children:[e("div",{className:"w-3 h-3 rounded-full "+(l===p.NEW?"bg-white":"bg-green-500")}),e("span",{children:"ุฌุฏูุฏ"})]}),t("button",{onClick:()=>i(p.RECENT_PAST),className:"flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all "+(l===p.RECENT_PAST?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-blue-300"),children:[e("div",{className:"w-3 h-3 rounded-full "+(l===p.RECENT_PAST?"bg-white":"bg-blue-500")}),e("span",{children:"ูุงุถู ูุฑูุจ"})]}),t("button",{onClick:()=>i(p.DISTANT_PAST),className:"flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all "+(l===p.DISTANT_PAST?"bg-purple-600 text-white border-purple-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-purple-300"),children:[e("div",{className:"w-3 h-3 rounded-full "+(l===p.DISTANT_PAST?"bg-white":"bg-purple-500")}),e("span",{children:"ุจุนูุฏ"})]}),e("div",{className:"w-px h-6 bg-gray-200 mx-1 hidden sm:block"}),t("button",{onClick:()=>{let e=`๐ *ุชูุฑูุฑ ููุงุฑูุฉ ุงูุฃุฏุงุก - ${new Date(s+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"})}*\n`;"all"!==l&&(e+=`ุจูุงุกู ุนูู ููุน: *${Ae[l]}*\n`),e+="ูุฑูุฒ ุงูุดุงุทุจู ุงููุฑุขูู\n\n",e+="ูุดุงุท ุงููุฌููุนุงุช ููุฐุง ุงูุดูุฑ:\n",o.forEach((t,a)=>{const r="all"===l?t.stats.total:t.stats[l];e+=`${a+1}. *${t.groupName}*: ${r} ุงุฎุชุจุงุฑ `,e+="all"===l?`(${t.stats[p.NEW]} ุฌุฏูุฏุ ${t.stats[p.RECENT_PAST]} ูุฑูุจุ ${t.stats[p.DISTANT_PAST]} ุจุนูุฏ)\n`:"\n"}),e+="\nุจุงุฑู ุงููู ูู ุฌููุฏ ุงูุฌููุน ๐น";const t=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),a=encodeURIComponent(e);if(navigator.share&&t)navigator.share({title:"ุชูุฑูุฑ ููุงุฑูุฉ ุงูุฃุฏุงุก",text:e}).catch(()=>{window.open(`https://api.whatsapp.com/send?text=${a}`,"_blank")});else{const e=t?`https://api.whatsapp.com/send?text=${a}`:`https://web.whatsapp.com/send?text=${a}`;window.open(e,t?"_blank":"whatsapp_window")}},className:"flex items-center gap-2 px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 transition-colors font-bold text-xs",title:"ูุดุงุฑูุฉ ุงูุชูุฑูุฑ",children:[e(Ie,{className:"w-4 h-4"}),e("span",{children:"ูุดุงุฑูุฉ ุงูุชูุฑูุฑ"})]})]}),t("div",{className:"space-y-4",children:[o.map((r,n)=>t("div",{className:"flex items-center gap-2 sm:gap-4 group",children:[e("div",{className:"w-20 sm:w-32 text-left text-xs sm:text-sm font-semibold text-gray-700 truncate group-hover:text-blue-600 transition-colors",title:r.groupName,children:r.groupName}),e("div",{className:"flex-1 h-8 bg-gray-100 rounded-full overflow-hidden flex relative shadow-inner",children:r.stats.total>0?t(a,{children:[("all"===l||l===p.NEW)&&e("div",{className:"h-full bg-green-500 hover:bg-green-600 transition-all relative group/bar cursor-help",style:{width:r.stats[p.NEW]/d*100+"%"},children:e("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] text-white font-bold opacity-0 group-hover/bar:opacity-100 transition-opacity",children:r.stats[p.NEW]})}),("all"===l||l===p.RECENT_PAST)&&e("div",{className:"h-full bg-blue-500 hover:bg-blue-600 transition-all relative group/bar cursor-help",style:{width:r.stats[p.RECENT_PAST]/d*100+"%"},children:e("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] text-white font-bold opacity-0 group-hover/bar:opacity-100 transition-opacity",children:r.stats[p.RECENT_PAST]})}),("all"===l||l===p.DISTANT_PAST)&&e("div",{className:"h-full bg-purple-500 hover:bg-purple-600 transition-all relative group/bar cursor-help",style:{width:r.stats[p.DISTANT_PAST]/d*100+"%"},children:e("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] text-white font-bold opacity-0 group-hover/bar:opacity-100 transition-opacity",children:r.stats[p.DISTANT_PAST]})})]}):e("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400 font-medium",children:"ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช"})}),e("div",{className:"w-10 sm:w-16 text-right text-xs sm:text-sm font-bold text-gray-600 tabular-nums",children:"all"===l?r.stats.total:r.stats[l]})]},n)),0===o.length&&e("div",{className:"text-center py-10 text-gray-400 font-medium bg-white rounded-xl border-2 border-dashed",children:"ูุง ุชูุฌุฏ ุจูุงูุงุช ููุนุฑุถ ูู ูุฐุง ุงูุชุตููู"})]})]})},Me=({isOpen:a,onClose:r,onSave:n,paymentDetails:s})=>{const[l,i]=C.useState(""),[o,d]=C.useState("");if(C.useEffect(()=>{a&&s&&(i(s.amount.toString()),d(""))},[a,s]),!a||!s)return null;const c=new Date(s.month+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"});return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-md",children:[e("h2",{className:"text-2xl font-bold mb-2 text-gray-700",children:"ุชุณุฌูู ุฏูุนุฉ"}),t("p",{className:"text-gray-500 mb-6",children:["ุดูุฑ: ",c]}),t("form",{onSubmit:e=>{if(e.preventDefault(),!l||isNaN(parseFloat(l))||parseFloat(l)<0)return void alert("ูุฑุฌู ุฅุฏุฎุงู ูุจูุบ ุตุญูุญ.");const t={studentId:s.studentId,month:s.month,amountPaid:parseFloat(l),receiptNumber:o.trim()};r(),n(t)},children:[t("div",{className:"mb-4",children:[e("label",{htmlFor:"amountPaid",className:"block text-gray-600 mb-2",children:"ุงููุจูุบ ุงููุฏููุน"}),e("input",{type:"number",id:"amountPaid",value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,step:"any",min:"0",autoFocus:!0})]}),t("div",{className:"mb-6",children:[e("label",{htmlFor:"receiptNumber",className:"block text-gray-600 mb-2",children:"ุฑูู ุงููุตู (ุงุฎุชูุงุฑู)"}),e("input",{type:"text",id:"receiptNumber",value:o,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t("div",{className:"flex flex-col sm:flex-row justify-end gap-4",children:[e("button",{type:"button",onClick:r,className:"px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors order-2 sm:order-1",children:"ุฅูุบุงุก"}),e("button",{type:"submit",className:"px-6 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors order-1 sm:order-2",children:"ุญูุธ ุงูุฏูุนุฉ"})]})]})]})})},Le=({isOpen:a,onClose:r,onConfirm:n,groups:s,studentName:l})=>{const[i,o]=C.useState("");if(C.useEffect(()=>{a&&s.length>0?o(s[0].id):o("")},[a,s]),!a)return null;return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-md",children:[e("h2",{className:"text-2xl font-bold mb-2 text-gray-700",children:"ุงุณุชุนุงุฏุฉ ุงูุทุงูุจ"}),t("p",{className:"text-gray-500 mb-6",children:["ูุฑุฌู ุงุฎุชูุงุฑ ุงููุฌููุนุฉ ุงูุชู ุณููุชูู ุฅูููุง ุงูุทุงูุจ: ",e("span",{className:"font-semibold",children:l})]}),t("form",{onSubmit:e=>{e.preventDefault(),i?(r(),n(i)):alert("ูุฑุฌู ุงุฎุชูุงุฑ ูุฌููุนุฉ ูุฅุนุงุฏุฉ ุงูุทุงูุจ ุฅูููุง.")},children:[t("div",{className:"mb-6",children:[e("label",{htmlFor:"group-select",className:"block text-gray-600 mb-2",children:"ุงููุฌููุนุฉ ุงูุฌุฏูุฏุฉ"}),e("select",{id:"group-select",value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",required:!0,children:0===s.length?e("option",{disabled:!0,children:"ูุง ุชูุฌุฏ ูุฌููุนุงุช ูุชุงุญุฉ"}):[...s].sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(t=>e("option",{value:t.id,children:t.name},t.id))})]}),t("div",{className:"flex flex-col sm:flex-row justify-end gap-4",children:[e("button",{type:"button",onClick:r,className:"px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors order-2 sm:order-1",children:"ุฅูุบุงุก"}),e("button",{type:"submit",disabled:!i,className:"px-6 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors order-1 sm:order-2 disabled:bg-gray-400",children:"ุงุณุชุนุงุฏุฉ"})]})]})]})})},je={[p.NEW]:"ุฌุฏูุฏ",[p.RECENT_PAST]:"ูุงุถู ูุฑูุจ",[p.DISTANT_PAST]:"ุจุนูุฏ",[p.READING]:"ูุฑุงุกุฉ"},Oe={[g.EXCELLENT]:{label:"ููุชุงุฒ",className:"bg-green-100 text-green-800"},[g.VERY_GOOD]:{label:"ุฌูุฏ ุฌุฏุงู",className:"bg-blue-100 text-blue-800"},[g.GOOD]:{label:"ุฌูุฏ",className:"bg-yellow-100 text-yellow-800"},[g.REPEAT]:{label:"ูุนุงุฏ",className:"bg-red-100 text-red-800"}},Ve=({children:a,icon:r,title:n})=>e("th",{className:"px-2 sm:px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("div",{className:"flex items-center gap-1",title:n||String(a),children:[e("div",{className:"sm:hidden",children:r}),e("span",{className:"hidden sm:inline",children:a})]})}),Fe=({group:a,students:r,teacher:l,onBack:d,currentUserRole:c})=>{const[u,p]=C.useState("summary"),[g,f]=C.useState(()=>(new Date).toISOString().substring(0,7)),[w,y]=C.useState("desc"),v=C.useMemo(()=>{const e=new Set,t=new Date;let a=t;r.forEach(e=>{const t=new Date(e.joiningDate);t<a&&(a=t)});let n=new Date(a);for(n.setDate(1);n<=t;)e.add(n.toISOString().substring(0,7)),n.setMonth(n.getMonth()+1);return[...Array.from(e).sort().reverse().map(e=>({value:e,label:new Date(e+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"})})),{value:"last_3_months",label:"ุขุฎุฑ 3 ุฃุดูุฑ"},{value:"all_time",label:"ููุฐ ุงูุจุฏุงูุฉ"}]},[r]),N=C.useMemo(()=>{if("last_3_months"===g){const e=[],t=new Date;for(let a=0;a<3;a++){const r=new Date(t.getFullYear(),t.getMonth()-a,1);e.push(r.toISOString().substring(0,7))}return e}return"all_time"===g?v.filter(e=>e.value.match(/^\d{4}-\d{2}$/)).map(e=>e.value).sort():[g]},[g,v]),k=C.useMemo(()=>[...r].sort((e,t)=>e.name.localeCompare(t.name,"ar")),[r]),S=C.useMemo(()=>k.map(e=>{const t=e.attendance.filter(e=>N.some(t=>e.date.startsWith(t)));return{student:e,present:t.filter(e=>e.status===m.PRESENT).length,absent:t.filter(e=>e.status===m.ABSENT).length}}),[k,N]),T=C.useMemo(()=>{const e=k.map(e=>{const t=e.fees.filter(e=>N.includes(e.month)&&e.paid).reduce((e,t)=>e+(t.amountPaid||0),0),a=N.filter(t=>new Date(t)>=new Date(e.joiningDate.substring(0,7))).filter(t=>!e.fees.some(e=>e.month===t&&e.paid)),r=a.reduce((t,a)=>t+e.monthlyFee,0);return{student:e,paidAmount:t,pendingAmount:r,pendingMonthsCount:a.length}}),t=e.reduce((e,t)=>e+t.paidAmount,0),a=e.reduce((e,t)=>e+t.pendingAmount,0);return{details:e,summary:{totalCollected:t,totalPending:a}}},[k,N]),M=C.useMemo(()=>k.flatMap(e=>e.tests.filter(e=>N.some(t=>e.date.startsWith(t))).map(t=>({...t,studentName:e.name,studentId:e.id}))).sort((e,t)=>{const a=new Date(e.date).getTime(),r=new Date(t.date).getTime();return"asc"===w?a-r:r-a}),[k,N,w]),L=C.useMemo(()=>k.filter(e=>!e.tests.some(e=>N.some(t=>e.date.startsWith(t)))),[k,N]),j=C.useMemo(()=>k.filter(e=>N.filter(t=>new Date(t)>=new Date(e.joiningDate.substring(0,7))).some(t=>!e.fees.some(e=>e.month===t&&e.paid))),[k,N]),O=e=>{const t="py-3 px-3 sm:px-6 font-semibold text-center transition-colors duration-200 focus:outline-none flex items-center justify-center gap-2 flex-grow sm:flex-grow-0";return u===e?"unpaid"===e?`${t} border-b-2 border-red-600 text-red-600`:"summary"===e?`${t} border-b-2 border-blue-600 text-blue-600`:`${t} border-b-2 border-indigo-600 text-indigo-600`:`${t} text-gray-500 hover:bg-gray-100`};return e("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[t("div",{className:"border-b border-gray-200 flex flex-wrap text-sm sm:text-base",children:[t("button",{onClick:()=>p("summary"),className:O("summary"),title:"ุงูุชูุฑูุฑ ุงูุดุงูู",children:[e(b,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุงูุชูุฑูุฑ ุงูุดุงูู"})]}),t("button",{onClick:()=>p("attendance"),className:O("attendance"),title:"ุงูุญุถูุฑ",children:[e(o,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุงูุญุถูุฑ"})]}),t("button",{onClick:()=>p("fees"),className:O("fees"),title:"ุงููุตุฑููุงุช",children:[e(i,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุงููุตุฑููุงุช"})]}),t("button",{onClick:()=>p("unpaid"),className:O("unpaid"),title:"ุบูุฑ ูุณุฏุฏ",children:[e(D,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุบูุฑ ูุณุฏุฏ"})]}),t("button",{onClick:()=>p("tests"),className:O("tests"),title:"ุงูุงุฎุชุจุงุฑุงุช",children:[e(A,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุงูุงุฎุชุจุงุฑุงุช"})]}),t("button",{onClick:()=>p("untested"),className:O("untested"),title:"ุบูุฑ ูุฎุชุจุฑ",children:[e(E,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุบูุฑ ูุฎุชุจุฑ"})]})]}),t("div",{className:"p-6",children:[t("div",{className:"mb-6 max-w-xs",children:[e("label",{htmlFor:"month-filter",className:"block text-sm font-medium text-gray-600 mb-1",children:"ุนุฑุถ ุชูุฑูุฑ"}),e("select",{id:"month-filter",value:g,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:v.map(t=>e("option",{value:t.value,children:t.label},t.value))})]}),"summary"===u&&e("div",{className:"space-y-4",children:k.map(a=>{const r=S.find(e=>e.student.id===a.id),s=T.details.find(e=>e.student.id===a.id),l=M.filter(e=>e.studentId===a.id),i=v.find(e=>e.value===g)?.label||g;return t("div",{className:"bg-gray-50 rounded-lg p-4 shadow-sm border border-gray-200",children:[t("div",{className:"flex justify-between items-center mb-4",children:[t("div",{className:"flex items-center gap-3",children:[e(n,{className:"w-6 h-6 text-blue-600"}),e("h3",{className:"text-lg font-bold text-gray-800",children:a.name})]}),("director"===c||"supervisor"===c)&&t("button",{onClick:()=>(e=>{const t=v.find(e=>e.value===g)?.label||g;let a=`ูุฑุญุจุงู ููู ุฃูุฑ ุงูุทุงูุจ/ุฉ: *${e.name}*\n`;a+=`ูุฐุง ูู ุชูุฑูุฑ ุงูุฃุฏุงุก ูู ูุฑูุฒ ุงูุดุงุทุจู ุนู ูุชุฑุฉ: *${t}*\n\n`;const r=S.find(t=>t.student.id===e.id);r&&(a+="*๐ ุงูุญุถูุฑ ูุงูุบูุงุจ:*\n",a+=`  - ุฃูุงู ุงูุญุถูุฑ: ${r.present}\n`,a+=`  - ุฃูุงู ุงูุบูุงุจ: ${r.absent}\n\n`);const n=N.filter(t=>new Date(t)>=new Date(e.joiningDate.substring(0,7))).filter(t=>!e.fees.some(e=>e.month===t&&e.paid));if(a+="*๐ต ุงููุตุฑููุงุช:*\n",n.length>0){const e=n.map(e=>new Date(e+"-02").toLocaleString("ar-EG",{month:"long"})).join(", ");a+=`  - ูุฑุฌู ููุงุญุธุฉ ุฃู ูุตุฑููุงุช ุงูุดููุฑ ุงูุชุงููุฉ ูู ุชุณุฏุฏ ุจุนุฏ: *${e}*.\n\n`}else a+="  - ุฌููุน ูุตุฑููุงุช ุงููุชุฑุฉ ุงููุญุฏุฏุฉ ูุณุฏุฏุฉ. ุดูุฑุงู ูุงูุชุฒุงููู.\n\n";const s=M.filter(t=>t.studentId===e.id);a+="*๐ ุงูุงุฎุชุจุงุฑุงุช:*\n",s.length>0?(s.forEach(e=>{a+=`  - ${new Date(e.date).toLocaleDateString("ar-EG")}: ${e.suraName} (${je[e.type]}) - ุงูุชูุฏูุฑ: *${Oe[e.grade].label}*\n`}),a+="\n"):a+="  - ูู ุชุณุฌู ุงุฎุชุจุงุฑุงุช ููุทุงูุจ/ุฉ ุฎูุงู ูุฐู ุงููุชุฑุฉ.\n\n",a+="ูุน ุชุญูุงุช ุฅุฏุงุฑุฉ ุงููุฑูุฒ.";const l=e.phone.replace(/[^0-9]/g,""),i=encodeURIComponent(a);window.open(`https://wa.me/${l}?text=${i}`,"_blank")})(a),className:"flex items-center gap-2 bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow hover:bg-green-600 transition-all text-sm",title:"ุฅุฑุณุงู ุงูุชูุฑูุฑ ุงูุดุงูู ุนุจุฑ ูุงุชุณุงุจ",children:[e(h,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline",children:"ุฅุฑุณุงู ูููู ุงูุฃูุฑ"})]})]}),t("div",{className:"border-t pt-4",children:[t("p",{className:"text-sm text-gray-500 mb-3",children:["ููุฎุต ุงูุฃุฏุงุก ุนู ูุชุฑุฉ: ",e("span",{className:"font-semibold",children:i})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t("div",{className:"bg-white p-3 rounded-md",children:[e("h4",{className:"font-semibold text-gray-600 border-b pb-2 mb-2",children:"ุงูุญุถูุฑ ูุงูุบูุงุจ"}),t("p",{children:["ุฃูุงู ุงูุญุถูุฑ: ",e("span",{className:"font-bold text-green-600",children:r?.present||0})]}),t("p",{children:["ุฃูุงู ุงูุบูุงุจ: ",e("span",{className:"font-bold text-red-600",children:r?.absent||0})]})]}),t("div",{className:"bg-white p-3 rounded-md",children:[e("h4",{className:"font-semibold text-gray-600 border-b pb-2 mb-2",children:"ุงููุตุฑููุงุช"}),s&&s.pendingMonthsCount>0?t("p",{className:"text-red-600",children:["ูู ุชุณุฏุฏ ูุตุฑููุงุช ",e("span",{className:"font-bold",children:s.pendingMonthsCount})," ุดูุฑ"]}):e("p",{className:"text-green-600 font-semibold",children:"โ ุฌููุน ุงููุตุฑููุงุช ูุณุฏุฏุฉ"})]}),t("div",{className:"bg-white p-3 rounded-md",children:[e("h4",{className:"font-semibold text-gray-600 border-b pb-2 mb-2",children:"ุงูุงุฎุชุจุงุฑุงุช"}),t("p",{children:["ุฅุฌูุงูู ุงูุงุฎุชุจุงุฑุงุช: ",e("span",{className:"font-bold text-blue-600",children:l.length})]})]})]})]})]},a.id)})}),"attendance"===u&&e("div",{className:"overflow-x-auto",children:t("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:t("tr",{children:[e(Ve,{icon:e(n,{className:"w-5 h-5"}),title:"ุงุณู ุงูุทุงูุจ",children:"ุงุณู ุงูุทุงูุจ"}),e(Ve,{icon:e(o,{className:"w-5 h-5"}),title:"ุฅุฌูุงูู ุงูุญุถูุฑ",children:"ุฅุฌูุงูู ุงูุญุถูุฑ"}),e(Ve,{icon:e(I,{className:"w-5 h-5"}),title:"ุฅุฌูุงูู ุงูุบูุงุจ",children:"ุฅุฌูุงูู ุงูุบูุงุจ"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(a=>t("tr",{children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.student.name}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold",children:a.present}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold",children:a.absent})]},a.student.id))})]})}),"fees"===u&&t("div",{children:[e("div",{className:"overflow-x-auto",children:t("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:t("tr",{children:[e(Ve,{icon:e(n,{className:"w-5 h-5"}),title:"ุงุณู ุงูุทุงูุจ",children:"ุงุณู ุงูุทุงูุจ"}),e(Ve,{icon:e(i,{className:"w-5 h-5"}),title:"ุฅุฌูุงูู ุงููุฏููุน",children:"ุฅุฌูุงูู ุงููุฏููุน"}),e(Ve,{icon:e(D,{className:"w-5 h-5"}),title:"ุฅุฌูุงูู ุงููุชุจูู",children:"ุฅุฌูุงูู ุงููุชุจูู"}),e(Ve,{icon:e(s,{className:"w-5 h-5"}),title:"ุดููุฑ ุบูุฑ ูุณุฏุฏุฉ",children:"ุดููุฑ ุบูุฑ ูุณุฏุฏุฉ"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:T.details.map(a=>t("tr",{children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.student.name}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold",children:a.paidAmount.toLocaleString()}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold",children:a.pendingAmount.toLocaleString()}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:a.pendingMonthsCount})]},a.student.id))})]})}),t("div",{className:"mt-6 p-6 bg-gray-50 rounded-lg grid grid-cols-1 sm:grid-cols-2 gap-6",children:[t("div",{className:"text-center",children:[e("p",{className:"text-sm text-gray-500",children:"ุงูุฅุฌูุงูู ุงููุญุตูู ูู ุงููุชุฑุฉ"}),t("p",{className:"text-2xl font-bold text-green-600",children:[T.summary.totalCollected.toLocaleString()," EGP"]})]}),t("div",{className:"text-center",children:[e("p",{className:"text-sm text-gray-500",children:"ุงูุฅุฌูุงูู ุงููุชุจูู ูู ุงููุชุฑุฉ"}),t("p",{className:"text-2xl font-bold text-red-600",children:[T.summary.totalPending.toLocaleString()," EGP"]})]})]})]}),"unpaid"===u&&t("div",{children:[e("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"ุงูุทูุงุจ ุบูุฑ ุงููุณุฏุฏูู ุฎูุงู ุงููุชุฑุฉ"}),j.length>0?e("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:j.map(a=>e("div",{className:"flex items-center justify-between bg-red-50 p-3 rounded-lg border border-red-200",children:t("div",{className:"flex items-center",children:[e(n,{className:"w-6 h-6 ml-3 text-red-500"}),e("span",{className:"font-semibold text-gray-700",children:a.name})]})},a.id))}):e("div",{className:"text-center bg-green-50 text-green-700 font-semibold p-6 rounded-lg border border-green-200",children:e("p",{children:"โ ุฌููุน ุงูุทูุงุจ ูู ูุฐู ุงููุฌููุนุฉ ุณุฏุฏูุง ูุตุฑููุงุช ูุฐู ุงููุชุฑุฉ."})})]}),"tests"===u&&t("div",{children:[t("div",{className:"mb-4",children:[e("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"ุชุฑุชูุจ ุญุณุจ ุงูุชุงุฑูุฎ"}),t("select",{value:w,onChange:e=>y(e.target.value),className:"w-full max-w-xs px-3 py-2 border rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500 bg-white",children:[e("option",{value:"desc",children:"ุงูุฃุญุฏุซ ุฃููุงู"}),e("option",{value:"asc",children:"ุงูุฃูุฏู ุฃููุงู"})]})]}),e("div",{className:"overflow-x-auto",children:t("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:t("tr",{children:[e(Ve,{icon:e(o,{className:"w-5 h-5"}),title:"ุงูุชุงุฑูุฎ",children:"ุงูุชุงุฑูุฎ"}),e(Ve,{icon:e(n,{className:"w-5 h-5"}),title:"ุงูุทุงูุจ",children:"ุงูุทุงูุจ"}),e(Ve,{icon:e(A,{className:"w-5 h-5"}),title:"ุงูุณูุฑุฉ",children:"ุงูุณูุฑุฉ"}),e(Ve,{icon:e(x,{className:"w-5 h-5"}),title:"ุงูููุน",children:"ุงูููุน"}),e(Ve,{icon:e(P,{className:"w-5 h-5"}),title:"ุงูุชูุฏูุฑ",children:"ุงูุชูุฏูุฑ"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length>0?M.map(a=>t("tr",{children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(a.date).toLocaleDateString("ar-EG")}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.studentName}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800",children:a.suraName}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:je[a.type]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e("span",{className:`px-2 py-1 text-xs font-bold rounded-full text-center ${Oe[a.grade].className}`,children:Oe[a.grade].label})})]},a.id)):e("tr",{children:e("td",{colSpan:5,className:"text-center py-10 text-gray-500",children:"ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช ูุณุฌูุฉ ููุฐู ุงููุชุฑุฉ."})})})]})})]}),"untested"===u&&t("div",{children:[e("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"ุงูุทูุงุจ ุบูุฑ ุงููุฎุชุจุฑูู ุฎูุงู ุงููุชุฑุฉ"}),L.length>0?e("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:L.map(a=>e("div",{className:"flex items-center justify-between bg-orange-50 p-3 rounded-lg border border-orange-200",children:t("div",{className:"flex items-center",children:[e(n,{className:"w-6 h-6 ml-3 text-orange-500"}),e("span",{className:"font-semibold text-gray-700",children:a.name})]})},a.id))}):e("div",{className:"text-center bg-green-50 text-green-700 font-semibold p-6 rounded-lg border border-green-200",children:e("p",{children:"โ ุฌููุน ุงูุทูุงุจ ูู ูุฐู ุงููุฌููุนุฉ ุชู ุงุฎุชุจุงุฑูู ุฎูุงู ูุฐู ุงููุชุฑุฉ."})})]})]})]})})},Re=({group:a,students:r,teachers:n,onOpenFeeModal:s,onAddTest:l,onDeleteTest:i,onAddNote:o,onEdit:d,onToggleAttendance:c,onArchive:u,currentUserRole:h,onViewDetails:m,onMarkWeeklyReportSent:p,onBack:g})=>{const b=n.find(e=>e.id===a.teacherId),x=[...r].sort((e,t)=>e.name.localeCompare(t.name,"ar"));return t("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e("div",{className:"bg-white border-b sticky top-0 z-20 shadow-sm",children:t("div",{className:"container mx-auto px-4 py-4 flex items-center gap-4",children:[e("button",{onClick:g,className:"p-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors","aria-label":"Back",children:e(f,{className:"w-6 h-6"})}),t("div",{children:[e("h1",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:a.name}),t("div",{className:"flex items-center gap-3 mt-1",children:[t("span",{className:"text-sm font-medium bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:[r.length," ุทุงูุจ"]}),b&&t("span",{className:"text-sm text-gray-500 font-semibold",children:["ุงููุฏุฑุณ: ",b.name]})]})]})]})}),e("main",{className:"container mx-auto px-4 py-6 flex-1",children:e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4",children:x.length>0?x.map(t=>e(L,{student:t,groupName:a.name,onOpenFeeModal:s,onEdit:d,onToggleAttendance:c,onArchive:u,currentUserRole:h||"teacher",onViewDetails:m,onMarkWeeklyReportSent:p},t.id)):e("div",{className:"col-span-full text-center py-20 bg-white rounded-xl shadow-sm",children:e("p",{className:"text-gray-500 text-lg",children:"ูุง ููุฌุฏ ุทูุงุจ ูู ูุฐู ุงููุฌููุนุฉ."})})})})]})},Be=({teacher:a,teacherAttendance:n,onSetTeacherAttendance:s,onDeductionClick:l,onClick:i})=>{const o=(new Date).toISOString().split("T")[0],u=C.useMemo(()=>n.find(e=>e.teacherId===a.id&&e.date===o),[n,a.id,o]);return e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 ease-in-out hover:shadow-lg "+(a.status===c.INACTIVE?"bg-gray-100 opacity-70":""),children:e("div",{className:"p-4",children:t("div",{className:"flex flex-col gap-4",children:[t("div",{className:"flex items-center gap-3 cursor-pointer",onClick:i,role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&i(),children:[e("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 "+(a.status===c.INACTIVE?"bg-gray-200":"bg-teal-100"),children:e(r,{className:"h-5 w-5 "+(a.status===c.INACTIVE?"text-gray-500":"text-teal-600")})}),e("h3",{className:"text-xl font-bold text-gray-800",children:a.name})]}),t("div",{className:"flex flex-wrap items-center justify-between gap-y-2",onClick:e=>e.stopPropagation(),children:[t("div",{className:"flex gap-2",children:[e("button",{onClick:()=>s(a.id,o,d.PRESENT),className:"py-1 px-4 rounded-full font-semibold text-sm transition-all border "+(u&&u.status!==d.PRESENT?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-green-600 text-white border-transparent shadow"),children:"โ ุญุงุถุฑ"}),e("button",{onClick:()=>s(a.id,o,d.ABSENT),className:"py-1 px-4 rounded-full font-semibold text-sm transition-all border "+(u?.status===d.ABSENT?"bg-red-600 text-white border-transparent shadow":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:"โ ุบุงุฆุจ"})]}),t("div",{className:"flex items-center gap-3",children:[e("span",{className:"inline-block px-2 py-0.5 text-xs font-bold rounded-full "+(a.status===c.ACTIVE?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:a.status===c.ACTIVE?"ูุดุท":"ุบูุฑ ูุดุท"}),e("a",{href:`tel:${a.phone}`,onClick:e=>e.stopPropagation(),className:"p-2 bg-teal-50 text-teal-600 rounded-full hover:bg-teal-100 transition-colors",title:"ุงุชุตุงู",children:e(w,{className:"w-5 h-5"})})]})]})]})})})},Ue=({supervisor:a,teacherAttendance:r,onSetTeacherAttendance:s,onDeductionClick:l,onClick:i})=>{const o=(new Date).toISOString().split("T")[0],u=C.useMemo(()=>r.find(e=>e.teacherId===a.id&&e.date===o),[r,a.id,o]);return e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 ease-in-out hover:shadow-lg "+(a.status===c.INACTIVE?"bg-gray-100 opacity-70":""),children:e("div",{className:"p-4",children:t("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[t("div",{className:"flex items-center gap-4 cursor-pointer flex-grow",onClick:i,role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&i(),children:[e("div",{className:"w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 "+(a.status===c.INACTIVE?"bg-gray-200":"bg-blue-100"),children:e(n,{className:"h-6 w-6 "+(a.status===c.INACTIVE?"text-gray-500":"text-blue-600")})}),t("div",{children:[e("h3",{className:"text-xl font-bold text-gray-800",children:a.name}),e("div",{className:"flex flex-wrap gap-1 mt-1",children:(Array.isArray(a.section)?a.section:[a.section]).map((t,a)=>e("span",{className:"inline-block px-2 py-0.5 text-xs font-semibold bg-indigo-50 text-indigo-700 rounded-md border border-indigo-100",children:t},a))})]})]}),t("div",{className:"flex gap-2",onClick:e=>e.stopPropagation(),children:[e("button",{onClick:()=>s(a.id,o,d.PRESENT),className:"py-2 px-6 rounded-lg font-semibold text-sm transition-all flex-1 "+(u&&u.status!==d.PRESENT?"bg-green-50 text-green-700 border border-green-200 hover:bg-green-100":"bg-green-600 text-white shadow"),children:"โ ุญุงุถุฑ"}),e("button",{onClick:()=>s(a.id,o,d.ABSENT),className:"py-2 px-6 rounded-lg font-semibold text-sm transition-all flex-1 "+(u?.status===d.ABSENT?"bg-red-600 text-white shadow":"bg-red-50 text-red-700 border border-red-200 hover:bg-red-100"),children:"โ ุบุงุฆุจ"})]})]})})})},$e=({className:a})=>t("svg",{xmlns:"http://www.w3.org/2000/svg",className:a,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),We=r=>{const{teachers:s,supervisors:l,groups:i,onViewTeacherDetails:o,onViewSupervisorDetails:u,isFilterVisible:h,searchTerm:m,financialSettings:p,onUpdateFinancialSettings:g,onAddHoliday:b}=r,[x,f]=C.useState("all"),[w,N]=C.useState("active"),[k,S]=C.useState(!1),[T,I]=C.useState(!1),[A,D]=C.useState(null),[E,P]=C.useState("all"),M=C.useMemo(()=>m?(()=>{const e=e=>{const t=m.toLowerCase().trim();return e.sort((e,a)=>{const r=e.name.toLowerCase(),n=a.name.toLowerCase(),s=r.startsWith(t),l=n.startsWith(t);return s&&!l?-1:!s&&l?1:r.localeCompare(n,"ar")})},t=s.filter(e=>{const t=e.name.toLowerCase().includes(m.toLowerCase()),a=e.status===w;return t&&a}),a=l.filter(e=>{const t=e.name.toLowerCase().includes(m.toLowerCase()),a="active"===w?"active"===e.status||!e.status:"inactive"===e.status;return t&&a});return{teachers:e(t),supervisors:e(a)}})():(e=>{const t=e=>{const t=m?m.toLowerCase().trim():"";return e.sort((e,a)=>{const r=e.name.toLowerCase(),n=a.name.toLowerCase();if(m){const e=r.startsWith(t),a=n.startsWith(t);if(e&&!a)return-1;if(!e&&a)return 1;const s=r.split(" ")[0],l=n.split(" ")[0],i=s.startsWith(t),o=l.startsWith(t);if(i&&!o)return-1;if(!i&&o)return 1}return r.localeCompare(n,"ar")})};if("ุงูุฅุดุฑุงู"===e)return t(l.filter(e=>{const t=!m||e.name.toLowerCase().includes(m.toLowerCase()),a="active"===w?"active"===e.status||!e.status:"inactive"===e.status;return t&&a}));if("all"===e)return t(s.filter(e=>{const t=!m||e.name.toLowerCase().includes(m.toLowerCase()),a=e.status===w;return t&&a}));return t(s.filter(t=>{const a=!m||t.name.toLowerCase().includes(m.toLowerCase()),r=t.status===w;if(m)return a&&r;const n=i.filter(e=>e.teacherId===t.id).some(t=>t.name.includes(e));return a&&r&&n}))})(x),[x,s,l,m,E,i,w]),L=(e,t,a=!1)=>{D({teacherId:e,status:t,isSupervisor:a}),S(!0)};return t("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"flex flex-col items-center justify-center mb-6 gap-4",children:t("div",{className:"flex flex-row gap-2 w-auto justify-center items-center flex-wrap",children:[t("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors border border-gray-200",title:"ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ ูุงูุฎุตููุงุช",children:[e(re,{className:"w-5 h-5"}),e("span",{className:"hidden sm:inline text-sm font-semibold",children:"ุงูุฅุนุฏุงุฏุงุช"})]}),t("div",{className:"relative",children:[t("select",{value:x,onChange:e=>f(e.target.value),className:"appearance-none w-full sm:w-auto pl-3 pr-8 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:border-blue-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-200 transition-all cursor-pointer shadow-sm",children:[e("option",{value:"all",children:"ุงููู"}),e("option",{value:"ูุฑุขู",children:"ูุฑุขู"}),e("option",{value:"ููุฑ ุจูุงู",children:"ููุฑ ุจูุงู"}),e("option",{value:"ุชูููู",children:"ุชูููู"}),e("option",{value:"ุฅูุฑุงุก",children:"ุฅูุฑุงุก"}),e("option",{value:"ุงูุฅุดุฑุงู",children:"ุงูุฅุดุฑุงู"})]}),e("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center px-2 text-gray-500",children:e("svg",{className:"fill-current h-3 w-3",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),t("div",{className:"relative",children:[t("select",{value:w,onChange:e=>N(e.target.value),className:"appearance-none w-full sm:w-auto pl-3 pr-8 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:border-blue-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-200 transition-all cursor-pointer shadow-sm",children:[e("option",{value:"active",children:"ูุดุท"}),e("option",{value:"inactive",children:"ุบูุฑ ูุดุท"})]}),e("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center px-2 text-gray-500",children:e("svg",{className:"fill-current h-3 w-3",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]})}),h&&e("div",{className:"bg-white p-5 rounded-xl shadow-lg border border-gray-100 mb-8 animate-fade-in-down",children:e("div",{className:"grid grid-cols-1 gap-6",children:t("div",{children:[e("h4",{className:"text-sm font-bold text-gray-700 mb-3",children:"ุงูุญุงูุฉ"}),t("div",{className:"flex flex-wrap gap-2",children:[e("button",{onClick:()=>P("all"),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("all"===E?"bg-gray-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ุงููู"}),e("button",{onClick:()=>P(c.ACTIVE),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(E===c.ACTIVE?"bg-green-600 text-white":"bg-green-50 text-green-700 hover:bg-green-100"),children:"ูุดุท"}),e("button",{onClick:()=>P(c.INACTIVE),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(E===c.INACTIVE?"bg-yellow-500 text-white":"bg-yellow-50 text-yellow-700 hover:bg-yellow-100"),children:"ุบูุฑ ูุดุท"})]})]})})}),e("div",{className:"space-y-4",children:m?t(a,{children:[M.teachers.length>0&&t(a,{children:[e("h3",{className:"text-lg font-bold text-gray-700 mb-2",children:"ุงููุฏุฑุณูู"}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:M.teachers.map(t=>e(Be,{teacher:t,teacherAttendance:r.teacherAttendance,onSetTeacherAttendance:r.onSetTeacherAttendance,onDeductionClick:(e,t)=>L(e,t,!1),onClick:()=>o(t)},t.id))})]}),M.supervisors.length>0&&t(a,{children:[e("h3",{className:"text-lg font-bold text-gray-700 mb-2 mt-6",children:"ุงููุดุฑููู"}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:M.supervisors.map(t=>e(Ue,{supervisor:t,teacherAttendance:r.teacherAttendance,onSetTeacherAttendance:r.onSetTeacherAttendance,onDeductionClick:(e,t)=>L(e,t,!0),onClick:()=>u(t)},t.id))})]}),0===M.teachers.length&&0===M.supervisors.length&&t("div",{className:"text-center py-20 bg-white rounded-xl shadow border border-gray-100",children:[e("div",{className:"bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e($e,{className:"w-8 h-8 text-gray-400"})}),e("h2",{className:"text-xl font-semibold text-gray-700",children:"ูุง ุชูุฌุฏ ูุชุงุฆุฌ"}),t("p",{className:"text-gray-500 mt-2",children:['ูุง ููุฌุฏ ูุฏุฑุณูู ุฃู ูุดุฑููู ูุทุงุจููู ุงูุจุญุซ "',m,'"']})]})]}):e(a,{children:t(a,"ุงูุฅุดุฑุงู"===x?{children:[e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:M.map(t=>e(Ue,{supervisor:t,teacherAttendance:r.teacherAttendance,onSetTeacherAttendance:r.onSetTeacherAttendance,onDeductionClick:(e,t)=>L(e,t,!0),onClick:()=>u(t)},t.id))}),0===M.length&&t("div",{className:"text-center py-20 bg-white rounded-xl shadow border border-gray-100",children:[e("div",{className:"bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e(n,{className:"w-8 h-8 text-gray-400"})}),e("h2",{className:"text-xl font-semibold text-gray-700",children:"ูุง ููุฌุฏ ูุดุฑููู"}),e("p",{className:"text-gray-500 mt-2",children:"all"!==E?"ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ.":"ูู ุจุฅุถุงูุฉ ูุดุฑููู ุฌุฏุฏ."})]})]}:{children:[e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:M.map(t=>e(Be,{teacher:t,teacherAttendance:r.teacherAttendance,onSetTeacherAttendance:r.onSetTeacherAttendance,onDeductionClick:(e,t)=>L(e,t,!1),onClick:()=>o(t)},t.id))}),0===M.length&&t("div",{className:"text-center py-20 bg-white rounded-xl shadow border border-gray-100",children:[e("div",{className:"bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e($e,{className:"w-8 h-8 text-gray-400"})}),e("h2",{className:"text-xl font-semibold text-gray-700",children:"ูุง ููุฌุฏ ูุฏุฑุณูู"}),e("p",{className:"text-gray-500 mt-2",children:"all"!==E?"ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ.":"ูู ุจุฅุถุงูุฉ ูุฏุฑุณูู ุฌุฏุฏ ููุจุฏุก."})]})]})})}),A&&e(y,{isOpen:k,onClose:()=>S(!1),onConfirm:e=>{if(!A)return;const{teacherId:t,status:a,isSupervisor:n}=A;if(!(n?l.find(e=>e.id===t)?.name:s.find(e=>e.id===t)?.name))return;r.onSetTeacherAttendance(t,(new Date).toISOString().split("T")[0],a,e);const i=`โ๏ธ ุชู ุชุณุฌูู ุฎุตู ุนููู (${a===d.HALF_DAY?"ูุตู ููู":"ุฑุจุน ููู"}) ูุฐูู ูู: "${e}".`;r.onSendNotificationToTeacher(t,i),S(!1),D(null)},teacherName:A.isSupervisor?l.find(e=>e.id===A.teacherId)?.name||"":s.find(e=>e.id===A.teacherId)?.name||""}),T&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 backdrop-blur-sm",children:t("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-md animate-scale-up",children:[t("div",{className:"flex justify-between items-center mb-6",children:[t("h3",{className:"font-bold text-xl text-gray-800 flex items-center gap-2",children:[e(re,{className:"w-6 h-6 text-gray-600"}),"ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ ูุงูุฎุตููุงุช"]}),e("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-600",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t("div",{className:"space-y-6",children:[t("div",{children:[e("label",{htmlFor:"workingDays",className:"block text-gray-600 mb-1 font-semibold",children:"ุฃูุงู ุงูุนูู ูู ุงูุดูุฑ"}),e("input",{id:"workingDays",type:"number",value:p.workingDaysPerMonth,onChange:e=>g({...p,workingDaysPerMonth:parseInt(e.target.value)||0}),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"ูุซุงู: 22"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"ูุณุชุฎุฏู ูุฐุง ุงูุฑูู ูุญุณุงุจ ูููุฉ ุงูููููุฉ ุนูุฏ ุฎุตู ุงูุบูุงุจ."})]}),t("div",{children:[e("label",{htmlFor:"deductionPercentage",className:"block text-gray-600 mb-1 font-semibold",children:"ูุณุจุฉ ุงูุฎุตู ููุบูุงุจ (%)"}),e("input",{id:"deductionPercentage",type:"number",value:p.absenceDeductionPercentage,onChange:e=>g({...p,absenceDeductionPercentage:parseInt(e.target.value)||0}),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"ูุซุงู: 100"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"100% ุชุนูู ุฎุตู ูููุฉ ููู ูุงูู. 150% ุชุนูู ุฎุตู ููู ููุตู (ุนููุจุฉ)."})]}),t("div",{className:"border-t pt-4",children:[t("h4",{className:"font-bold text-gray-700 mb-2 flex items-center gap-2",children:[e("span",{children:"๐"})," ุฅุฌุงุฒุงุช ุงููุฑูุฒ ุงูุฑุณููุฉ"]}),t("p",{className:"text-sm text-gray-600 mb-3 bg-blue-50 p-2 rounded",children:["โน๏ธ ุนูุฏ ุฅุถุงูุฉ ุชุงุฑูุฎ ููุงุ ุณูุชู ",e("b",{children:"ุชููุงุฆูุงู ุญุฐู ุฌููุน ุงูุฎุตููุงุช ูุงูุฅุดุนุงุฑุงุช"})," ุงููุชุนููุฉ ุจูุฐุง ุงูููู ูุฌููุน ุงููุฏุฑุณูู."]}),t("div",{className:"flex gap-2 mb-4",children:[e("input",{type:"date",id:"new-holiday-manager",className:"flex-1 px-4 py-1.5 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm"}),e("button",{onClick:()=>{const e=document.getElementById("new-holiday-manager"),t=e.value;t&&!p.publicHolidays?.includes(t)&&(b?b(t):g({...p,publicHolidays:[...p.publicHolidays||[],t]}),e.value="")},className:"px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"ุฅุถุงูุฉ ุฅุฌุงุฒุฉ"})]}),t("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:[(p.publicHolidays||[]).sort().map(a=>t("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded border group",children:[e("span",{className:"text-xs text-gray-700 font-medium",children:new Date(a).toLocaleDateString("ar-EG",{weekday:"long",month:"long",day:"numeric"})}),e("button",{onClick:()=>{g({...p,publicHolidays:p.publicHolidays?.filter(e=>e!==a)})},className:"text-red-400 hover:text-red-600 p-1",children:e(v,{className:"w-3.5 h-3.5"})})]},a)),(!p.publicHolidays||0===p.publicHolidays.length)&&e("p",{className:"text-gray-400 text-xs text-center py-2",children:"ูู ูุชู ุชุณุฌูู ุฅุฌุงุฒุงุช ุจุนุฏ."})]})]})]}),e("div",{className:"pt-4 flex justify-end items-center border-t mt-4",children:e("button",{onClick:()=>I(!1),className:"px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-colors",children:"ุฅุบูุงู"})})]})})]})},_e=({students:a,groups:r,onPayDebt:n,onViewDetails:s,currentUserRole:l,searchTerm:i})=>{const o=C.useMemo(()=>a.filter(e=>{const t=e.isArchived&&e.hasDebt&&e.debtMonths&&e.debtMonths.length>0,a=!i||e.name.includes(i);return t&&a}).sort((e,t)=>{if(i){const a=i.toLowerCase(),r=e.name.toLowerCase(),n=t.name.toLowerCase(),s=r.startsWith(a),l=n.startsWith(a);if(s&&!l)return-1;if(!s&&l)return 1}return e.name.localeCompare(t.name,"ar")}),[a,i]);return t("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{className:"mb-6",children:[e("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ุงููุฏูููู"}),e("p",{className:"text-gray-600",children:"ุงูุทูุงุจ ุงููุคุฑุดููู ุงูุฐูู ูุฏููู ูุตุฑููุงุช ูุณุชุญูุฉ (ุญุถุฑูุง 10 ุญุตุต ุฃู ุฃูุซุฑ ููู ูุฏูุนูุง)"})]}),e("div",{className:"space-y-6",children:o.length>0?o.map(a=>{const l=(e=>e.debtMonths?e.debtMonths.length*e.monthlyFee:0)(a),i=a.debtMonths?.map(e=>new Date(e+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"})).join("ุ ")||"";return e("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:t("div",{className:"p-4",children:[t("div",{className:"flex items-center justify-between mb-3",children:[t("div",{children:[e("h3",{className:"text-xl font-bold text-gray-800",children:a.name}),e("p",{className:"text-sm text-gray-500",children:r.find(e=>e.id===a.groupId)?.name})]}),t("div",{className:"text-right",children:[t("p",{className:"text-2xl font-bold text-red-600",children:[l," ุฌ.ู"]}),e("p",{className:"text-xs text-gray-500",children:"ุฅุฌูุงูู ุงูุฏูู"})]})]}),t("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[e("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"ุงูุฃุดูุฑ ุงููุณุชุญูุฉ:"}),e("p",{className:"text-sm text-red-700",children:i})]}),t("div",{className:"flex flex-wrap gap-2",children:[a.debtMonths?.map(e=>{const r=new Date(e+"-02").toLocaleString("ar-EG",{month:"long",year:"numeric"});return t("button",{onClick:()=>n(a.id,e,a.monthlyFee),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-semibold",children:["ุฏูุน ",r]},e)}),e("button",{onClick:()=>s(a),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold",children:"ุนุฑุถ ุงูุชูุงุตูู"})]})]})},a.id)}):t("div",{className:"text-center py-20 bg-white rounded-xl shadow",children:[e("h2",{className:"text-2xl font-semibold text-gray-600",children:"ูุง ููุฌุฏ ูุฏูููู"}),e("p",{className:"text-gray-400 mt-2",children:"ุฌููุน ุงูุทูุงุจ ุงููุคุฑุดููู ูุฏ ุณุฏุฏูุง ูุณุชุญูุงุชูู"})]})})]})},Ge=({isOpen:a,onClose:r,groups:n,students:s,teachers:l,onAddGroup:i,onUpdateGroup:o,onDeleteGroup:d})=>{const[u,h]=C.useState(""),[m,p]=C.useState(""),[g,b]=C.useState(null),[x,f]=C.useState(""),[w,y]=C.useState(""),v=l.filter(e=>e.status===c.ACTIVE);if(C.useEffect(()=>{a||(h(""),p(""),b(null),f(""),y(""))},[a]),!a)return null;const N=e=>s.some(t=>t.groupId===e&&!t.isArchived),k=()=>{b(null),f(""),y("")};return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-2xl m-4 flex flex-col max-h-[90vh]",children:[t("div",{className:"flex-shrink-0 flex justify-between items-center mb-6",children:[e("h2",{className:"text-2xl font-bold text-gray-700",children:"ุฅุฏุงุฑุฉ ุงููุฌููุนุงุช"}),e("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 text-3xl","aria-label":"ุฅุบูุงู",children:"ร"})]}),t("form",{onSubmit:e=>{e.preventDefault(),u.trim()&&(i(u.trim(),m||void 0),h(""),p(""))},className:"flex-shrink-0 grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-6",children:[t("div",{className:"md:col-span-2",children:[e("label",{htmlFor:"newGroupName",className:"block text-sm font-medium text-gray-600 mb-1",children:"ุงุณู ุงููุฌููุนุฉ ุงูุฌุฏูุฏุฉ"}),e("input",{id:"newGroupName",type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"ุงุณู ุงููุฌููุนุฉ",className:"w-full px-4 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),t("div",{children:[e("label",{htmlFor:"newGroupTeacher",className:"block text-sm font-medium text-gray-600 mb-1",children:"ุงููุฏุฑุณ ุงููุณุคูู"}),t("select",{id:"newGroupTeacher",value:m,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"",children:"ุจูุง ูุฏุฑุณ"}),v.map(t=>e("option",{value:t.id,children:t.name},t.id))]})]}),e("button",{type:"submit",className:"md:col-span-3 px-6 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:"ุฅุถุงูุฉ ูุฌููุนุฉ"})]}),e("div",{className:"flex-grow space-y-3 overflow-y-auto pr-2",children:n.length>0?[...n].sort((e,t)=>e.name.localeCompare(t.name,"ar")).map(a=>{const r=g===a.id,n=l.find(e=>e.id===a.teacherId);return e("div",{className:"bg-gray-100 p-3 rounded-lg",children:t("div",r?{className:"space-y-3",children:[e("input",{type:"text",value:x,onChange:e=>f(e.target.value),className:"w-full px-2 py-1 border rounded-lg bg-white focus:outline-none focus:ring-1 focus:ring-blue-500"}),t("select",{value:w,onChange:e=>y(e.target.value),className:"w-full px-2 py-1 border rounded-lg bg-white focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e("option",{value:"",children:"ุจูุง ูุฏุฑุณ"}),v.map(t=>e("option",{value:t.id,children:t.name},t.id))]}),t("div",{className:"flex gap-2 justify-end",children:[e("button",{onClick:()=>{return e=a.id,void(x.trim()&&(o(e,x.trim(),w||void 0),k()));var e},className:"px-3 py-1 text-sm rounded-lg text-white bg-green-600 hover:bg-green-700",children:"ุญูุธ"}),e("button",{onClick:k,className:"px-3 py-1 text-sm rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300",children:"ุฅูุบุงุก"})]})]}:{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[t("div",{children:[e("span",{className:"font-semibold text-gray-800",children:a.name}),n&&t("div",{className:"text-xs text-gray-500",children:["ุงููุฏุฑุณ: ",n.name]})]}),t("div",{className:"flex gap-2 items-center self-end sm:self-center",children:[e("button",{onClick:()=>(e=>{b(e.id),f(e.name),y(e.teacherId)})(a),className:"px-3 py-1 text-sm rounded-lg text-blue-700 bg-blue-100 hover:bg-blue-200",children:"ุชุนุฏูู"}),e("button",{onClick:()=>d(a.id),className:"px-3 py-1 text-sm rounded-lg text-red-700 bg-red-100 hover:bg-red-200 disabled:bg-gray-200 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:N(a.id),title:N(a.id)?"ูุง ูููู ุญุฐู ูุฌููุนุฉ ุจูุง ุทูุงุจ":"ุญุฐู ุงููุฌููุนุฉ",children:"ุญุฐู"})]})]})},a.id)}):e("p",{className:"text-center text-gray-500 py-4",children:"ูุง ุชูุฌุฏ ูุฌููุนุงุช. ูู ุจุฅุถุงูุฉ ูุฌููุนุฉ ุฌุฏูุฏุฉ."})}),e("div",{className:"flex-shrink-0 mt-8 flex justify-end",children:e("button",{type:"button",onClick:r,className:"px-8 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors",children:"ุฅุบูุงู"})})]})})},ze=({isOpen:a,onClose:s,onSaveTeacher:l,onSaveSupervisor:o,teacherToEdit:d,supervisorToEdit:u})=>{const[h,m]=C.useState("teacher"),[p,g]=C.useState(""),[b,x]=C.useState(""),[f,y]=C.useState(""),[v,k]=C.useState(""),[S,T]=C.useState(c.ACTIVE),[I,A]=C.useState(N.SALARY),[D,E]=C.useState(""),[P,M]=C.useState(["ูุฑุขู"]);C.useEffect(()=>{if(a)if(u){m("supervisor"),g(u.name),k(u.phone||""),x(u.salary?.toString()||""),T(u.status||c.ACTIVE),y(u.password);const e=Array.isArray(u.section)?u.section:u.section?[u.section]:[];M(e)}else d?(m("teacher"),g(d.name),k(d.phone),x(d.salary?.toString()||""),T(d.status),y(""),A(d.paymentType||N.SALARY),E(d.partnershipPercentage?.toString()||"")):(g(""),k(""),x(""),T(c.ACTIVE),y(""),M(["ูุฑุขู"]),A(N.SALARY),E(""))},[a,d,u]);return a?e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[60] flex justify-center items-center p-4 backdrop-blur-sm transition-opacity",children:t("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh] animate-fade-in-up",children:[t("div",{className:"bg-gray-50 px-6 py-4 border-b flex justify-between items-center",children:[e("h2",{className:"text-xl font-bold text-gray-800",children:d?"ุชุนุฏูู ุจูุงูุงุช ุงููุฏุฑุณ":u?"ุชุนุฏูู ุจูุงูุงุช ุงููุดุฑู":"ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ"}),e("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"ร"})]}),t("div",{className:"p-6 overflow-y-auto",children:[!d&&!u&&t("div",{className:"flex mb-6 bg-gray-100 p-1 rounded-lg",children:[t("button",{type:"button",onClick:()=>m("teacher"),className:"flex-1 flex items-center justify-center gap-2 py-2 rounded-md text-sm font-bold transition-all duration-200 "+("teacher"===h?"bg-white text-teal-700 shadow":"text-gray-500 hover:bg-gray-200"),children:[e(r,{className:"w-4 h-4"}),"ูุฏุฑุณ"]}),t("button",{type:"button",onClick:()=>m("supervisor"),className:"flex-1 flex items-center justify-center gap-2 py-2 rounded-md text-sm font-bold transition-all duration-200 "+("supervisor"===h?"bg-white text-blue-700 shadow":"text-gray-500 hover:bg-gray-200"),children:[e(n,{className:"w-4 h-4"}),"ูุดุฑู"]})]}),t("form",{onSubmit:e=>{if(e.preventDefault(),"teacher"===h)if(p.trim()&&v.trim()){if(I===N.PARTNERSHIP){const e=parseFloat(D);if(!D||e<=0||e>100)return void alert("ูุฑุฌู ุฅุฏุฎุงู ูุณุจุฉ ุดุฑุงูุฉ ุตุญูุญุฉ (ูู 1 ุฅูู 100)")}const e={name:p.trim(),phone:v.trim(),status:S,paymentType:I};I===N.SALARY?e.salary=parseFloat(b)||0:e.partnershipPercentage=parseFloat(D),f.trim()&&(e.password=f.trim()),l(e,d?.id),s()}else alert("ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู ูุฑูู ุงููุงุชู ูููุฏุฑุณ");else p.trim()&&f.trim()&&P.length>0?(o({name:p.trim(),password:f.trim(),section:P,salary:parseFloat(b)||0,phone:v.trim(),status:S},u?.id),s()):alert("ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณูุ ูููุฉ ุงููุฑูุฑุ ูุงุฎุชูุงุฑ ูุณู ูุงุญุฏ ุนูู ุงูุฃูู ูููุดุฑู")},className:"space-y-5",children:[t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{className:"col-span-2 md:col-span-1",children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ุงูุงุณู"}),t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e(n,{className:"h-4 w-4 text-gray-400"})}),e("input",{type:"text",value:p,onChange:e=>g(e.target.value),className:"w-full pr-10 pl-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",placeholder:"ุงูุงุณู ุงููุงูู",required:!0})]})]}),t("div",{className:"col-span-2 md:col-span-1",children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ุฑูู ุงููุงุชู"}),t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e(w,{className:"h-4 w-4 text-gray-400"})}),e("input",{type:"tel",value:v,onChange:e=>k(e.target.value),className:"w-full pr-10 pl-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",placeholder:"ุฑูู ุงููุงุชู",required:"teacher"===h})]})]})]}),"teacher"===h&&t("div",{className:"bg-gradient-to-r from-teal-50 to-green-50 p-4 rounded-xl border border-teal-100",children:[e("label",{className:"block text-sm font-bold text-teal-800 mb-3",children:"ููุน ุงููุญุงุณุจุฉ:"}),t("div",{className:"flex gap-3",children:[e("button",{type:"button",onClick:()=>A(N.SALARY),className:"flex-1 px-4 py-3 rounded-lg text-sm font-semibold transition-all duration-200 border "+(I===N.SALARY?"bg-teal-600 text-white border-teal-600 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200 hover:border-teal-300 hover:bg-teal-50"),children:"๐ฐ ุฑุงุชุจ ุซุงุจุช"}),e("button",{type:"button",onClick:()=>A(N.PARTNERSHIP),className:"flex-1 px-4 py-3 rounded-lg text-sm font-semibold transition-all duration-200 border "+(I===N.PARTNERSHIP?"bg-green-600 text-white border-green-600 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200 hover:border-green-300 hover:bg-green-50"),children:"๐ค ุดุฑุงูุฉ"})]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["teacher"===h?I===N.SALARY?t("div",{children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ุงูุฑุงุชุจ ุงูุฃุณุงุณู"}),t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e(i,{className:"h-4 w-4 text-gray-400"})}),e("input",{type:"number",value:b,onChange:e=>x(e.target.value),className:"w-full pr-10 pl-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-teal-500 transition-shadow",placeholder:"0.00"})]})]}):t("div",{children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ูุณุจุฉ ุงูุดุฑุงูุฉ (%)"}),t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e("span",{className:"text-gray-400 font-bold",children:"%"})}),e("input",{type:"number",value:D,onChange:e=>E(e.target.value),className:"w-full pr-10 pl-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-green-500 transition-shadow",placeholder:"ูุซุงู: 30",min:"1",max:"100",step:"0.1"})]}),e("p",{className:"text-xs text-gray-500 mt-1",children:"ุฃุฏุฎู ุงููุณุจุฉ ุงููุฆููุฉ ูู ุงููุญุตู (ูู 1 ุฅูู 100)"})]}):t("div",{children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ุงูุฑุงุชุจ ุงูุฃุณุงุณู"}),t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e(i,{className:"h-4 w-4 text-gray-400"})}),e("input",{type:"number",value:b,onChange:e=>x(e.target.value),className:"w-full pr-10 pl-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",placeholder:"0.00"})]})]}),t("div",{children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ูููุฉ ุงููุฑูุฑ"}),e("input",{type:"text",value:f,onChange:e=>y(e.target.value),placeholder:d?"ุงุชุฑู ูุงุฑุบุงู ูุนุฏู ุงูุชุบููุฑ":"ูููุฉ ุงููุฑูุฑ",className:"w-full px-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",required:!d&&!u||"supervisor"===h})]})]}),t("div",{children:[e("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"ุงูุญุงูุฉ"}),t("select",{value:S,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow",children:[e("option",{value:c.ACTIVE,children:"ูุดุท"}),e("option",{value:c.INACTIVE,children:"ุบูุฑ ูุดุท"})]})]}),"supervisor"===h&&t("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100",children:[e("label",{className:"block text-sm font-bold text-blue-800 mb-3",children:"ุงูุฃูุณุงู ุงููุณุคูู ุนููุง:"}),e("div",{className:"flex flex-wrap gap-2",children:["ูุฑุขู","ููุฑ ุจูุงู","ุชูููู"].map(a=>{const r=P.includes(a);return t("button",{type:"button",onClick:()=>{return e=a,void M(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]);var e},className:"px-4 py-2 rounded-full text-sm font-semibold transition-all duration-200 border "+(r?"bg-blue-600 text-white border-blue-600 shadow-md transform scale-105":"bg-white text-gray-600 border-gray-200 hover:border-blue-300 hover:bg-blue-50"),children:[a,r&&e("span",{className:"mr-2 text-blue-200",children:"โ"})]},a)})}),0===P.length&&e("p",{className:"text-xs text-red-500 mt-2",children:"ูุฌุจ ุงุฎุชูุงุฑ ูุณู ูุงุญุฏ ุนูู ุงูุฃูู."})]}),t("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t mt-6",children:[e("button",{type:"button",onClick:s,className:"px-6 py-2.5 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 font-semibold transition-colors order-2 sm:order-1",children:"ุฅูุบุงุก"}),e("button",{type:"submit",className:"px-8 py-2.5 rounded-lg text-white font-bold shadow-lg transform hover:-translate-y-0.5 transition-all order-1 sm:order-2 "+("teacher"===h?"bg-teal-600 hover:bg-teal-700 shadow-teal-500/30":"bg-blue-600 hover:bg-blue-700 shadow-blue-500/30"),children:"ุญูุธ ุงูุจูุงูุงุช"})]})]})]})]})}):null},He=({onLogin:a,parents:r})=>{const[n,s]=C.useState(""),[l,i]=C.useState(""),[o,d]=C.useState("");return t("div",{className:"w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t("div",{className:"text-center mb-8",children:[e("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-teal-100 rounded-full mb-4",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-teal-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e("h2",{className:"text-2xl font-bold text-gray-800 mb-1",children:"ุชุณุฌูู ุฏุฎูู ููู ุงูุฃูุฑ"}),e("p",{className:"text-gray-500 text-sm",children:"ุฃููุงู ุจู ูู ุจูุงุจุฉ ุฃูููุงุก ุฃููุฑ ูุฑูุฒ ุงูุดุงุทุจู"})]}),t("form",{onSubmit:e=>{if(e.preventDefault(),d(""),11!==n.length)return void d("ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู 11 ุฑูู");if(6!==l.length||!/^\d+$/.test(l))return void d("ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 6 ุฃุฑูุงู");const t="02"+n,s=r.find(e=>e.phone===t);s?s.password===l?a(t,l):d("ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ"):d("ูุง ููุฌุฏ ุญุณุงุจ ูุณุฌู ุจูุฐุง ุงูุฑูู. ูุฑุฌู ุงูุชูุงุตู ูุน ุงูุฅุฏุงุฑุฉ")},className:"space-y-5",children:[t("div",{children:[t("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1.5 flex justify-between",children:[e("span",{children:"ุฑูู ุงููุงุชู"}),t("span",{className:"text-xs "+(11===n.length?"text-green-500":"text-gray-400"),children:[n.length,"/11"]})]}),e("div",{className:"relative",children:e("input",{type:"tel",id:"phone",value:n,onChange:e=>(e=>{const t=e.replace(/\D/g,"");s(t.slice(0,11))})(e.target.value),placeholder:"01xxxxxxxxx",className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-100 rounded-xl focus:bg-white focus:border-teal-500 focus:ring-4 focus:ring-teal-500/10 transition-all text-center text-lg font-semibold tracking-wider outline-none",dir:"ltr"})})]}),t("div",{children:[t("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1.5 flex justify-between",children:[e("span",{children:"ูููุฉ ุงููุฑูุฑ (6 ุฃุฑูุงู)"}),t("span",{className:"text-xs "+(6===l.length?"text-green-500":"text-gray-400"),children:[l.length,"/6"]})]}),e("div",{className:"relative",children:e("input",{type:"password",id:"password",value:l,onChange:e=>(e=>{const t=e.replace(/\D/g,"");i(t.slice(0,6))})(e.target.value),placeholder:"โขโขโขโขโขโข",className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-100 rounded-xl focus:bg-white focus:border-teal-500 focus:ring-4 focus:ring-teal-500/10 transition-all text-center text-2xl font-bold tracking-[0.5em] outline-none",dir:"ltr"})})]}),o&&t("div",{className:"flex items-center gap-2 bg-red-50 border border-red-100 text-red-600 px-4 py-3 rounded-xl text-sm animate-shake",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e("p",{children:o})]}),e("button",{type:"submit",className:"w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 rounded-xl transition-all duration-300 shadow-lg shadow-teal-500/20 active:scale-[0.98] text-lg",children:"ุฏุฎูู ุงูุจูุงุจุฉ"})]}),t("div",{className:"mt-8 text-center bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e("p",{className:"text-sm text-gray-600 mb-1",children:"ูุณูุช ุจูุงูุงุช ุงูุฏุฎููุ"}),e("p",{className:"text-xs text-gray-500",children:"ูุฑุฌู ูุฑุงุฌุนุฉ ุฅุฏุงุฑุฉ ุงููุฑูุฒ ููุญุตูู ุนูู ุจูุงูุงุช ุญุณุงุจู."})]})]})},Ye=({students:a,groups:r,onViewStudent:s,parentPhone:l})=>e("div",{className:"p-4 sm:p-6 lg:p-8 animate-in fade-in duration-500",dir:"rtl",children:t("div",{className:"max-w-6xl mx-auto",children:[e("div",{className:"bg-white/80 backdrop-blur-md rounded-[2rem] shadow-xl shadow-black/5 p-8 mb-10 border border-white/50",children:t("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[t("div",{className:"text-center md:text-right",children:[e("h1",{className:"text-4xl font-black text-gray-900 mb-2",children:"ูุฑุญุจุงู ุจู"}),e("p",{className:"text-gray-500 text-lg font-medium",children:"ููุญุฉ ุชุญูู ููู ุงูุฃูุฑ - ูุฑูุฒ ุงูุดุงุทุจู"})]}),e("div",{className:"bg-gradient-to-br from-teal-50 to-blue-50 rounded-2xl p-4 border border-teal-100/50 shadow-inner",children:t("div",{className:"flex items-center gap-3 text-teal-700",children:[e("div",{className:"bg-white p-2 rounded-xl shadow-sm",children:e(w,{className:"w-6 h-6"})}),e("span",{className:"font-bold text-lg tracking-wider",dir:"ltr",children:l})]})})]})}),t("div",{className:"flex items-center gap-4 mb-8",children:[e("div",{className:"h-8 w-2 bg-teal-500 rounded-full"}),t("h2",{className:"text-2xl font-black text-gray-800",children:["ุฃุจูุงุฆู ุงูุทูุงุจ (",a.length,")"]})]}),0===a.length?t("div",{className:"bg-white/80 backdrop-blur-sm rounded-[2.5rem] p-16 text-center border-2 border-dashed border-gray-200",children:[e("div",{className:"bg-gray-50 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6",children:e(n,{className:"w-12 h-12 text-gray-300"})}),e("p",{className:"text-gray-500 text-xl font-bold",children:"ูุง ููุฌุฏ ุทูุงุจ ูุณุฌููู ุจูุฐุง ุงูุฑูู"}),e("p",{className:"text-gray-400 mt-2",children:"ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุฅุฏุงุฑุฉ ูุชุญุฏูุซ ุจูุงูุงุชู"})]}):e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:a.map(a=>{const l=(e=>{const t=(new Date).toISOString().split("T")[0].substring(0,7),a=(e.attendance||[]).length,r=(e.attendance||[]).filter(e=>"present"===e.status).length,n=(e.tests||[]).slice(-5),s=(e.fees||[]).find(e=>e.month===t);return{totalAttendance:a,presentCount:r,recentTests:n,isPaidThisMonth:s?.paid||!1,currentMonthFee:s}})(a),i=r.find(e=>e.id===a.groupId);return t("div",{onClick:()=>s(a),className:"group relative bg-white rounded-[2.5rem] shadow-xl shadow-black/5 hover:shadow-2xl hover:shadow-teal-500/10 transition-all duration-500 cursor-pointer overflow-hidden border border-gray-100 flex flex-col h-full active:scale-[0.98]",children:[e("div",{className:"absolute top-0 right-0 w-32 h-32 bg-teal-500/5 rounded-full -mr-16 -mt-16 group-hover:scale-150 transition-transform duration-700"}),t("div",{className:"p-8 pb-4 relative",children:[t("div",{className:"flex items-start justify-between mb-4",children:[e("div",{className:"bg-gradient-to-br from-teal-500 to-emerald-600 p-4 rounded-2xl shadow-lg shadow-teal-500/20 text-white transform group-hover:rotate-6 transition-transform duration-500",children:e(n,{className:"w-8 h-8"})}),e("div",{className:"px-4 py-1.5 rounded-full text-xs font-black uppercase tracking-widest "+(l.isPaidThisMonth?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:l.isPaidThisMonth?"ูุฏููุน":"ูุทููุจ ุณุฏุงุฏ"})]}),e("h3",{className:"text-2xl font-black text-gray-800 mb-1 group-hover:text-teal-600 transition-colors",children:a.name}),t("div",{className:"flex items-center gap-2 text-gray-500 font-bold",children:[e("span",{className:"w-2 h-2 bg-teal-400 rounded-full"}),e("p",{className:"text-sm",children:i?.name||"ุบูุฑ ูุญุฏุฏ"})]})]}),t("div",{className:"px-8 pb-8 pt-4 flex-1",children:[t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"bg-gray-50 p-4 rounded-[1.5rem] border border-gray-100",children:[e("p",{className:"text-gray-400 text-xs font-bold mb-1",children:"ูุณุจุฉ ุงูุญุถูุฑ"}),t("div",{className:"flex items-baseline gap-1",children:[e("span",{className:"text-2xl font-black text-gray-800",children:l.presentCount}),t("span",{className:"text-gray-400 text-sm",children:["/ ",l.totalAttendance]})]})]}),t("div",{className:"bg-gray-50 p-4 rounded-[1.5rem] border border-gray-100",children:[e("p",{className:"text-gray-400 text-xs font-bold mb-1",children:"ุขุฎุฑ ุงูุงุฎุชุจุงุฑุงุช"}),e("span",{className:"text-xl font-black text-gray-800",children:l.recentTests.length}),e("span",{className:"text-gray-400 text-xs mr-1",children:"ุงุฎุชุจุงุฑุงุช"})]})]}),t("div",{className:"mt-8 flex items-center justify-center text-teal-600 font-black text-sm group-hover:gap-3 transition-all",children:[e("span",{children:"ุนุฑุถ ุงูุชูุงุตูู ูุงูุชูุงุฑูุฑ"}),e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M15 19l-7-7 7-7"})})]})]})]},a.id)})})]})}),qe=({student:a,group:r,teacher:n,onClose:s,onOpenChat:l})=>{const[i,o]=C.useState("tests"),d=e=>{switch(e){case p.NEW:return"ุฌุฏูุฏ";case p.RECENT_PAST:return"ูุฑูุจ ูุงุถู";case p.DISTANT_PAST:return"ุจุนูุฏ ูุงุถู";case p.READING:return"ูุฑุงุกุฉ";default:return e}},c=e=>new Date(e).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"});return t("div",{className:"fixed inset-0 bg-gradient-to-br from-gray-50 via-teal-50/20 to-blue-50/20 z-[100] flex flex-col",dir:"rtl",children:[t("div",{className:"bg-white/90 backdrop-blur-xl border-b border-gray-100 pt-6 pb-5 px-4 relative overflow-hidden shadow-sm",children:[e("div",{className:"absolute top-0 right-0 w-48 h-48 bg-teal-500/10 blur-[60px] rounded-full -mr-24 -mt-24"}),e("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-blue-500/10 blur-[60px] rounded-full -ml-24 -mb-24"}),t("div",{className:"max-w-4xl mx-auto relative z-10",children:[e("button",{onClick:s,className:"bg-gray-100 hover:bg-gray-200 p-2.5 rounded-xl transition-all duration-300 text-gray-600 hover:scale-105 active:scale-95 shadow-sm mb-3",children:e(f,{className:"w-5 h-5"})}),e("h1",{className:"text-3xl md:text-4xl font-black text-gray-900 tracking-tight mb-3",children:a.name}),t("div",{className:"flex flex-wrap items-center gap-2",children:[t("div",{className:"bg-white/80 backdrop-blur-sm px-4 py-2 rounded-xl shadow-sm border border-gray-100 flex items-center gap-2",children:[e("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-pulse"}),e("span",{className:"text-xs md:text-sm font-bold text-gray-700",children:r?.name||"ุบูุฑ ูุญุฏุฏ"})]}),n&&t("div",{className:"bg-white/80 backdrop-blur-sm px-4 py-2 rounded-xl shadow-sm border border-gray-100 flex items-center gap-2",children:[e("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),t("span",{className:"text-xs md:text-sm font-bold text-gray-700",children:["ุฃ/ ",n.name]}),l&&e("button",{onClick:l,className:"bg-teal-500 hover:bg-teal-600 p-1.5 rounded-lg transition-all duration-300 text-white hover:scale-110 active:scale-95 shadow-md shadow-teal-500/30",title:"ุงููุญุงุฏุซุฉ ูุน ุงููุฏุฑุณ",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})]})]})]})]}),e("div",{className:"flex-1 overflow-y-auto pb-24",children:t("div",{className:"max-w-4xl mx-auto p-4 md:p-6",children:["tests"===i&&(()=>{const r=[...a.tests||[]].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return t("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t("div",{className:"flex items-center justify-between",children:[e("h3",{className:"text-xl font-black text-gray-800",children:"ุณุฌู ุงูุงุฎุชุจุงุฑุงุช"}),t("span",{className:"bg-gray-200 text-gray-600 px-3 py-1 rounded-full text-xs font-bold uppercase",children:[(a.tests||[]).length," ุงุฎุชุจุงุฑ"]})]}),0===r.length?e("div",{className:"text-center py-20 bg-white/40 backdrop-blur-sm rounded-[2rem] border-2 border-dashed border-gray-200",children:e("p",{className:"text-gray-500 font-bold",children:"ูุง ุชูุฌุฏ ุงุฎุชุจุงุฑุงุช ูุณุฌูุฉ ุญุชู ุงูุขู"})}):e("div",{className:"grid grid-cols-1 gap-4",children:r.map(a=>{const r=(e=>{switch(e){case g.EXCELLENT:return{label:"ููุชุงุฒ",color:"text-green-600 bg-green-100"};case g.VERY_GOOD:return{label:"ุฌูุฏ ุฌุฏุงู",color:"text-blue-600 bg-blue-100"};case g.GOOD:return{label:"ุฌูุฏ",color:"text-yellow-600 bg-yellow-100"};case g.REPEAT:return{label:"ูุนุงุฏ",color:"text-red-600 bg-red-100"};default:return{label:e,color:"text-gray-600 bg-gray-100"}}})(a.grade);return t("div",{className:"bg-white rounded-[1.5rem] p-5 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300",children:[t("div",{className:"flex items-start justify-between mb-4",children:[t("div",{children:[e("h4",{className:"text-lg font-black text-gray-800 mb-1",children:a.suraName}),t("div",{className:"flex items-center gap-2",children:[e("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),e("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:d(a.type)})]})]}),e("span",{className:`px-4 py-1.5 rounded-full text-xs font-black uppercase shadow-sm ${r.color}`,children:r.label})]}),e("div",{className:"pt-4 border-t border-gray-50 flex items-center justify-between",children:t("div",{className:"flex items-center gap-2 text-gray-400",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e("span",{className:"text-xs font-bold",children:c(a.date)})]})})]},a.id)})})]})})(),"fees"===i&&(()=>{const r=[...a.fees||[]].sort((e,t)=>t.month.localeCompare(e.month));return t("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t("div",{className:"flex items-center justify-between",children:[e("h3",{className:"text-xl font-black text-gray-800",children:"ุญุงูุฉ ุงููุตุฑููุงุช"}),t("div",{className:"bg-blue-600 text-white px-4 py-1.5 rounded-full text-xs font-black",children:["ุงูุฑุณูู: ",a.monthlyFee," ุฌููู"]})]}),0===r.length?e("div",{className:"text-center py-20 bg-white/40 backdrop-blur-sm rounded-[2rem] border-2 border-dashed border-gray-200",children:e("p",{className:"text-gray-500 font-bold",children:"ูู ูุชู ุชุณุฌูู ุฃู ูุตุฑููุงุช ููุณุฏุงุฏ"})}):e("div",{className:"grid grid-cols-1 gap-4",children:r.map(a=>{const r=new Date(a.month+"-01").toLocaleDateString("ar-EG",{year:"numeric",month:"long"});return t("div",{className:"bg-white rounded-[1.5rem] p-6 shadow-sm border border-gray-100",children:[t("div",{className:"flex items-center justify-between mb-6",children:[t("div",{className:"flex items-center gap-3",children:[e("div",{className:"bg-indigo-50 p-2.5 rounded-xl",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),e("h4",{className:"text-lg font-black text-gray-800",children:r})]}),e("div",{className:"px-4 py-1.5 rounded-full text-xs font-black shadow-sm "+(a.paid?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:a.paid?"ุชู ุงูุณุฏุงุฏ โ":"ูู ูุณุฏุฏ โ"})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"bg-gray-50/50 p-4 rounded-2xl border border-gray-100",children:[e("p",{className:"text-gray-400 text-[10px] font-black uppercase mb-1",children:"ุงููุจูุบ ุงููุทููุจ"}),t("p",{className:"font-black text-gray-800",children:[a.amount," ุฌ.ู"]})]}),a.paid&&t("div",{className:"bg-green-50/30 p-4 rounded-2xl border border-green-100/50",children:[e("p",{className:"text-green-600/50 text-[10px] font-black uppercase mb-1",children:"ุชู ุฏูุน"}),t("p",{className:"font-black text-green-700",children:[a.amountPaid," ุฌ.ู"]})]})]}),a.paid&&t("div",{className:"mt-4 pt-4 border-t border-gray-50 flex flex-col gap-2",children:[a.paymentDate&&t("div",{className:"flex items-center gap-2 text-xs font-bold text-gray-400",children:[e("span",{children:"ุชุงุฑูุฎ ุงูุณุฏุงุฏ:"}),e("span",{className:"text-gray-600",children:c(a.paymentDate)})]}),a.receiptNumber&&t("div",{className:"flex items-center gap-2 text-xs font-bold text-gray-400",children:[e("span",{children:"ุฑูู ุงูุฅูุตุงู:"}),t("span",{className:"text-gray-600 tracking-wider",children:["#",a.receiptNumber]})]})]})]},a.month)})})]})})(),"attendance"===i&&(()=>{const r=[...a.attendance||[]].sort((e,t)=>t.date.localeCompare(e.date)),n=(a.attendance||[]).filter(e=>e.status===m.PRESENT).length,s=(a.attendance||[]).filter(e=>e.status===m.ABSENT).length;return t("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e("h3",{className:"text-xl font-black text-gray-800",children:"ุจูุงูุงุช ุงูุญุตุต"}),t("div",{className:"grid grid-cols-2 gap-6",children:[t("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100 rounded-[2rem] p-6 shadow-sm",children:[t("div",{className:"flex items-center gap-3 mb-4",children:[e("div",{className:"bg-white p-2 rounded-xl shadow-sm",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e("p",{className:"text-xs font-black text-green-700 uppercase",children:"ุญุถูุฑ"})]}),e("p",{className:"text-4xl font-black text-green-600",children:n})]}),t("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 border border-red-100 rounded-[2rem] p-6 shadow-sm",children:[t("div",{className:"flex items-center gap-3 mb-4",children:[e("div",{className:"bg-white p-2 rounded-xl shadow-sm",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})}),e("p",{className:"text-xs font-black text-red-700 uppercase",children:"ุบูุงุจ"})]}),e("p",{className:"text-4xl font-black text-red-600",children:s})]})]}),0===r.length?e("div",{className:"text-center py-20 bg-white/40 backdrop-blur-sm rounded-[2rem] border-2 border-dashed border-gray-200",children:e("p",{className:"text-gray-500 font-bold",children:"ูู ูุชู ุชุณุฌูู ุญุถูุฑ ุญุชู ุงูุขู"})}):e("div",{className:"space-y-3 max-h-[400px] overflow-y-auto px-1",children:r.map((a,r)=>t("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex items-center justify-between",children:[t("div",{className:"flex items-center gap-3",children:[e("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+(a.status===m.PRESENT?"bg-green-50 text-green-600":"bg-red-50 text-red-600"),children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:a.status===m.PRESENT?"M5 13l4 4L19 7":"M6 18L18 6M6 6l12 12"})})}),e("span",{className:"font-bold text-gray-700",children:c(a.date)})]}),e("span",{className:"text-[10px] uppercase font-black px-3 py-1 rounded-full "+(a.status===m.PRESENT?"text-green-600":"text-red-600"),children:a.status===m.PRESENT?"ุญุงุถุฑ":"ุบุงุฆุจ"})]},r))})]})})(),"progress"===i&&t("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e("h3",{className:"text-xl font-black text-gray-800",children:"ุฎุทุฉ ุงูุณูุฑ ูุงููููุฌ"}),a.progressPlan&&Object.values(a.progressPlan).some(e=>e)?t("div",{className:"grid grid-cols-1 gap-6",children:[a.progressPlan[p.NEW]&&t("div",{className:"bg-gradient-to-br from-teal-50 to-emerald-50/30 rounded-[2rem] p-8 border border-teal-100 shadow-sm",children:[t("div",{className:"flex items-center gap-3 mb-4",children:[e("div",{className:"bg-teal-500 text-white p-2 rounded-xl shadow-lg shadow-teal-500/20",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253"})})}),e("h4",{className:"text-lg font-black text-teal-900 tracking-tight",children:"ุงูุฌุฏูุฏ (ุงูููุฑุฑ ุงูุญูุธ)"})]}),e("p",{className:"text-teal-900/70 font-bold leading-relaxed pr-2 text-lg",children:a.progressPlan[p.NEW]})]}),(a.progressPlan[p.RECENT_PAST]||a.progressPlan[p.DISTANT_PAST])&&t("div",{className:"bg-white rounded-[2rem] p-8 border border-gray-100 shadow-sm space-y-8",children:[a.progressPlan[p.RECENT_PAST]&&t("div",{children:[t("div",{className:"flex items-center gap-2 mb-3",children:[e("span",{className:"w-2.5 h-2.5 bg-blue-500 rounded-full"}),e("h4",{className:"font-black text-blue-900",children:"ุงููุฑูุจ ุงููุงุถู"})]}),e("p",{className:"text-gray-600 font-bold leading-relaxed pr-4",children:a.progressPlan[p.RECENT_PAST]})]}),a.progressPlan[p.DISTANT_PAST]&&t("div",{className:"pt-6 border-t border-gray-50",children:[t("div",{className:"flex items-center gap-2 mb-3",children:[e("span",{className:"w-2.5 h-2.5 bg-purple-500 rounded-full"}),e("h4",{className:"font-black text-purple-900",children:"ุงูุจุนูุฏ ุงููุงุถู"})]}),e("p",{className:"text-gray-600 font-bold leading-relaxed pr-4",children:a.progressPlan[p.DISTANT_PAST]})]})]})]}):e("div",{className:"text-center py-20 bg-white/40 backdrop-blur-sm rounded-[2rem] border-2 border-dashed border-gray-200",children:e("p",{className:"text-gray-500 font-bold",children:"ูู ูุชู ุชุญุฏูุฏ ุฎุทุฉ ุณูุฑ ูููููุฌ ุจุนุฏ"})})]})]})}),e("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-gray-200 z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] safe-area-inset-bottom",children:e("div",{className:"max-w-4xl mx-auto px-2",children:e("div",{className:"flex w-full justify-around items-center py-2",children:[{id:"tests",label:"ุงูุงุฎุชุจุงุฑุงุช",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})},{id:"fees",label:"ุงููุตุฑููุงุช",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})},{id:"attendance",label:"ุงูุญุถูุฑ",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"progress",label:"ุงูุฎุทุฉ",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}].map(a=>t("button",{onClick:()=>o(a.id),className:"flex flex-col items-center justify-center gap-1 py-2 px-4 transition-all duration-300 relative group min-w-[70px] "+(i===a.id?"text-teal-600":"text-gray-400 hover:text-gray-600"),children:[e("div",{className:"p-2 rounded-2xl transition-all duration-300 "+(i===a.id?"bg-gradient-to-br from-teal-500 to-teal-600 text-white shadow-lg shadow-teal-500/40 scale-110":"bg-gray-50 group-hover:bg-gray-100 group-hover:scale-105"),children:a.icon}),e("span",{className:"text-[10px] font-black whitespace-nowrap transition-all duration-300 "+(i===a.id?"text-teal-600":"text-gray-500"),children:a.label}),i===a.id&&e("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 bg-teal-600 rounded-full shadow-[0_2px_8px_rgba(20,184,166,0.4)] animate-in slide-in-from-top-2 duration-300"})]},a.id))})})})]})},Xe=()=>{const{students:r,groups:n,teachers:s,supervisors:l,parents:i,notes:o,notifications:h,directorNotifications:m,staff:p,expenses:g,teacherAttendance:b,teacherPayrollAdjustments:x,teacherCollections:f,teacherManualBonuses:w,donations:y,financialSettings:v,permissionError:N}=(()=>{const[e,t]=C.useState([]),[a,r]=C.useState([]),[n,s]=C.useState([]),[l,i]=C.useState([]),[o,d]=C.useState([]),[c,u]=C.useState([]),[h,m]=C.useState([]),[p,g]=C.useState([]),[b,x]=C.useState([]),[f,w]=C.useState([]),[y,v]=C.useState([]),[N,k]=C.useState([]),[S,T]=C.useState([]),[I,A]=C.useState([]),[D,E]=C.useState([]),[P,M]=C.useState({workingDaysPerMonth:22,absenceDeductionPercentage:100}),[L,j]=C.useState(!1);return C.useEffect(()=>{const e=[{name:"students",setter:t},{name:"groups",setter:r},{name:"teachers",setter:s},{name:"supervisors",setter:i},{name:"parents",setter:d},{name:"notes",setter:u},{name:"staff",setter:x},{name:"expenses",setter:w},{name:"teacherAttendance",setter:v},{name:"teacherPayrollAdjustments",setter:k},{name:"teacherCollections",setter:T},{name:"teacherManualBonuses",setter:A},{name:"donations",setter:E}].map(({name:e,setter:t})=>$(W(be,e),e=>{const a=e.docs.map(e=>({...e.data(),id:e.id}));t(a)},e=>{"permission-denied"===e.code&&j(!0)})),a=_(be,"settings","financial"),n=$(a,e=>{e.exists()?M(e.data()):H(a,{workingDaysPerMonth:22,absenceDeductionPercentage:100}).catch(e=>{})},e=>{"permission-denied"===e.code&&j(!0)});return e.push(n),()=>e.forEach(e=>e())},[]),C.useEffect(()=>{const e=new Date;e.setDate(e.getDate()-30);const t=e.toISOString(),a=G(W(be,"notifications"),z("date",">=",t)),r=$(a,e=>{const t=e.docs.map(e=>({...e.data(),id:e.id})).sort((e,t)=>t.date.localeCompare(e.date));m(t)},e=>{});return()=>r()},[]),C.useEffect(()=>{const e=new Date;e.setDate(e.getDate()-60);const t=e.toISOString(),a=G(W(be,"directorNotifications"),z("date",">=",t)),r=$(a,e=>{const t=e.docs.map(e=>({...e.data(),id:e.id})).sort((e,t)=>t.date.localeCompare(e.date));g(t)},e=>{});return()=>r()},[]),{students:e,groups:a,teachers:n,supervisors:l,parents:o,notes:c,notifications:h,directorNotifications:p,staff:b,expenses:f,teacherAttendance:y,teacherPayrollAdjustments:N,teacherCollections:S,teacherManualBonuses:I,donations:D,financialSettings:P,permissionError:L}})(),S=(()=>{const[e,t]=C.useState(!1),[a,r]=C.useState(null),[n,s]=C.useState(null),[l,i]=C.useState(null),[o,d]=C.useState(!1),[c,u]=C.useState(null),[h,m]=C.useState(null),[p,g]=C.useState(null),[b,x]=C.useState(null),[f,w]=C.useState(!1),[y,v]=C.useState(!1),[N,k]=C.useState(null),[S,T]=C.useState(!1),[I,A]=C.useState(!1),[D,E]=C.useState(""),[P,M]=C.useState(null),[L,j]=C.useState("students"),[O,V]=C.useState(null),[F,R]=C.useState(null),[B,U]=C.useState(!1),[$,W]=C.useState(!1),[_,G]=C.useState(!1),[z,H]=C.useState(!1),[Y,q]=C.useState(!1),[X,K]=C.useState(!1),[J,Q]=C.useState(!1),[Z,ee]=C.useState(!1),[te,ae]=C.useState(!1),[re,ne]=C.useState(!1),[se,le]=C.useState(null),[ie,oe]=C.useState(!1),[de,ce]=C.useState(!1),[ue,he]=C.useState(void 0),[me,pe]=C.useState(null);return{isFormOpen:e,setIsFormOpen:t,studentToEdit:a,setStudentToEdit:r,teacherToEdit:n,setTeacherToEdit:s,supervisorToEdit:l,setSupervisorToEdit:i,isTeacherFormOpen:o,setIsTeacherFormOpen:d,teacherForDetails:c,setTeacherForDetails:u,supervisorForDetails:h,setSupervisorForDetails:m,studentToUnarchiveId:p,setStudentToUnarchiveId:g,studentToArchive:b,setStudentToArchive:x,isGroupManagerOpen:f,setIsGroupManagerOpen:w,isFeeModalOpen:y,setIsFeeModalOpen:v,paymentDetails:N,setPaymentDetails:k,detailsModalState:P,setDetailsModalState:M,isSidebarOpen:S,setIsSidebarOpen:T,isSearchVisible:I,setIsSearchVisible:A,searchTerm:D,setSearchTerm:E,activeView:L,setActiveView:j,viewingGroup:O,setViewingGroup:V,viewingGroupStudents:F,setViewingGroupStudents:R,isGeneralView:B,setIsGeneralView:U,isDirectorReportView:$,setIsDirectorReportView:W,isDirectorNotesView:_,setIsDirectorNotesView:G,isDirectorNotificationsView:z,setIsDirectorNotificationsView:H,isUnpaidStudentsView:Y,setIsUnpaidStudentsView:q,isFinanceView:X,setIsFinanceView:K,isFeeCollectionView:J,setIsFeeCollectionView:Q,isTeacherManagerView:Z,setIsTeacherManagerView:ee,isArchiveView:te,setIsArchiveView:ae,isDebtorsView:re,setIsDebtorsView:ne,viewingTeacherReportId:se,setViewingTeacherReportId:le,isTeacherFilterVisible:ie,setIsTeacherFilterVisible:oe,isChatOpen:de,setIsChatOpen:ce,chatInitialUserId:ue,setChatInitialUserId:he,selectedParentStudent:me,setSelectedParentStudent:pe}})(),{currentUser:I,setCurrentUser:A,handleLogin:D,handleLogout:E,handleParentLogin:P}=xe(),M=(({students:e,groups:t,teachers:a,parents:r,currentUser:n,notes:s})=>({addOrUpdateStudent:C.useCallback(async(t,a)=>{const s=t.name.trim().toLowerCase();if(e.some(e=>e.id!==a&&e.name.trim().toLowerCase()===s))alert(`ุงูุทุงูุจ "${t.name}" ูุณุฌู ุจุงููุนู. ูุฑุฌู ุงุณุชุฎุฏุงู ุงุณู ุขุฎุฑ.`);else{try{if(a)await Y(_(be,"students",a),t);else{const e="teacher"===n?.role,a=()=>{const{DayOfWeek:e}=require("../types");return[{day:e.SUNDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"},{day:e.MONDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"},{day:e.TUESDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"},{day:e.WEDNESDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"},{day:e.THURSDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"},{day:e.FRIDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"},{day:e.SATURDAY,isEnabled:!1,startTime:"09:00",endTime:"11:00"}]},s={...t,attendance:[],fees:[],tests:[],schedule:a(),progressPlan:{},progressPlanHistory:[],isPending:e};let l;e&&n?.id?l=n.id:"director"===n?.role&&(l="director");const i={...s};l&&(i.addedBy=l);const o=e=>{if(null==e)return null;if(Array.isArray(e))return e;if("object"!=typeof e)return e;const t={};return Object.keys(e).forEach(a=>{const r=e[a];void 0!==r&&(t[a]="object"!=typeof r||Array.isArray(r)?r:o(r))}),t},d=o(i),c=await X(W(be,"students"),d);t.phone&&await fe(t.phone,t.name,c.id,r),e?alert("ุชู ุฅุถุงูุฉ ุงูุทุงูุจ ุจูุฌุงุญ! ุณูุชู ูุฑุงุฌุนุชู ูู ูุจู ุงููุดุฑู ุฃู ุงููุฏูุฑ."):alert("ุชู ุฅุถุงูุฉ ุงูุทุงูุจ ุจูุฌุงุญ!")}}catch(l){const e="permission-denied"===l?.code?"ููุณ ูุฏูู ุตูุงุญูุฉ ูุญูุธ ุจูุงูุงุช ุงูุทุงูุจ. ูุฑุฌู ุงูุชูุงุตู ูุน ุงููุฏูุฑ.":l?.message?`ุญุฏุซ ุฎุทุฃ: ${l.message}`:"ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุจูุงูุงุช ุงูุทุงูุจ.";alert(e)}a&&t.phone&&await fe(t.phone,t.name,a,r)}},[e,n,r]),handleEditStudent:C.useCallback(e=>({studentToEdit:e,isFormOpen:!0}),[]),handleApproveStudent:C.useCallback(async e=>{if(!n||"director"!==n.role&&"supervisor"!==n.role)alert("ููุณ ูุฏูู ุตูุงุญูุฉ ููููุงููุฉ ุนูู ุงูุทูุงุจ.");else try{await Y(_(be,"students",e),{isPending:!1,approvedBy:"director"===n.role?"director":n.id,approvalDate:(new Date).toISOString().split("T")[0]})}catch(t){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุจูู ุงูุทุงูุจ.")}},[n]),handleRejectStudent:C.useCallback(async t=>{if(!n||"director"!==n.role&&"supervisor"!==n.role)return void alert("ููุณ ูุฏูู ุตูุงุญูุฉ ูุฑูุถ ุงูุทูุงุจ.");const r=e.find(e=>e.id===t);if(!r)return;const s=prompt(`ูุฑุฌู ุฅุฏุฎุงู ุณุจุจ ุฑูุถ ุงูุทุงูุจ "${r.name}":`);if(null!==s&&""!==s.trim()&&window.confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุฑูุถ ุงูุทุงูุจ "${r.name}"ุ ุณูุชู ุญุฐูู ููุงุฆูุงู.`))try{if(r.addedBy&&a.find(e=>e.id===r.addedBy)){const e="director"===n.role?"ุงููุฏูุฑ":`ุงููุดุฑู ${n.name}`;await X(W(be,"notifications"),{date:(new Date).toISOString(),content:`ุชู ุฑูุถ ุงูุทุงูุจ "${r.name}" ูู ูุจู ${e}.\nุณุจุจ ุงูุฑูุถ: ${s.trim()}`,senderName:e,target:{type:"teacher",id:r.addedBy},readBy:[]})}await K(_(be,"students",t)),alert("ุชู ุฑูุถ ุงูุทุงูุจ ูุญุฐููุ ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุฏุฑุณ.")}catch(l){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฑูุถ ุงูุทุงูุจ.")}},[e,a,n]),handleAddTest:C.useCallback(async(e,t)=>{try{await Y(_(be,"students",e),{tests:q({id:crypto.randomUUID(),date:(new Date).toISOString().split("T")[0],...t})})}catch(a){}},[]),handleDeleteTest:C.useCallback(async(e,t)=>{try{const a=await J(_(be,"students",e));if(!a.exists())return;const r=a.data().tests.filter(e=>e.id!==t);await Y(_(be,"students",e),{tests:r})}catch(a){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุงุฎุชุจุงุฑ.")}},[]),handleAddNote:C.useCallback(async(e,t)=>{if(n)try{await X(W(be,"notes"),{studentId:e,content:t,authorId:"director"===n.role?"director":n.id,authorName:"director"===n.role?"ุงููุฏูุฑ":"supervisor"===n.role?`ุงููุดุฑู ${n.name}`:n.name,date:(new Date).toISOString(),isAcknowledged:!1})}catch(a){}},[n]),handleToggleNoteAcknowledge:C.useCallback(async e=>{const t=s.find(t=>t.id===e);if(t)try{await Y(_(be,"notes",e),{isAcknowledged:!t.isAcknowledged})}catch(a){}},[s]),handleToggleAttendance:C.useCallback(async(e,t,a)=>{try{const r=await J(_(be,"students",e));if(!r.exists())return;const n=[...r.data().attendance],s=n.findIndex(e=>e.date===t);s>-1?n[s].status=a:n.push({date:t,status:a}),await Y(_(be,"students",e),{attendance:n})}catch(r){}},[]),handleSaveStudentProgressPlan:C.useCallback(async(e,t,a)=>{try{const r=_(be,"students",e);if(!t.new&&!t.recent_past&&!t.distant_past)return void(await Y(r,{progressPlan:t}));const n={date:(new Date).toISOString(),plan:t,isCompleted:!1,authorName:a};await Y(r,{progressPlan:t,progressPlanHistory:q({id:crypto.randomUUID(),...n})})}catch(r){}},[]),handleTogglePlanCompletion:C.useCallback(async(e,t)=>{try{const a=_(be,"students",e),r=await J(a);if(!r.exists())return;const n=(r.data().progressPlanHistory||[]).map(e=>e.id===t?{...e,isCompleted:!e.isCompleted}:e);await Y(a,{progressPlanHistory:n})}catch(a){}},[]),handleDeletePlanRecord:C.useCallback(async(e,t)=>{if(window.confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ูุฐู ุงูุฎุทุฉ ูู ุงูุณุฌูุ"))try{const a=_(be,"students",e),r=await J(a);if(!r.exists())return;const n=(r.data().progressPlanHistory||[]).filter(e=>e.id!==t);await Y(a,{progressPlanHistory:n})}catch(a){}},[]),handleUpdatePlanRecord:C.useCallback(async(e,t,a)=>{try{const r=_(be,"students",e),n=await J(r);if(!n.exists())return;const s=(n.data().progressPlanHistory||[]).map(e=>e.id===t.id?{...t,modifiedBy:a,modifiedDate:(new Date).toISOString()}:e);await Y(r,{progressPlanHistory:s})}catch(r){}},[]),handleMarkWeeklyReportSent:C.useCallback(async e=>{try{const t=_(be,"students",e);await Y(t,{lastWeeklyReportDate:(new Date).toISOString()})}catch(t){}},[]),handleArchiveStudent:C.useCallback((t,a)=>{const r=e.find(e=>e.id===t);if(r)return r.isArchived?r.hasDebt?void alert("ูุง ูููู ุงุณุชุนุงุฏุฉ ูุฐุง ุงูุทุงูุจ ููุฌูุฏ ูุตุฑููุงุช ูุณุชุญูุฉ ุนููู. ูุฑุฌู ุณุฏุงุฏ ุงูุฏููู ุฃููุงู ูู ุตูุญุฉ ุงููุฏูููู."):{studentToUnarchiveId:t}:{studentToArchive:r}},[e]),handleDeleteStudentPermanently:C.useCallback(async t=>{const a=e.find(e=>e.id===t);if(a&&window.confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ุงูุทุงูุจ "${a.name}" ุจุดูู ููุงุฆูุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.`))try{await K(_(be,"students",t));const e=G(W(be,"notes"),z("studentId","==",t)),a=await Q(e),r=Z(be);a.forEach(e=>r.delete(e.ref)),await r.commit()}catch(r){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุทุงูุจ.")}},[e])}))({students:r,groups:n,teachers:s,parents:i,currentUser:I,notes:o}),L=(({currentUser:e,teachers:t,groups:a,students:r})=>({handleOpenFeeModal:C.useCallback((e,t,a)=>({studentId:e,month:t,amount:a}),[]),handleSaveFeePayment:C.useCallback(async t=>{try{const a=await J(_(be,"students",t.studentId));if(!a.exists())return;const r=a.data(),n=[...r.fees],s=n.findIndex(e=>e.month===t.month),l="director"===e?.role?"director":e?.id,i="director"===e?.role?"ุงููุฏูุฑ":e?.name,o={paid:!0,paymentDate:(new Date).toISOString(),amountPaid:t.amountPaid,receiptNumber:t.receiptNumber,collectedBy:l,collectedByName:i};s>-1?n[s]={...n[s],...o}:n.push({month:t.month,amount:r.monthlyFee,...o}),await Y(_(be,"students",t.studentId),{fees:n})}catch(a){}},[e]),handleCancelFeePayment:C.useCallback(async(e,t)=>{if(window.confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุฅูุบุงุก ุฏูุน ุดูุฑ ${t}ุ\nุณูุชู ูุถุน ุนูุงูุฉ ุนูู ูุฐุง ุงูุดูุฑ ูุบูุฑ ูุฏููุน.`))try{const a=_(be,"students",e),r=await J(a);if(!r.exists())return;const n=r.data().fees.map(e=>{if(e.month===t){const{paymentDate:t,amountPaid:a,receiptNumber:r,...n}=e;return{...n,paid:!1}}return e});await Y(a,{fees:n})}catch(a){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุบุงุก ุงูุฏูุนุฉ.")}},[]),handlePayDebt:C.useCallback(async(t,a,r)=>{try{const n=_(be,"students",t),s=await J(n);if(!s.exists())return;const l=s.data(),i=[...l.fees],o=i.findIndex(e=>e.month===a),d={paid:!0,paymentDate:(new Date).toISOString(),amountPaid:r,receiptNumber:"DEBT_PAYMENT",collectedBy:"director"===e?.role?"director":e?.id,collectedByName:"director"===e?.role?"ุงููุฏูุฑ":e?.name};o>-1?i[o]={...i[o],...d}:i.push({month:a,amount:l.monthlyFee,...d});const c=l.debtMonths?.filter(e=>e!==a)||[],u={fees:i,debtMonths:c,hasDebt:c.length>0};await Y(n,u)}catch(n){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฏูุน ุงูุฏูู.")}},[e]),handleAddStaff:C.useCallback(async e=>{await X(W(be,"staff"),e)},[]),handleUpdateStaff:C.useCallback(async(e,t)=>{await Y(_(be,"staff",e),t)},[]),handleDeleteStaff:C.useCallback(async e=>{await K(_(be,"staff",e))},[]),handleLogExpense:C.useCallback(async e=>{await X(W(be,"expenses"),e)},[]),handleDeleteExpense:C.useCallback(async e=>{try{await K(_(be,"expenses",e))}catch(t){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงููุตุฑูู.")}},[]),handleAddDonation:C.useCallback(async e=>{try{await X(W(be,"donations"),e)}catch(t){alert(`ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุชุจุฑุน: ${t instanceof Error?t.message:"Unknown error"}`)}},[]),handleDeleteDonation:C.useCallback(async e=>{if(window.confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุชุจุฑุนุ"))try{await K(_(be,"donations",e))}catch(t){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุชุจุฑุน.")}},[]),handleDeleteTeacherAttendance:C.useCallback(async e=>{if(window.confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุณุฌูุ"))try{await Y(_(be,"teacherAttendance",e),{status:d.EXCUSED,reason:"ุชู ุงูุฅุนูุงุก ูู ูุจู ุงููุฏูุฑ"})}catch(t){}},[]),handleSetTeacherAttendance:C.useCallback(async(e,a,r,n)=>{try{const s=G(W(be,"teacherAttendance"),z("teacherId","==",e),z("date","==",a)),l=(await Q(s)).docs[0];if(r===d.PRESENT)l&&await K(l.ref);else{const s={teacherId:e,date:a,status:r};if(n&&(s.reason=n),l?await Y(l.ref,s):await X(W(be,"teacherAttendance"),s),[d.BONUS_DAY,d.BONUS_HALF_DAY,d.BONUS_QUARTER_DAY].includes(r)){const a=t.find(t=>t.id===e);if(a){let e="";r===d.BONUS_DAY?e="ููู ุฅุถุงูู ูุงูู":r===d.BONUS_HALF_DAY?e="ูุตู ููู ุฅุถุงูู":r===d.BONUS_QUARTER_DAY&&(e="ุฑุจุน ููู ุฅุถุงูู");const s=`ุชู ููุญ ุงููุฏุฑุณ ${a.name} ููุงูุฃุฉ: ${e}${n?`\nุงูุณุจุจ: ${n}`:""}`,l=t.filter(e=>e.status===c.ACTIVE),i=Z(be);l.forEach(e=>{const t=_(W(be,"notifications"));i.set(t,{id:t.id,date:(new Date).toISOString(),content:s,senderName:"ุงูุฅุฏุงุฑุฉ",target:{type:"teacher",id:e.id},readBy:[],deletedBy:[]})}),await i.commit()}}}}catch(s){}},[t]),handleUpdatePayrollAdjustments:C.useCallback(async e=>{const t=G(W(be,"teacherPayrollAdjustments"),z("teacherId","==",e.teacherId),z("month","==",e.month)),a=await Q(t);a.empty?await X(W(be,"teacherPayrollAdjustments"),{bonus:0,isPaid:!1,...e}):await Y(a.docs[0].ref,e)},[]),handleAddTeacherCollection:C.useCallback(async e=>{try{await X(W(be,"teacherCollections"),e)}catch(t){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุชุญุตูู.")}},[]),handleDeleteTeacherCollection:C.useCallback(async e=>{if(window.confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ุณุฌู ุงูุชุณููู ูุฐุงุ"))try{await K(_(be,"teacherCollections",e))}catch(t){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุณุฌู.")}},[]),handleAddManualBonus:C.useCallback(async e=>{try{await X(W(be,"teacherManualBonuses"),e);const a=t.find(t=>t.id===e.teacherId),r=`๐ ุฎุจุฑ ุณุงุฑ: ุญุตู ุงููุฏุฑุณ/ุฉ ${a?.name||"..."} ุนูู ููุงูุฃุฉ ุชุดุฌูุนูุฉ ุชูุฏูุฑุงู ูุฌููุฏู ุงููุชููุฒุฉ. ุจุงุฑู ุงููู ูู ุนูููู ุฌููุนุงู.`;await X(W(be,"notifications"),{date:(new Date).toISOString(),content:r,senderName:"ุงููุฏูุฑ",recipientId:"all",readBy:[]}),await X(W(be,"directorNotifications"),{date:(new Date).toISOString(),forDate:e.date,content:`โ ุชู ุฅุถุงูุฉ ููุงูุฃุฉ ูุฏููุฉ ูููุฏุฑุณ ${a?.name} ุจูุจูุบ ${e.amount} ุฌููู.`,isRead:!1,type:"teacher_manual_bonus",teacherId:e.teacherId,teacherName:a?.name||""})}catch(a){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูููุงูุฃุฉ.")}},[t]),handleDeleteManualBonus:C.useCallback(async e=>{try{await K(_(be,"teacherManualBonuses",e))}catch(t){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูููุงูุฃุฉ.")}},[]),handleUpdateFinancialSettings:C.useCallback(async e=>{await H(_(be,"settings","financial"),e)},[]),handleAddHoliday:C.useCallback(async(e,t,a,r)=>{if(!e)return;const n=t.publicHolidays||[];if(!n.includes(e))try{const s=Z(be),l={...t,publicHolidays:[...n,e]};s.set(_(be,"settings","financial"),l);const i=a.filter(t=>t.date===e);i.forEach(e=>{s.delete(_(be,"teacherAttendance",e.id))});const o=r.filter(t=>t.forDate===e);o.forEach(e=>{s.delete(_(be,"directorNotifications",e.id))}),await s.commit(),alert(`ุชู ุฅุถุงูุฉ ุงูุฅุฌุงุฒุฉ ุจูุฌุงุญุ ูุชู ุญุฐู ${i.length} ุฎุตู ู ${o.length} ุฅุดุนุงุฑ ูุชุนูููู ุจูุฐุง ุงูููู.`)}catch(s){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุฅุฌุงุฒุฉ")}},[]),handleResetTeacherPayment:C.useCallback(async(e,t,a)=>{if(window.confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุฅูุบุงุก ุฏูุน ุฑุงุชุจ ุงููุฏุฑุณ "${a}" ูุดูุฑ ${t}ุ ุณูุชู ุญุฐู ุงููุตุฑูู ูู ุงูุณุฌู ุงููุงูู.`)){const n=Z(be);try{const r=G(W(be,"expenses"),z("category","in",[u.TEACHER_SALARY,u.SUPERVISOR_SALARY])),s=(await Q(r)).docs.find(e=>{const r=e.data();return r.description.includes(a)&&r.description.includes(t)});s&&n.delete(s.ref);const l=G(W(be,"teacherPayrollAdjustments"),z("teacherId","==",e),z("month","==",t)),i=await Q(l);i.empty||n.update(i.docs[0].ref,{isPaid:!1}),await n.commit(),alert("ุชู ุฅูุบุงุก ุงูุฏูุน ุจูุฌุงุญ.")}catch(r){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุบุงุก ุฏูุน ุงูุฑุงุชุจ.")}}},[]),handleResetStaffPayment:C.useCallback(async(e,t,a)=>{if(window.confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุฅูุบุงุก ุฏูุน ุฑุงุชุจ ุงูููุธู "${a}" ูุดูุฑ ${t}ุ ุณูุชู ุญุฐู ุงููุตุฑูู ูู ุงูุณุฌู ุงููุงูู.`))try{const r=G(W(be,"expenses"),z("category","==",u.STAFF_SALARY),z("description","==",`ุฑุงุชุจ ุงูููุธู: ${a} (${e}) - ุดูุฑ ${t}`)),n=await Q(r);n.empty||await K(n.docs[0].ref)}catch(r){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุบุงุก ุฏูุน ุงูุฑุงุชุจ.")}},[])}))({currentUser:I,teachers:s,groups:n,students:r}),F=(({currentUser:e,teachers:t,groups:a,students:r})=>({handleAddGroup:C.useCallback(async(e,t)=>{await X(W(be,"groups"),{name:e,teacherId:t||""})},[]),handleUpdateGroup:C.useCallback(async(e,t,a)=>{await Y(_(be,"groups",e),{name:t,teacherId:a||""})},[]),handleDeleteGroup:C.useCallback(async e=>{if(window.confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ูุฐู ุงููุฌููุนุฉุ")){if(r.some(t=>t.groupId===e))try{const t=G(W(be,"students"),z("groupId","==",e)),a=await Q(t),r=Z(be);a.forEach(e=>r.update(e.ref,{groupId:""})),await r.commit()}catch(t){return}await K(_(be,"groups",e))}},[r]),handleSaveTeacher:C.useCallback(async(e,a)=>{if(a||!t.some(t=>t.name.trim()===e.name.trim()))try{const t={...e};if("partnership"===e.paymentType?t.salary=ee():t.partnershipPercentage=ee(),a)await Y(_(be,"teachers",a),t);else{const t={...e};"partnership"===e.paymentType?delete t.salary:delete t.partnershipPercentage,await X(W(be,"teachers"),t)}}catch(r){}else alert("ูุฐุง ุงููุฏุฑุณ ูุณุฌู ุจุงููุนู.")},[t]),handleDeleteTeacher:C.useCallback(async e=>{a.some(t=>t.teacherId===e)?alert("ูุง ูููู ุญุฐู ุงููุฏุฑุณ ูุฃูู ูุณุคูู ุนู ูุฌููุนุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู."):window.confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ุญุฐู ูุฐุง ุงููุฏุฑุณุ")&&await K(_(be,"teachers",e))},[a]),handleSaveSupervisor:C.useCallback(async(e,t)=>{try{t?await Y(_(be,"supervisors",t),e):await X(W(be,"supervisors"),e)}catch(a){}},[]),handleDeleteSupervisor:C.useCallback(async e=>{try{await K(_(be,"supervisors",e))}catch(t){}},[])}))({currentUser:I,teachers:s,groups:n,students:r}),R=(({currentUser:e,teachers:t,groups:a})=>({handleSendNotification:C.useCallback(async(e,t)=>{await X(W(be,"notifications"),{date:(new Date).toISOString(),content:t,senderName:"ุงููุฏูุฑ",target:e,readBy:[]})},[]),handleSendNotificationToTeacher:C.useCallback(async(t,a)=>{const r="director"===e?.role?"ุงููุฏูุฑ":"supervisor"===e?.role?"ุงููุดุฑู":"ุงูุฅุฏุงุฑุฉ";await X(W(be,"notifications"),{date:(new Date).toISOString(),content:a,senderName:r,target:{type:"teacher",id:t},readBy:[]})},[e]),handleSendNotificationToAll:C.useCallback(async r=>{const n=Z(be),s="director"===e?.role?"ุงููุฏูุฑ":"supervisor"===e?.role?"ุงููุดุฑู":"ุงูุฅุฏุงุฑุฉ";let l=t.filter(e=>e.status===c.ACTIVE),i=a;if("supervisor"===e?.role){const t=e.section,r=a.filter(e=>{const a=we(e.name);return a&&t.includes(a)});i=r;const n=r.map(e=>e.teacherId).filter(e=>e);l=l.filter(e=>n.includes(e.id))}l.forEach(e=>{const t=_(W(be,"notifications"));n.set(t,{date:(new Date).toISOString(),content:r,senderName:s,target:{type:"teacher",id:e.id},readBy:[]})}),i.forEach(e=>{const t=_(W(be,"notifications"));n.set(t,{date:(new Date).toISOString(),content:r,senderName:s,target:{type:"group",id:e.id,name:e.name},readBy:[]})});try{await n.commit(),alert("ุชู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ููุฌููุน ุจูุฌุงุญ!")}catch(o){alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู ุงูุฅุดุนุงุฑ.")}},[t,a,e]),handleMarkNotificationsAsRead:C.useCallback(async(e,t)=>{const a=Z(be);e.forEach(e=>{a.update(_(be,"notifications",e),{readBy:q(t)})}),await a.commit()},[]),handleDeleteTeacherNotifications:C.useCallback(async(e,t)=>{const a=Z(be);e.forEach(e=>{a.update(_(be,"notifications",e),{deletedBy:q(t)})}),await a.commit()},[]),handleMarkDirectorNotificationsAsRead:C.useCallback(async e=>{const t=Z(be);e.forEach(e=>{t.update(_(be,"directorNotifications",e),{isRead:!0})}),await t.commit()},[]),handleDeleteDirectorNotifications:C.useCallback(async e=>{const t=Z(be);e.forEach(e=>{t.update(_(be,"directorNotifications",e),{isDeleted:!0})}),await t.commit()},[])}))({currentUser:I,teachers:s,groups:n}),B=(()=>{const[e,t]=C.useState(navigator.onLine);return C.useEffect(()=>{const e=()=>t(!0),a=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}},[]),e})(),U=C.useMemo(()=>s.filter(e=>e.status===c.ACTIVE),[s]),te=C.useMemo(()=>{if("supervisor"!==I?.role)return null;const e=I.section,t=n.filter(t=>{const a=(e=>{if(!e)return null;const t=e.toLowerCase();return t.includes("ูุฑุขู")?"ูุฑุขู":t.includes("ููุฑ ุจูุงู")?"ููุฑ ุจูุงู":t.includes("ุชูููู")||t.includes("ุชูููู")?"ุชูููู":t.includes("ุฅูุฑุงุก")||t.includes("ุงูุฑุงุก")?"ุฅูุฑุงุก":null})(t.name);return a&&e.includes(a)}),a=t.map(e=>e.id),l=r.filter(e=>!e.isArchived&&!e.isPending&&a.includes(e.groupId)),i=t.map(e=>e.teacherId).filter(e=>e),o=s.filter(e=>i.includes(e.id));return{groups:t,students:l,teachers:o,expenses:g.filter(e=>o.some(t=>e.description.includes(t.name))),collections:f.filter(e=>i.includes(e.teacherId)),teacherAttendance:b.filter(e=>i.includes(e.teacherId)),teacherPayrollAdjustments:x.filter(e=>i.includes(e.teacherId))}},[I,n,r,s,g,f,b,x]),ae=C.useMemo(()=>"director"===I?.role?n:"supervisor"===I?.role?te?.groups||[]:n.filter(e=>e.teacherId===I?.id),[n,I,te]),[re,le]=T.useState("staff"),ie=C.useMemo(()=>r.filter(e=>!e.isArchived&&!e.isPending),[r]),de=C.useMemo(()=>{if("teacher"!==I?.role)return[];const e=n.filter(e=>e.teacherId===I.id).map(e=>e.id);return ie.filter(t=>e.includes(t.groupId))},[I,n,ie]),ce=C.useCallback(()=>{S.setIsFormOpen(!1),S.setStudentToEdit(null),S.setTeacherToEdit(null),S.setSupervisorToEdit(null),S.setIsTeacherFormOpen(!1),S.setTeacherForDetails(null),S.setSupervisorForDetails(null),S.setStudentToUnarchiveId(null),S.setStudentToArchive(null),S.setIsGroupManagerOpen(!1),S.setIsFeeModalOpen(!1),S.setPaymentDetails(null),S.setIsSidebarOpen(!1),S.setIsSearchVisible(!1),S.setSearchTerm(""),S.setDetailsModalState(null),S.setActiveView("students"),S.setViewingGroup(null),S.setViewingGroupStudents(null),S.setIsGeneralView(!1),S.setIsDirectorReportView(!1),S.setIsDirectorNotesView(!1),S.setIsDirectorNotificationsView(!1),S.setIsUnpaidStudentsView(!1),S.setIsFinanceView(!1),S.setIsFeeCollectionView(!1),S.setIsTeacherManagerView(!1),S.setIsArchiveView(!1),S.setIsDebtorsView(!1),S.setViewingTeacherReportId(null),S.setIsTeacherFilterVisible(!1)},[S]),he=C.useCallback(()=>{const{studentToArchive:e,studentToUnarchiveId:t,isFeeModalOpen:a,isTeacherFormOpen:r,isGroupManagerOpen:n,detailsModalState:s,teacherForDetails:l,supervisorForDetails:i,isFormOpen:o,isSidebarOpen:d,isSearchVisible:c,viewingTeacherReportId:u,viewingGroup:h,viewingGroupStudents:m}=S;return e?(S.setStudentToArchive(null),!0):t?(S.setStudentToUnarchiveId(null),!0):a?(S.setIsFeeModalOpen(!1),S.setPaymentDetails(null),!0):r?(S.setIsTeacherFormOpen(!1),S.setTeacherToEdit(null),S.setSupervisorToEdit(null),!0):n?(S.setIsGroupManagerOpen(!1),!0):s?(S.setDetailsModalState(null),!0):l||i?(S.setTeacherForDetails(null),S.setSupervisorForDetails(null),!0):o?(S.setIsFormOpen(!1),S.setStudentToEdit(null),!0):d?(S.setIsSidebarOpen(!1),!0):c?(S.setIsSearchVisible(!1),S.setSearchTerm(""),!0):u?(S.setViewingTeacherReportId(null),!0):h?(S.setViewingGroup(null),!0):m?(S.setViewingGroupStudents(null),!0):!!(S.isTeacherManagerView||S.isFinanceView||S.isGeneralView||S.isDirectorReportView||S.isDirectorNotesView||S.isFeeCollectionView||S.isDirectorNotificationsView||S.isUnpaidStudentsView||S.isArchiveView||S.isDebtorsView)&&(ce(),!0)},[S,ce]);if(C.useEffect(()=>{const e=e=>{"Escape"===e.key&&he()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[he]),C.useEffect(()=>{const e=()=>he();return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[he]),N)return e("div",{className:"fixed inset-0 bg-red-100 z-50 flex justify-center items-center p-4 text-right",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full",children:[e("h2",{className:"text-2xl font-bold mb-4 text-red-700",children:"ุฎุทุฃ: ุงููุตูู ูุฑููุถ"}),e("p",{className:"text-gray-700 mb-4",children:"ูุจุฏู ุฃู ุงูุตูุงุญูุงุช ุบูุฑ ุตุญูุญุฉ. ูุฑุฌู ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช Firebase."}),e("button",{onClick:()=>window.location.reload(),className:"px-8 py-3 rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors font-bold",children:"ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ"})]})});if(!I)return t("div",{className:"min-h-screen bg-[#0f172a] flex items-center justify-center p-4 relative overflow-hidden",dir:"rtl",children:[e("div",{className:"absolute top-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-600/20 blur-[120px] rounded-full"}),e("div",{className:"absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-600/20 blur-[120px] rounded-full"}),e("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[60%] h-[60%] bg-teal-500/10 blur-[150px] rounded-full"}),t("div",{className:"w-full max-w-[480px] z-10",children:[t("div",{className:"text-center mb-10 animate-in fade-in slide-in-from-top-6 duration-700",children:[e("h1",{className:"text-5xl font-black text-white mb-3 tracking-tight",children:"ูุฑูุฒ ุงูุดุงุทุจู"}),e("p",{className:"text-blue-200/60 text-lg",children:"ูุธุงู ุงูุฅุฏุงุฑุฉ ุงูุชุนููููุฉ ุงููุชูุงูู"})]}),t("div",{className:"bg-white/95 backdrop-blur-xl rounded-[2.5rem] shadow-2xl p-2 sm:p-3 shadow-black/20 overflow-hidden animate-in zoom-in-95 duration-500",children:[t("div",{className:"flex p-1.5 bg-gray-100/80 rounded-[2rem] mb-2",children:[e("button",{onClick:()=>le("staff"),className:"flex-1 py-4 px-6 rounded-[1.7rem] font-bold text-base transition-all duration-300 flex items-center justify-center gap-2 "+("staff"===re?"bg-white text-blue-600 shadow-sm ring-1 ring-black/5":"text-gray-500 hover:text-gray-700"),children:"ุงูููุธููู"}),e("button",{onClick:()=>le("parent"),className:"flex-1 py-4 px-6 rounded-[1.7rem] font-bold text-base transition-all duration-300 flex items-center justify-center gap-2 "+("parent"===re?"bg-white text-teal-600 shadow-sm ring-1 ring-black/5":"text-gray-500 hover:text-gray-700"),children:"ุฃูููุงุก ุงูุฃููุฑ"})]}),e("div",{className:"p-6 sm:p-10 pt-4",children:"staff"===re?e(ke,{onLogin:D,teachers:s,supervisors:l}):e(He,{onLogin:(e,t)=>{P(e,t,i)?D({role:"parent",id:i.find(a=>a.phone===e&&a.password===t)?.id||"",name:i.find(a=>a.phone===e&&a.password===t)?.name||"",phone:e,studentIds:i.find(a=>a.phone===e&&a.password===t)?.studentIds||[]}):alert("ุฑูู ุงููุงุชู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ")},parents:i})})]})]})]});return t("div",{className:"min-h-screen bg-gray-50 font-sans",children:[!B&&t("div",{className:"bg-red-500 text-white text-center p-2 font-semibold flex items-center justify-center gap-2",children:[e(ye,{className:"w-5 h-5"}),e("span",{children:"ุฃูุช ุบูุฑ ูุชุตู ุจุงูุฅูุชุฑูุช"})]}),t("div",{className:"flex",children:[("director"===I.role||"supervisor"===I.role)&&e(ue,{isOpen:S.isSidebarOpen,onClose:()=>S.setIsSidebarOpen(!1),onShowGeneralView:()=>{S.setIsGeneralView(!0)},onShowFinance:()=>{S.setIsFinanceView(!0)},onShowFeeCollection:()=>{S.setIsFeeCollectionView(!0)},onShowNotifications:()=>{S.setIsDirectorNotificationsView(!0)},onShowNotes:()=>{S.setIsDirectorNotesView(!0)},onShowTeacherManager:()=>{S.setIsTeacherManagerView(!0)},onShowArchive:()=>{S.setIsArchiveView(!0)},onShowDebtors:()=>{S.setIsDebtorsView(!0)},onLogout:E,currentUserRole:I.role}),t("div",{className:"flex-1 flex flex-col w-full min-w-0",children:[e(oe,{leftContent:null,centerContent:e("h1",{className:"text-xl font-bold",children:I.role}),rightContent:null}),e("main",{className:"flex-1 overflow-y-auto pb-20",children:e(pe,{children:(()=>{if("parent"===I.role){if(S.selectedParentStudent){const t=n.find(e=>e.id===S.selectedParentStudent?.groupId),a=s.find(e=>e.id===t?.teacherId);return e(qe,{student:S.selectedParentStudent,group:t,teacher:a,onClose:()=>S.setSelectedParentStudent(null),onOpenChat:()=>{S.setChatInitialUserId(a?.id),S.setSelectedParentStudent(null),S.setIsChatOpen(!0)}})}return e(Ye,{students:r.filter(e=>I.studentIds.includes(e.id)),groups:n,onViewStudent:S.setSelectedParentStudent,parentPhone:I.phone})}const t="director"===I.role?ie:"supervisor"===I.role?te?.students||[]:de,a=ae;if(S.detailsModalState)return e(O,{student:S.detailsModalState.student,initialTab:S.detailsModalState.initialTab,currentUser:I,notes:o.filter(e=>e.studentId===S.detailsModalState?.student.id),onOpenFeeModal:(e,t,a)=>{S.setPaymentDetails({studentId:e,month:t,amount:a}),S.setIsFeeModalOpen(!0)},onAddTest:M.handleAddTest,onDeleteTest:M.handleDeleteTest,onAddNote:M.handleAddNote,onSaveProgressPlan:M.handleSaveStudentProgressPlan,onUpdatePlanRecord:M.handleUpdatePlanRecord,onTogglePlanCompletion:M.handleTogglePlanCompletion,onDeletePlanRecord:M.handleDeletePlanRecord,onCancelFeePayment:L.handleCancelFeePayment,onBack:he});if(S.viewingGroup)return e(Fe,{group:S.viewingGroup,students:t.filter(e=>e.groupId===S.viewingGroup?.id),teacher:s.find(e=>e.id===S.viewingGroup?.teacherId),onBack:()=>he(),currentUserRole:I.role});if(S.viewingGroupStudents)return e(Re,{group:S.viewingGroupStudents,students:t.filter(e=>e.groupId===S.viewingGroupStudents?.id),teachers:s,onOpenFeeModal:(e,t,a)=>{S.setPaymentDetails({studentId:e,month:t,amount:a}),S.setIsFeeModalOpen(!0)},onAddTest:M.handleAddTest,onDeleteTest:M.handleDeleteTest,onAddNote:M.handleAddNote,onEdit:e=>{S.setStudentToEdit(e),S.setIsFormOpen(!0)},onToggleAttendance:M.handleToggleAttendance,onArchive:e=>{const t=r.find(t=>t.id===e);t&&S.setStudentToArchive(t)},currentUserRole:I.role,onViewDetails:e=>S.setDetailsModalState({student:e,initialTab:"attendanceLog"}),onMarkWeeklyReportSent:M.handleMarkWeeklyReportSent,onBack:()=>he()});if(S.teacherForDetails||S.supervisorForDetails)return e(k,{teacher:S.teacherForDetails||void 0,supervisor:S.supervisorForDetails||void 0,groups:a,students:t,teacherAttendance:b,teacherPayrollAdjustments:x,financialSettings:v,onEditTeacherClick:e=>{S.setTeacherToEdit(e),S.setIsTeacherFormOpen(!0)},onEditSupervisorClick:e=>{S.setSupervisorToEdit(e),S.setIsTeacherFormOpen(!0)},onDeleteTeacher:F.handleDeleteTeacher,onDeleteSupervisor:F.handleDeleteSupervisor,onSetTeacherAttendance:L.handleSetTeacherAttendance,onUpdatePayrollAdjustments:L.handleUpdatePayrollAdjustments,onLogExpense:L.handleLogExpense,onViewTeacherReport:e=>S.setViewingTeacherReportId(e),onSendNotificationToAll:e=>R.handleSendNotificationToAll(e),teacherCollections:f,teacherManualBonuses:w,currentUserRole:I.role,onAddTeacherCollection:L.handleAddTeacherCollection,onAddManualBonus:L.handleAddManualBonus,onDeleteManualBonus:L.handleDeleteManualBonus,onDeleteTeacherAttendance:L.handleDeleteTeacherAttendance,onResetPayment:L.handleResetTeacherPayment,onBack:()=>he()});if(S.isArchiveView){const t=r.filter(e=>e.isArchived).filter(e=>"director"===I.role||("supervisor"===I.role?te?.students.some(t=>t.id===e.id)||!1:"teacher"===I.role&&e.archivedBy===I.id));return e("div",{className:"container mx-auto px-4 py-8",children:e("div",{className:"space-y-6",children:t.length>0?t.map(t=>e("div",{className:"p-4 bg-white rounded shadow",children:t.name},t.id)):e("div",{className:"text-center py-20",children:e("h2",{className:"text-2xl font-semibold text-gray-600",children:"ุงูุฃุฑุดูู ูุงุฑุบ"})})})})}if(S.isDebtorsView)return e(_e,{students:t,groups:a,onPayDebt:L.handlePayDebt,onViewDetails:e=>S.setDetailsModalState({student:e,initialTab:"attendanceLog"}),currentUserRole:I.role,searchTerm:S.searchTerm});if(S.isFinanceView)return e(ne,{onBack:()=>he(),students:t,teachers:s,staff:p,expenses:g,teacherAttendance:b,teacherPayrollAdjustments:x,onAddStaff:L.handleAddStaff,onUpdateStaff:L.handleUpdateStaff,onDeleteStaff:L.handleDeleteStaff,onLogExpense:L.handleLogExpense,onDeleteExpense:L.handleDeleteExpense,onSetTeacherAttendance:L.handleSetTeacherAttendance,onUpdatePayrollAdjustments:L.handleUpdatePayrollAdjustments,financialSettings:v,onUpdateFinancialSettings:L.handleUpdateFinancialSettings,groups:a,onResetTeacherPayment:L.handleResetTeacherPayment,onResetStaffPayment:L.handleResetStaffPayment,teacherCollections:f,onViewTeacherDetails:e=>{S.setTeacherForDetails(e),S.setSupervisorForDetails(null)},supervisors:l,onApplyDeductions:(e,t)=>{},donations:y,onAddDonation:L.handleAddDonation,onDeleteDonation:L.handleDeleteDonation});if(S.isTeacherManagerView)return e(We,{onBack:()=>he(),teachers:s,supervisors:l,groups:a,students:ie,teacherAttendance:b,teacherPayrollAdjustments:x,onAddTeacherClick:()=>{S.setTeacherToEdit(null),S.setSupervisorToEdit(null),S.setIsTeacherFormOpen(!0)},onEditTeacherClick:e=>{S.setTeacherToEdit(e),S.setSupervisorToEdit(null),S.setIsTeacherFormOpen(!0)},onEditSupervisorClick:e=>{S.setSupervisorToEdit(e),S.setTeacherToEdit(null),S.setIsTeacherFormOpen(!0)},onDeleteTeacher:F.handleDeleteTeacher,onDeleteSupervisor:F.handleDeleteSupervisor,onSetTeacherAttendance:L.handleSetTeacherAttendance,onUpdatePayrollAdjustments:L.handleUpdatePayrollAdjustments,onLogExpense:L.handleLogExpense,financialSettings:v,onUpdateFinancialSettings:L.handleUpdateFinancialSettings,onViewTeacherReport:e=>S.setViewingTeacherReportId(e),onSendNotificationToAll:e=>R.handleSendNotificationToAll(e),onSendNotificationToTeacher:(e,t)=>R.handleSendNotificationToTeacher(e,t),onViewTeacherDetails:e=>{S.setTeacherForDetails(e),S.setSupervisorForDetails(null)},onViewSupervisorDetails:e=>{S.setSupervisorForDetails(e),S.setTeacherForDetails(null)},searchTerm:S.searchTerm,isFilterVisible:S.isTeacherFilterVisible,onToggleFilter:()=>S.setIsTeacherFilterVisible(!S.isTeacherFilterVisible)});switch(S.activeView){case"students":return e(V,{students:t,searchTerm:S.searchTerm,groups:a,onOpenFeeModal:(e,t,a)=>{S.setPaymentDetails({studentId:e,month:t,amount:a}),S.setIsFeeModalOpen(!0)},onEdit:e=>{S.setStudentToEdit(e),S.setIsFormOpen(!0)},onToggleAttendance:M.handleToggleAttendance,onArchive:e=>{const t=r.find(t=>t.id===e);t&&S.setStudentToArchive(t)},currentUserRole:I.role,onViewDetails:(e,t)=>S.setDetailsModalState({student:e,initialTab:t||"attendanceLog"}),typeFilter:(S.activeView,"all"),onTypeFilterChange:()=>{},onMarkWeeklyReportSent:M.handleMarkWeeklyReportSent});case"groups":return e(Se,{students:t,searchTerm:S.searchTerm,groups:a,teachers:s,notes:o,onViewGroupReport:e=>{const t=n.find(t=>t.id===e);t&&S.setViewingGroup(t)},onViewStudents:e=>S.setViewingGroupStudents(e),onOpenFeeModal:(e,t,a)=>{S.setPaymentDetails({studentId:e,month:t,amount:a}),S.setIsFeeModalOpen(!0)},onAddTest:M.handleAddTest,onDeleteTest:M.handleDeleteTest,onAddNote:M.handleAddNote,onEdit:e=>{S.setStudentToEdit(e),S.setIsFormOpen(!0)},onToggleAttendance:M.handleToggleAttendance,onArchive:e=>{const t=r.find(t=>t.id===e);t&&S.setStudentToArchive(t)},currentUserRole:I.role,onViewDetails:(e,t)=>S.setDetailsModalState({student:e,initialTab:t||"attendanceLog"}),onMarkWeeklyReportSent:M.handleMarkWeeklyReportSent});case"attendance_report":return e(Te,{students:t,groups:a,onViewStudent:e=>{const t=r.find(t=>t.id===e);t&&S.setSearchTerm(t.name)},onArchive:e=>{const t=r.find(t=>t.id===e);t&&S.setStudentToArchive(t)},onViewDetails:(e,t)=>S.setDetailsModalState({student:e,initialTab:t||"attendanceLog"}),currentUserRole:I.role});case"tests_report":return e(Ee,{students:t,groups:a,onViewStudent:e=>{const t=r.find(t=>t.id===e);t&&S.setSearchTerm(t.name)},onBack:()=>he()});case"financial_report":return e(se,{students:t,groups:a,onViewStudent:e=>{const t=r.find(t=>t.id===e);t&&S.setSearchTerm(t.name)},currentUserRole:I.role})}})()})}),"parent"!==I.role&&e(me,{activeView:S.activeView,onSelectView:e=>{S.setActiveView(e)}})]})]}),e(j,{isOpen:S.isFormOpen,onClose:()=>{S.setIsFormOpen(!1),S.setStudentToEdit(null)},onSave:M.addOrUpdateStudent,studentToEdit:S.studentToEdit||void 0,groups:ae}),e(Me,{isOpen:S.isFeeModalOpen,onClose:()=>{S.setIsFeeModalOpen(!1),S.setPaymentDetails(null)},onSave:L.handleSaveFeePayment,paymentDetails:S.paymentDetails||void 0}),e(Le,{isOpen:!!S.studentToUnarchiveId,onClose:()=>S.setStudentToUnarchiveId(null),onConfirm:e=>{},groups:ae,studentName:r.find(e=>e.id===S.studentToUnarchiveId)?.name||""}),S.studentToArchive&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t("div",{className:"bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-md",children:[e("h2",{className:"text-2xl font-bold mb-4 text-gray-700",children:"ุชุฃููุฏ ุงูุฃุฑุดูุฉ"}),t("p",{className:"text-gray-600 mb-6",children:['ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ููู ุงูุทุงูุจ "',S.studentToArchive.name,'" ุฅูู ุงูุฃุฑุดููุ']}),t("div",{className:"flex gap-4",children:[e("button",{type:"button",onClick:()=>S.setStudentToArchive(null),className:"px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300",children:"ุฅูุบุงุก"}),e("button",{type:"button",onClick:()=>{S.setStudentToArchive(null)},className:"px-6 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700",children:"ูุนูุ ุฃุฑุดูุฉ"})]})]})}),I&&!S.isChatOpen&&e("button",{onClick:()=>S.setIsChatOpen(!0),className:"fixed left-20 bottom-20 bg-blue-600 text-white p-4 rounded-full shadow-xl",style:{zIndex:9999},children:"๐ฌ"}),I&&S.isChatOpen&&e("div",{className:"fixed inset-0 bg-black/60 z-[120] flex items-center justify-center p-4",children:e("div",{className:"w-full max-w-6xl h-full max-h-[85vh] bg-white rounded-2xl shadow-2xl overflow-hidden",children:e(Ne,{currentUser:{uid:"director"===I.role?"director":I.id,role:I.role,name:I.name},teachers:U,groups:n,students:"parent"===I.role?r.filter(e=>I.studentIds.includes(e.id)):r,parents:i,supervisors:l,initialSelectedUserId:S.chatInitialUserId,onBack:()=>{S.setIsChatOpen(!1),S.setChatInitialUserId(void 0)}})})}),("director"===I.role||"supervisor"===I.role)&&t(a,{children:[e(Ge,{isOpen:S.isGroupManagerOpen,onClose:()=>S.setIsGroupManagerOpen(!1),groups:ae,students:r,onAddGroup:F.handleAddGroup,onUpdateGroup:F.handleUpdateGroup,onDeleteGroup:F.handleDeleteGroup,teachers:s}),e(ze,{isOpen:S.isTeacherFormOpen,onClose:()=>{S.setIsTeacherFormOpen(!1),S.setTeacherToEdit(null),S.setSupervisorToEdit(null)},onSaveTeacher:F.handleSaveTeacher,onSaveSupervisor:F.handleSaveSupervisor,teacherToEdit:S.teacherToEdit||void 0,supervisorToEdit:S.supervisorToEdit||void 0})]})]},"director"===I?.role?"director":I?.id)},Ke=document.getElementById("root");if(!Ke)throw new Error("Could not find root element to mount to");le.createRoot(Ke).render(e(T.StrictMode,{children:e(Xe,{})}));
